<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API测试页面</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    window.config = {
      apiBaseUrl: 'http://localhost:8080',
      authToken: null,
      userId: 'agent-001'
    };
  </script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8 text-center">API 功能测试</h1>

    <!-- 测试区域 -->
    <div class="space-y-6">
      <!-- Customer API 测试 -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">Customer API 测试</h2>
        <div class="space-y-3">
          <button onclick="testGetCustomer()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
            获取客户信息 (GET /api/customers/CUST001)
          </button>
          <button onclick="testAddInteraction()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 ml-2">
            添加客户交互 (POST /api/customers/CUST001/interactions)
          </button>
        </div>
        <div id="customer-result" class="mt-4 p-4 bg-gray-50 rounded border border-gray-200 text-sm">
          <pre class="whitespace-pre-wrap"></pre>
        </div>
      </div>

      <!-- Requirement API 测试 -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">Requirement API 测试</h2>
        <div class="space-y-3">
          <button onclick="testCreateRequirement()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
            创建需求 (POST /api/requirements)
          </button>
          <button onclick="testListRequirements()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 ml-2">
            查询需求列表 (GET /api/requirements)
          </button>
        </div>
        <div id="requirement-result" class="mt-4 p-4 bg-gray-50 rounded border border-gray-200 text-sm">
          <pre class="whitespace-pre-wrap"></pre>
        </div>
      </div>

      <!-- Conversation API 测试 -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">Conversation API 测试</h2>
        <div class="space-y-3">
          <button onclick="testCreateConversation()" class="bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600">
            创建会话 (POST /api/conversations)
          </button>
          <button onclick="testListConversations()" class="bg-cyan-500 text-white px-4 py-2 rounded hover:bg-cyan-600 ml-2">
            查询会话列表 (GET /api/conversations)
          </button>
        </div>
        <div id="conversation-result" class="mt-4 p-4 bg-gray-50 rounded border border-gray-200 text-sm">
          <pre class="whitespace-pre-wrap"></pre>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // 导入 ApiClient
    import { apiClient } from './assets/js/infrastructure/api/ApiClient.js';

    // Customer API 测试
    window.testGetCustomer = async () => {
      const resultDiv = document.querySelector('#customer-result pre');
      try {
        resultDiv.textContent = '正在请求...';
        const response = await apiClient.get('/api/customers/CUST001');
        resultDiv.textContent = JSON.stringify(response, null, 2);
      } catch (error) {
        resultDiv.textContent = `错误: ${error.message}\n${JSON.stringify(error.response || {}, null, 2)}`;
      }
    };

    window.testAddInteraction = async () => {
      const resultDiv = document.querySelector('#customer-result pre');
      try {
        resultDiv.textContent = '正在请求...';
        const response = await apiClient.post('/api/customers/CUST001/interactions', {
          interactionType: 'phone_call',
          content: '客户咨询产品功能',
          channel: 'phone',
          sentiment: 'positive'
        });
        resultDiv.textContent = JSON.stringify(response, null, 2);
      } catch (error) {
        resultDiv.textContent = `错误: ${error.message}\n${JSON.stringify(error.response || {}, null, 2)}`;
      }
    };

    // Requirement API 测试
    window.testCreateRequirement = async () => {
      const resultDiv = document.querySelector('#requirement-result pre');
      try {
        resultDiv.textContent = '正在请求...';
        const response = await apiClient.post('/api/requirements', {
          customerId: 'CUST001',
          title: '前端测试创建需求',
          description: '这是从前端页面创建的测试需求',
          category: 'feature_request',
          priority: 'medium'
        });
        resultDiv.textContent = JSON.stringify(response, null, 2);
      } catch (error) {
        resultDiv.textContent = `错误: ${error.message}\n${JSON.stringify(error.response || {}, null, 2)}`;
      }
    };

    window.testListRequirements = async () => {
      const resultDiv = document.querySelector('#requirement-result pre');
      try {
        resultDiv.textContent = '正在请求...';
        const response = await apiClient.get('/api/requirements', {
          params: { customerId: 'CUST001' }
        });
        resultDiv.textContent = JSON.stringify(response, null, 2);
      } catch (error) {
        resultDiv.textContent = `错误: ${error.message}\n${JSON.stringify(error.response || {}, null, 2)}`;
      }
    };

    // Conversation API 测试
    window.testCreateConversation = async () => {
      const resultDiv = document.querySelector('#conversation-result pre');
      try {
        resultDiv.textContent = '正在请求...';
        const response = await apiClient.post('/api/conversations', {
          customerId: 'CUST001',
          channel: 'web',
          initialMessage: '你好，我需要帮助'
        });
        resultDiv.textContent = JSON.stringify(response, null, 2);
      } catch (error) {
        resultDiv.textContent = `错误: ${error.message}\n${JSON.stringify(error.response || {}, null, 2)}`;
      }
    };

    window.testListConversations = async () => {
      const resultDiv = document.querySelector('#conversation-result pre');
      try {
        resultDiv.textContent = '正在请求...';
        const response = await apiClient.get('/api/conversations', {
          params: { customerId: 'CUST001' }
        });
        resultDiv.textContent = JSON.stringify(response, null, 2);
      } catch (error) {
        resultDiv.textContent = `错误: ${error.message}\n${JSON.stringify(error.response || {}, null, 2)}`;
      }
    };

    console.log('API测试页面加载完成');
    console.log('ApiClient baseURL:', apiClient.baseURL);
  </script>
</body>
</html>
