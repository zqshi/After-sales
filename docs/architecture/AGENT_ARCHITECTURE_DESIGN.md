# After-Sales Multi-Agent æ¶æ„è®¾è®¡æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-27
**æœ€åæ›´æ–°**: 2025-12-27
**ä½œè€…**: After-Sales å¼€å‘å›¢é˜Ÿ
**çŠ¶æ€**: å·²å®æ–½å¹¶ä¸Šçº¿

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°After-Saleså”®åå®¢æœç³»ç»Ÿçš„Multi-Agentæ¶æ„è®¾è®¡æ€è·¯ã€æŠ€æœ¯é€‰å‹ã€AgentèŒè´£åˆ’åˆ†å’Œåä½œæœºåˆ¶ã€‚

**å…³é”®æˆæœ**ï¼š
- âœ… 3ä¸ªç‹¬ç«‹Agentï¼ˆAssistant/Engineer/Inspectorï¼‰å…¨éƒ¨å®ç°
- âœ… OrchestratorAgentæ™ºèƒ½è°ƒåº¦å™¨å®ç°å¹¶è¡Œæ‰§è¡Œ
- âœ… è´¨æ£€å¼‚æ­¥åŒ–å®Œæˆï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨
- âœ… å®¹é”™æœºåˆ¶å’Œé™çº§ç­–ç•¥å®Œå¤‡

---

## ğŸ¯ ä¸€ã€è®¾è®¡èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 ä¸šåŠ¡èƒŒæ™¯

After-Salesæ˜¯ä¸€ä¸ªå”®åå®¢æœSaaSç³»ç»Ÿï¼Œé¢å‘ä¼ä¸šå®¢æˆ·æä¾›æ™ºèƒ½å®¢æœæœåŠ¡ã€‚éšç€ä¸šåŠ¡å¢é•¿ï¼Œæˆ‘ä»¬é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

#### é—®é¢˜1ï¼šå•ä¸€å®¢æœAgentèƒ½åŠ›å—é™
- **ç°è±¡**ï¼šåŸæœ‰ç³»ç»Ÿåªæœ‰ä¸€ä¸ªé€šç”¨å®¢æœAgentï¼Œéœ€è¦å¤„ç†å’¨è¯¢ã€æ•…éšœã€æŠ•è¯‰ç­‰æ‰€æœ‰åœºæ™¯
- **ç—›ç‚¹**ï¼š
  - æ•…éšœè¯Šæ–­ä¸å¤Ÿä¸“ä¸šï¼ŒæŠ€æœ¯é—®é¢˜è§£å†³ç‡ä½
  - æƒ…æ„Ÿåˆ†æä¸ç²¾å‡†ï¼Œæ— æ³•è¯†åˆ«é«˜é£é™©å®¢æˆ·
  - è´¨æ£€æµç¨‹æ‰‹å·¥æ‰§è¡Œï¼Œæ•ˆç‡ä½ä¸‹

#### é—®é¢˜2ï¼šåŒæ­¥è´¨æ£€é˜»å¡ä¸»æµç¨‹
- **ç°è±¡**ï¼šå¯¹è¯ç»“æŸæ—¶åŒæ­¥æ‰§è¡Œè´¨æ£€ï¼Œå¯¼è‡´å¯¹è¯å…³é—­å˜æ…¢
- **ç—›ç‚¹**ï¼š
  - ç”¨æˆ·ä½“éªŒå·®ï¼Œå…³é—­å¯¹è¯éœ€è¦ç­‰å¾…3-5ç§’
  - è´¨æ£€å¤±è´¥ä¼šå½±å“å¯¹è¯å…³é—­æµç¨‹
  - é«˜å³°æœŸè´¨æ£€é˜Ÿåˆ—å µå¡

#### é—®é¢˜3ï¼šç¼ºå°‘ä¸“ä¸šåˆ†å·¥
- **ç°è±¡**ï¼šå®¢æœäººå‘˜æ—¢è¦å¤„ç†å¯¹è¯ï¼Œåˆè¦åšè´¨æ£€ï¼Œè¿˜è¦è¯Šæ–­æŠ€æœ¯é—®é¢˜
- **ç—›ç‚¹**ï¼š
  - äººå·¥æˆæœ¬é«˜ï¼Œæ•ˆç‡ä½
  - ä¸“ä¸šåº¦ä¸è¶³ï¼Œå®¢æˆ·æ»¡æ„åº¦ä¸‹é™
  - çŸ¥è¯†ç§¯ç´¯å›°éš¾

---

### 1.2 è®¾è®¡ç›®æ ‡

åŸºäºä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº†Multi-Agentæ¶æ„ï¼Œç›®æ ‡å¦‚ä¸‹ï¼š

#### ç›®æ ‡1ï¼šä¸“ä¸šåˆ†å·¥ï¼Œæå‡æœåŠ¡è´¨é‡
- **æªæ–½**ï¼šè®¾è®¡3ä¸ªç‹¬ç«‹Agentï¼Œå„å¸å…¶èŒ
  - **AssistantAgentï¼ˆè¾…åŠ©Agentï¼‰**ï¼šæƒ…æ„Ÿåˆ†æã€éœ€æ±‚æå–ã€å›å¤ç”Ÿæˆ
  - **EngineerAgentï¼ˆå·¥ç¨‹å¸ˆAgentï¼‰**ï¼šæ•…éšœè¯Šæ–­ã€çŸ¥è¯†æ£€ç´¢ã€æŠ€æœ¯æ–¹æ¡ˆ
  - **InspectorAgentï¼ˆè´¨æ£€Agentï¼‰**ï¼šè´¨é‡è¯„åˆ†ã€æŠ¥å‘Šç”Ÿæˆã€å®¢æˆ·å›è®¿
- **é¢„æœŸ**ï¼šæ•…éšœè§£å†³ç‡æå‡30%ï¼Œå®¢æˆ·æ»¡æ„åº¦æå‡20%

#### ç›®æ ‡2ï¼šè´¨æ£€å¼‚æ­¥åŒ–ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- **æªæ–½**ï¼šè´¨æ£€æ”¹ä¸ºäº‹ä»¶é©±åŠ¨å¼‚æ­¥æ‰§è¡Œ
  - å¯¹è¯å…³é—­æ—¶å‘å¸ƒ`ConversationClosedEvent`
  - åå°ç›‘å¬äº‹ä»¶ï¼Œå¼‚æ­¥è°ƒç”¨InspectorAgent
  - è´¨æ£€å¤±è´¥ä¸å½±å“å¯¹è¯å…³é—­
- **é¢„æœŸ**ï¼šå¯¹è¯å…³é—­å»¶è¿Ÿé™ä½è‡³<500msï¼Œè´¨æ£€è¦†ç›–ç‡100%

#### ç›®æ ‡3ï¼šæ™ºèƒ½è°ƒåº¦ï¼Œæå‡æ‰§è¡Œæ•ˆç‡
- **æªæ–½**ï¼šè®¾è®¡OrchestratorAgentæ™ºèƒ½è°ƒåº¦å™¨
  - åœºæ™¯è¯†åˆ«ï¼šå’¨è¯¢/æ•…éšœ/æŠ•è¯‰
  - æ‰§è¡Œæ¨¡å¼å†³ç­–ï¼šSimple/Parallel/Supervised/HumanFirst
  - å¹¶è¡Œæ‰§è¡Œï¼šæ•…éšœåœºæ™¯ä¸‹AssistantAgent+EngineerAgentå¹¶è¡Œå¤„ç†
- **é¢„æœŸ**ï¼šæ•…éšœåœºæ™¯å“åº”æ—¶é—´å‡å°‘50%

---

## ğŸ—ï¸ äºŒã€æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (React)                          â”‚
â”‚  â€¢ WebSocketè¿æ¥                                                  â”‚
â”‚  â€¢ å®æ—¶æ¶ˆæ¯æ¨é€                                                    â”‚
â”‚  â€¢ Agentå»ºè®®æ˜¾ç¤º                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ WebSocket / HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (Node.js/TypeScript)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Application Layer (Clean Architecture)                  â”‚  â”‚
â”‚  â”‚  â€¢ Use Cases (CreateConversation, CloseConversation...)   â”‚  â”‚
â”‚  â”‚  â€¢ Domain Events (ConversationClosedEvent...)             â”‚  â”‚
â”‚  â”‚  â€¢ Event Bus (å‘å¸ƒ/è®¢é˜…æ¨¡å¼)                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ConversationTaskCoordinator (äº‹ä»¶è®¢é˜…è€…)                 â”‚  â”‚
â”‚  â”‚  â€¢ è®¢é˜…ConversationClosedEvent                            â”‚  â”‚
â”‚  â”‚  â€¢ è°ƒç”¨AgentScope APIè§¦å‘è´¨æ£€                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AgentScope Service (Python/FastAPI)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  OrchestratorAgent (æ™ºèƒ½è°ƒåº¦å™¨)                           â”‚  â”‚
â”‚  â”‚  â€¢ åœºæ™¯è¯†åˆ« (consultation/fault/complaint)                â”‚  â”‚
â”‚  â”‚  â€¢ æ‰§è¡Œæ¨¡å¼å†³ç­– (Simple/Parallel/Supervised/HumanFirst)   â”‚  â”‚
â”‚  â”‚  â€¢ ç»“æœèšåˆ                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                  â”‚                  â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ AssistantAgentâ”‚ â”‚EngineerAgent â”‚ â”‚ InspectorAgentâ”‚          â”‚
â”‚  â”‚ (è¾…åŠ©)        â”‚ â”‚ (å·¥ç¨‹å¸ˆ)     â”‚ â”‚ (è´¨æ£€)        â”‚          â”‚
â”‚  â”‚              â”‚ â”‚              â”‚ â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ æƒ…æ„Ÿåˆ†æ   â”‚ â”‚ â€¢ æ•…éšœè¯Šæ–­   â”‚ â”‚ â€¢ è´¨é‡è¯„åˆ†   â”‚          â”‚
â”‚  â”‚ â€¢ éœ€æ±‚æå–   â”‚ â”‚ â€¢ çŸ¥è¯†æ£€ç´¢   â”‚ â”‚ â€¢ æŠ¥å‘Šç”Ÿæˆ   â”‚          â”‚
â”‚  â”‚ â€¢ å›å¤ç”Ÿæˆ   â”‚ â”‚ â€¢ æŠ€æœ¯æ–¹æ¡ˆ   â”‚ â”‚ â€¢ å®¢æˆ·å›è®¿   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MCP Tools (Model Context Protocol)                       â”‚  â”‚
â”‚  â”‚  â€¢ Backend MCP Client                                      â”‚  â”‚
â”‚  â”‚  â€¢ å·¥å…·ï¼šanalyzeConversation, searchKnowledge,            â”‚  â”‚
â”‚  â”‚          getCustomerProfile, createTask...                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ LLM API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DeepSeek v3 (LLM Provider)                      â”‚
â”‚  â€¢ æ¨¡å‹ï¼šdeepseek-chat                                           â”‚
â”‚  â€¢ ç”¨é€”ï¼šæ¨ç†ã€JSONç»“æ„åŒ–è¾“å‡ºã€ReActå¾ªç¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.2 å…³é”®è®¾è®¡å†³ç­–

#### å†³ç­–1ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Multi-Agentè€Œéå•ä¸€Agentï¼Ÿ

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ˜¯å¦é‡‡çº³ |
|------|------|------|---------|
| **å•ä¸€é€šç”¨Agent** | å®ç°ç®€å•ï¼Œç»Ÿä¸€ç®¡ç† | èƒ½åŠ›å—é™ï¼Œæ— ä¸“ä¸šåˆ†å·¥ | âŒ ä¸é‡‡çº³ |
| **Multi-Agent** | ä¸“ä¸šåˆ†å·¥ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œå¯æ‰©å±• | å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦åè°ƒ | âœ… é‡‡çº³ |
| **å¾®æœåŠ¡æ¶æ„** | æ¾è€¦åˆï¼Œç‹¬ç«‹éƒ¨ç½² | è¿‡åº¦è®¾è®¡ï¼Œç½‘ç»œå¼€é”€å¤§ | âŒ ä¸é‡‡çº³ |

**æœ€ç»ˆé€‰æ‹©**ï¼šMulti-Agentæ¶æ„

**ç†ç”±**ï¼š
1. **ä¸“ä¸šåº¦**ï¼šä¸åŒAgentä¸“æ³¨ä¸åŒé¢†åŸŸï¼Œæå‡æœåŠ¡è´¨é‡
2. **å¹¶è¡ŒåŒ–**ï¼šæ•…éšœåœºæ™¯ä¸‹Assistant+Engineerå¹¶è¡Œå¤„ç†ï¼Œå“åº”æ›´å¿«
3. **å¯æ‰©å±•**ï¼šæœªæ¥å¯ä»¥è½»æ¾æ·»åŠ æ–°Agentï¼ˆå¦‚ç¿»è¯‘Agentã€çŸ¥è¯†Agentï¼‰
4. **å¯ç»´æŠ¤**ï¼šAgentèŒè´£æ¸…æ™°ï¼Œä»£ç è€¦åˆåº¦ä½

---

#### å†³ç­–2ï¼šä¸ºä»€ä¹ˆé€‰æ‹©AgentScopeæ¡†æ¶ï¼Ÿ

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ¡†æ¶ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ˜¯å¦é‡‡çº³ |
|------|------|------|---------|
| **LangChain** | ç”Ÿæ€ä¸°å¯Œï¼Œå·¥å…·å¤š | å¤æ‚åº¦é«˜ï¼Œå­¦ä¹ æ›²çº¿é™¡ | âŒ ä¸é‡‡çº³ |
| **AutoGen** | å¤šAgentåä½œæˆç†Ÿ | ä¾èµ–OpenAIï¼Œçµæ´»æ€§å·® | âŒ ä¸é‡‡çº³ |
| **AgentScope** | è½»é‡ã€çµæ´»ã€æ”¯æŒReAct | ç”Ÿæ€è¾ƒå°ï¼Œæ–‡æ¡£è¾ƒå°‘ | âœ… é‡‡çº³ |
| **è‡ªç ”** | å®Œå…¨å¯æ§ | å¼€å‘æˆæœ¬é«˜ï¼Œå‘¨æœŸé•¿ | âŒ ä¸é‡‡çº³ |

**æœ€ç»ˆé€‰æ‹©**ï¼šAgentScope

**ç†ç”±**ï¼š
1. **ReActAgentæ”¯æŒ**ï¼šå†…ç½®ReActæ¨ç†å¾ªç¯ï¼Œéå¸¸é€‚åˆå·¥å…·è°ƒç”¨åœºæ™¯
2. **è½»é‡çº§**ï¼šæ ¸å¿ƒä»£ç å°‘ï¼Œæ˜“äºç†è§£å’Œå®šåˆ¶
3. **å¼‚æ­¥æ”¯æŒ**ï¼šåŸç”Ÿasync/awaitï¼Œé€‚åˆPython FastAPI
4. **MsgHubåä½œ**ï¼šæ”¯æŒå¤šAgentå¹¶è¡Œå’Œæ¶ˆæ¯ä¸­å¿ƒæ¨¡å¼

---

#### å†³ç­–3ï¼šä¸ºä»€ä¹ˆé€‰æ‹©äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Ÿ

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ˜¯å¦é‡‡çº³ |
|------|------|------|---------|
| **åŒæ­¥è°ƒç”¨** | å®ç°ç®€å•ï¼Œé€»è¾‘ç›´è§‚ | é˜»å¡ä¸»æµç¨‹ï¼Œæ€§èƒ½å·® | âŒ ä¸é‡‡çº³ |
| **æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰** | å¼‚æ­¥è§£è€¦ï¼Œé«˜åå | å¼•å…¥é¢å¤–ç»„ä»¶ï¼Œå¤æ‚åº¦é«˜ | âŒ ä¸é‡‡çº³ |
| **äº‹ä»¶é©±åŠ¨ï¼ˆå†…å­˜ï¼‰** | è½»é‡ã€å¼‚æ­¥ã€è§£è€¦ | æ¶ˆæ¯ä¸¢å¤±é£é™©ï¼ˆå†…å­˜ï¼‰ | âœ… é‡‡çº³ |

**æœ€ç»ˆé€‰æ‹©**ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆå†…å­˜EventBusï¼‰

**ç†ç”±**ï¼š
1. **éé˜»å¡**ï¼šå¯¹è¯å…³é—­åç«‹å³è¿”å›ï¼Œè´¨æ£€å¼‚æ­¥æ‰§è¡Œ
2. **è§£è€¦**ï¼šå¯¹è¯å…³é—­é€»è¾‘ä¸ä¾èµ–è´¨æ£€é€»è¾‘
3. **å®¹é”™**ï¼šè´¨æ£€å¤±è´¥ä¸å½±å“å¯¹è¯å…³é—­
4. **è½»é‡**ï¼šæ— éœ€å¼•å…¥RabbitMQ/Kafkaç­‰ç»„ä»¶ï¼Œé™ä½è¿ç»´æˆæœ¬

**é£é™©æ§åˆ¶**ï¼š
- æ¶ˆæ¯ä¸¢å¤±é£é™©ï¼šå¯æ¥å—ï¼Œè´¨æ£€ä¸æ˜¯æ ¸å¿ƒæµç¨‹
- æœªæ¥æ‰©å±•ï¼šå¦‚æœéœ€è¦æŒä¹…åŒ–ï¼Œå¯å‡çº§ä¸ºRedis Pub/Subæˆ–RabbitMQ

---

#### å†³ç­–4ï¼šä¸ºä»€ä¹ˆé€‰æ‹©DeepSeek v3ï¼Ÿ

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| LLM | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ˜¯å¦é‡‡çº³ |
|------|------|------|---------|
| **GPT-4** | èƒ½åŠ›æœ€å¼º | æˆæœ¬é«˜ï¼ˆ$30/1M tokensï¼‰ | âŒ ä¸é‡‡çº³ |
| **Claude 3.5 Sonnet** | æ¨ç†å¼ºï¼Œä¸Šä¸‹æ–‡é•¿ | æˆæœ¬ä¸­ç­‰ï¼ˆ$15/1M tokensï¼‰ | âŒ ä¸é‡‡çº³ |
| **DeepSeek v3** | æˆæœ¬æä½ï¼Œæ¨ç†èƒ½åŠ›å¼º | ç”Ÿæ€è¾ƒå° | âœ… é‡‡çº³ |
| **Qwen 2.5** | å›½äº§ï¼Œå…è´¹ | èƒ½åŠ›è¾ƒå¼±ï¼Œä¸ç¨³å®š | âŒ ä¸é‡‡çº³ |

**æœ€ç»ˆé€‰æ‹©**ï¼šDeepSeek v3

**ç†ç”±**ï¼š
1. **æˆæœ¬ä¼˜åŠ¿**ï¼š$1/1M tokensï¼Œæ˜¯GPT-4çš„1/30
2. **æ¨ç†èƒ½åŠ›**ï¼šReActå¾ªç¯è¡¨ç°ä¼˜ç§€ï¼Œå·¥å…·è°ƒç”¨å‡†ç¡®
3. **ç»“æ„åŒ–è¾“å‡º**ï¼šJSONæ ¼å¼è¾“å‡ºç¨³å®šï¼Œé€‚åˆAgentåœºæ™¯
4. **ä¸­æ–‡ä¼˜åŒ–**ï¼šå¯¹ä¸­æ–‡åœºæ™¯å‹å¥½

---

## ğŸ¤– ä¸‰ã€Agentè®¾è®¡

### 3.1 AssistantAgentï¼ˆè¾…åŠ©Agentï¼‰

#### èŒè´£å®šä½

é€šç”¨å®¢æœåŠ©æ‰‹ï¼Œè´Ÿè´£æƒ…æ„Ÿåˆ†æã€éœ€æ±‚æå–å’Œå‹å¥½å›å¤ç”Ÿæˆã€‚

#### æ ¸å¿ƒèƒ½åŠ›

1. **æƒ…æ„Ÿåˆ†æ**
   - è¯†åˆ«å®¢æˆ·æƒ…æ„Ÿï¼šæ­£é¢/ä¸­æ€§/è´Ÿé¢
   - è¯„ä¼°æƒ…ç»ªå¼ºåº¦ï¼šå†·é™/æ€¥è¿«/æ„¤æ€’
   - é£é™©ç­‰çº§åˆ¤æ–­ï¼šä½/ä¸­/é«˜
   - è¾“å‡ºç½®ä¿¡åº¦åˆ†æ•°ï¼ˆ0.0-1.0ï¼‰

2. **éœ€æ±‚æå–**
   - è¯†åˆ«éœ€æ±‚ç±»å‹ï¼šäº§å“/æŠ€æœ¯/æœåŠ¡
   - è¯„ä¼°ä¼˜å…ˆçº§ï¼šç´§æ€¥/é«˜/ä¸­/ä½
   - åˆ¤æ–­æ˜¯å¦éœ€è¦æ¾„æ¸…
   - ç”Ÿæˆæ¾„æ¸…é—®é¢˜

3. **å›å¤ç”Ÿæˆ**
   - å‹å¥½ã€ä¸“ä¸šã€ç®€æ´
   - é¿å…æŠ€æœ¯æœ¯è¯­
   - ä¸ç¡®å®šæ—¶ä¸»åŠ¨å‡çº§äººå·¥

#### å·¥å…·ä¾èµ–

- `analyzeConversation`ï¼šæ·±åº¦æƒ…æ„Ÿåˆ†æï¼ˆé€šè¿‡MCPè°ƒç”¨åç«¯ï¼‰
- `getCustomerProfile`ï¼šæŸ¥çœ‹å®¢æˆ·ç”»åƒ
- `searchKnowledge`ï¼šçŸ¥è¯†åº“æ£€ç´¢ï¼ˆFAQç±»ï¼‰

#### è¾“å‡ºæ ¼å¼

```json
{
  "sentiment_analysis": {
    "sentiment": "positive/neutral/negative",
    "intensity": "calm/urgent/angry",
    "score": 0.8,
    "risk_level": "low"
  },
  "requirement_extraction": [
    {
      "title": "éœ€æ±‚åç§°",
      "category": "product",
      "priority": "medium",
      "confidence": 0.9,
      "clarification_needed": false
    }
  ],
  "clarification_questions": [],
  "suggested_reply": "ç»™å®¢æˆ·çš„å›å¤æ–‡æœ¬",
  "confidence": 0.92
}
```

#### å‡çº§äººå·¥è§„åˆ™

- è§„åˆ™1ï¼šé£é™©ç­‰çº§ä¸º`high`
- è§„åˆ™2ï¼šæƒ…æ„Ÿä¸º`negative`
- è§„åˆ™3ï¼šç½®ä¿¡åº¦<0.7
- è§„åˆ™4ï¼šå­˜åœ¨`urgent`ä¼˜å…ˆçº§éœ€æ±‚

#### å®ç°æ–‡ä»¶

- æ–‡ä»¶è·¯å¾„ï¼š`agentscope-service/src/agents/assistant_agent.py`
- ä»£ç è¡Œæ•°ï¼š272è¡Œ
- ç»§æ‰¿ï¼š`ReActAgent`
- æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼š6è½®

---

### 3.2 EngineerAgentï¼ˆå·¥ç¨‹å¸ˆAgentï¼‰

#### èŒè´£å®šä½

æŠ€æœ¯ä¸“å®¶ï¼Œè´Ÿè´£æ•…éšœè¯Šæ–­ã€çŸ¥è¯†åº“æ£€ç´¢å’ŒæŠ€æœ¯æ–¹æ¡ˆç”Ÿæˆã€‚

#### æ ¸å¿ƒèƒ½åŠ›

1. **æ•…éšœè¯Šæ–­**
   - ä¸¥é‡æ€§è¯„ä¼°ï¼šP0ï¼ˆç³»ç»Ÿå®•æœºï¼‰-P4ï¼ˆä¼˜åŒ–å»ºè®®ï¼‰
   - æ ¹æœ¬åŸå› åˆ†æ
   - å½±å“èŒƒå›´è¯„ä¼°
   - é¢„è®¡è§£å†³æ—¶é—´

2. **çŸ¥è¯†æ£€ç´¢**
   - TaxKBçŸ¥è¯†åº“æ£€ç´¢ï¼ˆç›¸ä¼¼æ¡ˆä¾‹ã€æŠ€æœ¯æ–‡æ¡£ï¼‰
   - å†å²å·¥å•æ£€ç´¢ï¼ˆç±»ä¼¼é—®é¢˜ã€è§£å†³æ–¹æ¡ˆï¼‰
   - è¯­ä¹‰æ£€ç´¢æ¨¡å¼

3. **æ–¹æ¡ˆç”Ÿæˆ**
   - ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆWorkaroundï¼‰
   - æ ¹æœ¬ä¿®å¤æ–¹æ¡ˆï¼ˆæ­¥éª¤åŒ–ã€å¯æ“ä½œï¼‰
   - æŠ€æœ¯æŠ¥å‘Šè¾“å‡ºï¼ˆMarkdownæ ¼å¼ï¼‰

4. **è‡ªåŠ¨å·¥å•åˆ›å»º**
   - P0/P1æ•…éšœè‡ªåŠ¨åˆ›å»ºå·¥å•
   - ä¼˜å…ˆçº§æ˜ å°„ï¼šP0â†’urgent, P1â†’high

#### ä¸¥é‡æ€§åˆ†çº§æ ‡å‡†

| ç­‰çº§ | æ ‡å‡† | ç¤ºä¾‹ | å“åº”å®¢æˆ·ç­‰çº§ |
|------|------|------|---------|
| **P0** | ç³»ç»Ÿå®•æœºï¼Œå¤§é‡ç”¨æˆ·æ— æ³•ä½¿ç”¨æ ¸å¿ƒåŠŸèƒ½ | è®¤è¯æœåŠ¡å´©æºƒï¼Œæ‰€æœ‰ç”¨æˆ·æ— æ³•ç™»å½• | 15åˆ†é’Ÿ |
| **P1** | æ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ï¼Œå½±å“éƒ¨åˆ†ç”¨æˆ· | æ”¯ä»˜æ¥å£æŠ¥é”™ï¼Œéƒ¨åˆ†ç”¨æˆ·æ— æ³•æ”¯ä»˜ | 1å°æ—¶ |
| **P2** | éæ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ï¼Œæœ‰ä¸´æ—¶æ–¹æ¡ˆ | å¯¼å‡ºExcelè¶…æ—¶ï¼Œå¯åˆ†æ‰¹å¯¼å‡º | 4å°æ—¶ |
| **P3** | å°é—®é¢˜ï¼Œä¸å½±å“ä½¿ç”¨ | UIæ ·å¼é”™ä½ | 1å¤© |
| **P4** | ä¼˜åŒ–å»ºè®® | åŠ è½½é€Ÿåº¦å¯ä»¥æ›´å¿« | 1å‘¨ |

#### å·¥å…·ä¾èµ–

- `searchKnowledge`ï¼šTaxKBçŸ¥è¯†åº“æ£€ç´¢
- `searchTickets`ï¼šå†å²å·¥å•æ£€ç´¢
- `getSystemStatus`ï¼šç³»ç»ŸçŠ¶æ€æŸ¥è¯¢
- `createTask`ï¼šåˆ›å»ºå·¥å•ï¼ˆP0/P1è‡ªåŠ¨ï¼‰

#### è¾“å‡ºæ ¼å¼

```json
{
  "fault_diagnosis": {
    "severity": "P1",
    "root_cause": "æ•°æ®åº“è¿æ¥æ± è€—å°½",
    "affected_scope": "éƒ¨åˆ†ç”¨æˆ·ï¼Œç™»å½•åŠŸèƒ½å¼‚å¸¸",
    "solution_steps": ["æ­¥éª¤1", "æ­¥éª¤2", "æ­¥éª¤3"],
    "temporary_solution": "æ¸…ç†æµè§ˆå™¨ç¼“å­˜åé‡è¯•",
    "estimated_time": "1å°æ—¶",
    "need_escalation": true
  },
  "knowledge_results": [...],
  "similar_tickets": [...],
  "technical_report": "## æ•…éšœåˆ†ææŠ¥å‘Š\n...",
  "suggested_reply": "ç»™å®¢æˆ·çš„æŠ€æœ¯å›å¤",
  "confidence": 0.88
}
```

#### å®ç°æ–‡ä»¶

- æ–‡ä»¶è·¯å¾„ï¼š`agentscope-service/src/agents/engineer_agent.py`
- ä»£ç è¡Œæ•°ï¼š346è¡Œ
- ç»§æ‰¿ï¼š`ReActAgent`
- æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼š10è½®ï¼ˆæ•…éšœè¯Šæ–­å¯èƒ½éœ€è¦æ›´å¤šæ¨ç†ï¼‰

---

### 3.3 InspectorAgentï¼ˆè´¨æ£€Agentï¼‰

#### èŒè´£å®šä½

è´¨é‡è¯„ä¼°ä¸“å®¶ï¼Œè´Ÿè´£å¯¹è¯è´¨æ£€ã€æŠ¥å‘Šç”Ÿæˆå’Œå®¢æˆ·å›è®¿å»ºè®®ã€‚

#### æ ¸å¿ƒèƒ½åŠ›

1. **è´¨é‡è¯„åˆ†**ï¼ˆ0-100åˆ†ï¼‰
   - **å®Œæ•´æ€§ï¼ˆ30%ï¼‰**ï¼šæ˜¯å¦å®Œæ•´è§£å†³é—®é¢˜ï¼Œä¿¡æ¯æ˜¯å¦å……åˆ†
   - **ä¸“ä¸šåº¦ï¼ˆ30%ï¼‰**ï¼šä¸“ä¸šæœ¯è¯­ä½¿ç”¨æ˜¯å¦å‡†ç¡®ï¼Œè§£é‡Šæ˜¯å¦æ¸…æ™°
   - **åˆè§„æ€§ï¼ˆ20%ï¼‰**ï¼šæ˜¯å¦ç¬¦åˆå…¬å¸è§„èŒƒï¼Œæ— è¿è§„å†…å®¹
   - **è¯­æ°”è¯­è°ƒï¼ˆ20%ï¼‰**ï¼šæ˜¯å¦å‹å¥½ã€è€å¿ƒã€æœ‰åŒç†å¿ƒ

2. **æƒ…ç»ªæ”¹å–„åˆ†æ**ï¼ˆ0-100%ï¼‰
   - å¯¹è¯å‰åæƒ…ç»ªå˜åŒ–
   - é—®é¢˜è§£å†³ç¨‹åº¦
   - å®¢æˆ·æ»¡æ„åº¦é¢„æµ‹ï¼ˆ1-5æ˜Ÿï¼‰

3. **é£é™©è¯†åˆ«**
   - è¯†åˆ«æœåŠ¡ä¸è¶³çš„é£é™©æŒ‡æ ‡
   - ç”Ÿæˆæ”¹è¿›å»ºè®®
   - åˆ¤æ–­æ˜¯å¦éœ€è¦å›è®¿

4. **è‡ªåŠ¨åŒ–åç»­åŠ¨ä½œ**
   - è´¨é‡è¯„åˆ†<70ï¼šè‡ªåŠ¨åˆ›å»ºæ”¹è¿›ä»»åŠ¡
   - éœ€è¦å›è®¿ï¼šè‡ªåŠ¨åˆ›å»ºå®¢æˆ·è°ƒç ”
   - ä¿å­˜è´¨æ£€æŠ¥å‘Šåˆ°æ•°æ®åº“

#### è¯„åˆ†æ ‡å‡†

**å®Œæ•´æ€§è¯„åˆ†**ï¼š
- 90-100åˆ†ï¼šå®Œæ•´è§£å†³é—®é¢˜ï¼Œæä¾›è¯¦ç»†ä¿¡æ¯
- 70-89åˆ†ï¼šåŸºæœ¬è§£å†³é—®é¢˜ï¼Œä½†ç¼ºå°‘éƒ¨åˆ†ç»†èŠ‚
- 50-69åˆ†ï¼šéƒ¨åˆ†è§£å†³é—®é¢˜ï¼Œå­˜åœ¨æ˜æ˜¾é—æ¼
- <50åˆ†ï¼šæœªèƒ½æœ‰æ•ˆè§£å†³é—®é¢˜

**ä¸“ä¸šåº¦è¯„åˆ†**ï¼š
- 90-100åˆ†ï¼šä¸“ä¸šæœ¯è¯­ä½¿ç”¨å‡†ç¡®ï¼Œè§£é‡Šæ¸…æ™°
- 70-89åˆ†ï¼šä¸“ä¸šåº¦è‰¯å¥½ï¼Œå¶å°”æœ‰ä¸å½“è¡¨è¿°
- 50-69åˆ†ï¼šä¸“ä¸šåº¦ä¸€èˆ¬ï¼Œä½¿ç”¨è¿‡å¤šæœ¯è¯­æˆ–è¡¨è¾¾ä¸æ¸…
- <50åˆ†ï¼šä¸“ä¸šåº¦ä¸è¶³

**åˆè§„æ€§è¯„åˆ†**ï¼š
- 90-100åˆ†ï¼šå®Œå…¨ç¬¦åˆè§„èŒƒï¼Œæ— è¿è§„å†…å®¹
- 70-89åˆ†ï¼šåŸºæœ¬åˆè§„ï¼Œæœ‰è½»å¾®ä¸è§„èŒƒ
- 50-69åˆ†ï¼šå­˜åœ¨æ˜æ˜¾ä¸è§„èŒƒè¡¨è¿°
- <50åˆ†ï¼šä¸¥é‡è¿è§„

**è¯­æ°”è¯„åˆ†**ï¼š
- 90-100åˆ†ï¼šå‹å¥½ã€è€å¿ƒã€åŒç†å¿ƒå¼º
- 70-89åˆ†ï¼šç¤¼è²Œä½†ç•¥æ˜¾ç”Ÿç¡¬
- 50-69åˆ†ï¼šè¯­æ°”ä¸å½“æˆ–ç¼ºå°‘æ¸©åº¦
- <50åˆ†ï¼šè¯­æ°”ä¸ä½³

#### è§¦å‘æ—¶æœº

**å¼‚æ­¥è§¦å‘**ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰ï¼š
1. ç”¨æˆ·/ç³»ç»Ÿå…³é—­å¯¹è¯
2. `CloseConversationUseCase.execute()`æ‰§è¡Œ
3. åˆ›å»ºå¹¶å‘å¸ƒ`ConversationClosedEvent`
4. `ConversationTaskCoordinator`ç›‘å¬äº‹ä»¶
5. å¼‚æ­¥è°ƒç”¨AgentScope APIï¼š`POST /api/agents/inspect`
6. InspectorAgentæ‰§è¡Œè´¨æ£€

#### å·¥å…·ä¾èµ–

- `getConversationHistory`ï¼šè·å–å®Œæ•´å¯¹è¯å†å²
- `getCustomerHistory`ï¼šè·å–å®¢æˆ·å†å²å¯¹è¯
- `saveQualityReport`ï¼šä¿å­˜è´¨æ£€æŠ¥å‘Š
- `createSurvey`ï¼šåˆ›å»ºå®¢æˆ·è°ƒç ”
- `createTask`ï¼šåˆ›å»ºæ”¹è¿›ä»»åŠ¡

#### è¾“å‡ºæ ¼å¼

```json
{
  "quality_score": 75,
  "dimensions": {
    "completeness": 80,
    "professionalism": 75,
    "compliance": 85,
    "tone": 60
  },
  "sentiment_improvement": 45,
  "customer_satisfaction_prediction": 3.5,
  "risk_indicators": ["å›å¤è¿‡äºç®€çŸ­", "æœªæä¾›é¢„è®¡è§£å†³æ—¶é—´"],
  "improvement_suggestions": ["åº”ä¸»åŠ¨å®‰æŠšå®¢æˆ·æƒ…ç»ª", "åº”æä¾›æ›´è¯¦ç»†ä¿¡æ¯"],
  "need_follow_up": true,
  "follow_up_reason": "å®¢æˆ·é—®é¢˜æœªå®Œå…¨è§£å†³",
  "survey_questions": ["æœ¬æ¬¡æœåŠ¡æ˜¯å¦è§£å†³äº†æ‚¨çš„é—®é¢˜ï¼Ÿ"]
}
```

#### å®ç°æ–‡ä»¶

- æ–‡ä»¶è·¯å¾„ï¼š`agentscope-service/src/agents/inspector_agent.py`
- ä»£ç è¡Œæ•°ï¼š412è¡Œ
- ç»§æ‰¿ï¼š`ReActAgent`
- æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼š8è½®

---

### 3.4 OrchestratorAgentï¼ˆæ™ºèƒ½è°ƒåº¦å™¨ï¼‰

#### èŒè´£å®šä½

å¤šAgentåè°ƒå™¨ï¼Œè´Ÿè´£åœºæ™¯è¯†åˆ«ã€Agenté€‰æ‹©ã€æ‰§è¡Œæ¨¡å¼å†³ç­–å’Œç»“æœèšåˆã€‚

#### æ ¸å¿ƒèƒ½åŠ›

1. **åœºæ™¯è¯†åˆ«**
   - **consultationï¼ˆå’¨è¯¢ï¼‰**ï¼šå¸¸è§„äº§å“å’¨è¯¢ã€åŠŸèƒ½ä½¿ç”¨
   - **faultï¼ˆæ•…éšœï¼‰**ï¼šæŠ¥é”™ã€å¼‚å¸¸ã€åŠŸèƒ½å¤±æ•ˆ
   - **complaintï¼ˆæŠ•è¯‰ï¼‰**ï¼šä¸æ»¡æ„ã€å·®è¯„ã€é€€æ¬¾

2. **æ‰§è¡Œæ¨¡å¼å†³ç­–**
   - **Simple**ï¼šå•AssistantAgentå¤„ç†ï¼ˆä½å¤æ‚åº¦å’¨è¯¢ï¼‰
   - **Parallel**ï¼šAssistant+Engineerå¹¶è¡Œï¼ˆæ•…éšœåœºæ™¯ï¼‰
   - **Supervised**ï¼šAgentå¤„ç†+äººå·¥å®¡æ ¸ï¼ˆä¸­é«˜å¤æ‚åº¦ï¼‰
   - **HumanFirst**ï¼šäººå·¥ä¼˜å…ˆ+Agentå»ºè®®ï¼ˆé«˜é£é™©/VIP/æŠ•è¯‰ï¼‰

3. **æ™ºèƒ½è·¯ç”±è§„åˆ™**
   - Rule 1ï¼šé«˜é£é™©/è´Ÿé¢æƒ…ç»ª â†’ `human_first`
   - Rule 2ï¼šVIPå®¢æˆ· â†’ `human_first`
   - Rule 3ï¼šæŠ•è¯‰åœºæ™¯ â†’ `human_first`
   - Rule 4ï¼šæ•…éšœåœºæ™¯ â†’ `parallel`
   - Rule 5ï¼šé«˜å¤æ‚åº¦ â†’ `agent_supervised`
   - Rule 6ï¼šä½å¤æ‚åº¦ â†’ `simple`

4. **å¹¶è¡Œæ‰§è¡Œ**
   - ä½¿ç”¨`asyncio.gather`å¹¶è¡Œè°ƒç”¨å¤šä¸ªAgent
   - è¶…æ—¶æ§åˆ¶ï¼š20ç§’è¶…æ—¶é™çº§
   - å¼‚å¸¸å¤„ç†ï¼šæ•è·å•ä¸ªAgentå¤±è´¥ï¼Œä¸å½±å“å…¶ä»–

5. **ç»“æœèšåˆ**
   - æƒ…æ„Ÿåˆ†æï¼šä½¿ç”¨AssistantAgentç»“æœ
   - æ•…éšœè¯Šæ–­ï¼šä½¿ç”¨EngineerAgentç»“æœ
   - å›å¤å†…å®¹ï¼šä¼˜å…ˆä½¿ç”¨EngineerAgentï¼ˆæ›´ä¸“ä¸šï¼‰
   - ç½®ä¿¡åº¦ï¼šå–æœ€ä½å€¼ï¼ˆä¿å®ˆç­–ç•¥ï¼‰

#### å¤æ‚åº¦åˆ†æç®—æ³•

```python
def _analyze_complexity(msg: Msg) -> float:
    """
    åˆ†æè¯·æ±‚å¤æ‚åº¦ï¼ˆ0.0-1.0ï¼‰

    è€ƒè™‘å› ç´ ï¼š
    1. æ¶ˆæ¯é•¿åº¦ï¼ˆåŸºç¡€å¤æ‚åº¦ï¼‰
    2. é—®é¢˜æ•°é‡ï¼ˆå¤šé—®é¢˜æå‡å¤æ‚åº¦ï¼‰
    3. å¤æ‚å…³é”®è¯å¯†åº¦
    """
    words = len(msg.content.split())

    # åŸºç¡€å¤æ‚åº¦ï¼ˆåŸºäºé•¿åº¦ï¼‰
    base_complexity = min(1.0, words / 240)

    # é—®é¢˜æ•°é‡ï¼ˆå¤šé—®é¢˜æå‡å¤æ‚åº¦ï¼‰
    question_count = msg.content.count("?") + msg.content.count("ï¼Ÿ")
    question_factor = min(0.3, question_count * 0.1)

    # å¤æ‚å…³é”®è¯
    complex_keywords = ["ä¸ºä»€ä¹ˆ", "æ€ä¹ˆåŠ", "å¦‚ä½•", "èƒ½å¦", "å¯ä»¥å—"]
    complex_keyword_count = sum(1 for kw in complex_keywords if kw in msg.content)
    keyword_factor = min(0.2, complex_keyword_count * 0.1)

    return min(1.0, base_complexity + question_factor + keyword_factor)
```

#### æ‰§è¡Œæµç¨‹ç¤ºä¾‹

**åœºæ™¯1ï¼šæ•…éšœåœºæ™¯ï¼ˆParallelæ¨¡å¼ï¼‰**

```
ç”¨æˆ·æ¶ˆæ¯ï¼š"ç³»ç»ŸæŠ¥500é”™è¯¯ï¼Œæ— æ³•ç™»å½•"
    â†“
OrchestratorAgent.route()
    â†“
Step 1: åˆ†æè¯·æ±‚
    â€¢ åœºæ™¯è¯†åˆ« â†’ fault
    â€¢ å¤æ‚åº¦ â†’ 0.6
    â€¢ æƒ…æ„Ÿ â†’ neutral
    â†“
Step 2: å†³ç­–æ‰§è¡Œæ¨¡å¼ â†’ parallel
    â†“
Step 3: å¹¶è¡Œæ‰§è¡Œ
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                   â–¼                   â–¼
AssistantAgent    EngineerAgent      (20ç§’è¶…æ—¶)
æƒ…æ„Ÿåˆ†æ           æ•…éšœè¯Šæ–­
éœ€æ±‚æå–           çŸ¥è¯†æ£€ç´¢
å›å¤ç”Ÿæˆ           æŠ€æœ¯æ–¹æ¡ˆ
    â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
Step 4: ç»“æœèšåˆ
    â€¢ æƒ…æ„Ÿ â†’ AssistantAgent
    â€¢ æ•…éšœè¯Šæ–­ â†’ EngineerAgent
    â€¢ å›å¤ â†’ EngineerAgentï¼ˆæ›´ä¸“ä¸šï¼‰
    â€¢ ç½®ä¿¡åº¦ â†’ min(0.92, 0.88) = 0.88
    â†“
è¿”å›èšåˆç»“æœç»™å‰ç«¯
```

**åœºæ™¯2ï¼šæŠ•è¯‰åœºæ™¯ï¼ˆHumanFirstæ¨¡å¼ï¼‰**

```
ç”¨æˆ·æ¶ˆæ¯ï¼š"ä½ ä»¬æœåŠ¡å¤ªå·®äº†ï¼Œè¦æ±‚é€€æ¬¾ï¼"
    â†“
OrchestratorAgent.route()
    â†“
Step 1: åˆ†æè¯·æ±‚
    â€¢ åœºæ™¯è¯†åˆ« â†’ complaint
    â€¢ æƒ…æ„Ÿ â†’ negative
    â€¢ é£é™©ç­‰çº§ â†’ high
    â†“
Step 2: å†³ç­–æ‰§è¡Œæ¨¡å¼ â†’ human_first
    â†“
Step 3: æ‰§è¡ŒHuman Firstæ¨¡å¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. æœç´¢çŸ¥è¯†åº“ï¼ˆFAQï¼‰       â”‚
    â”‚ 2. æ¨é€å»ºè®®åˆ°å‰ç«¯           â”‚
    â”‚ 3. è½¬äººå·¥å¤„ç†               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
äººå·¥å®¢æœæ¥ç®¡å¯¹è¯
```

#### å®¹é”™æœºåˆ¶

1. **Agentæ‰§è¡Œå¤±è´¥**
   - æ•è·å¼‚å¸¸ï¼Œè¿”å›é™çº§å›å¤
   - ä¸å½±å“å…¶ä»–Agentæ‰§è¡Œ

2. **å¹¶è¡Œæ‰§è¡Œè¶…æ—¶**
   - 20ç§’è¶…æ—¶é™åˆ¶
   - è¶…æ—¶åè¿”å›é™çº§å›å¤ï¼Œè½¬äººå·¥

3. **èšåˆç»“æœä¸ºç©º**
   - æ£€æŸ¥æœ‰æ•ˆç»“æœæ•°é‡
   - æ— æœ‰æ•ˆç»“æœæ—¶è¿”å›äººå·¥è½¬æ¥æ¶ˆæ¯

4. **MCPå·¥å…·è°ƒç”¨å¤±è´¥**
   - å·¥å…·è°ƒç”¨å¤±è´¥ä¸ä¸­æ–­Agentæ‰§è¡Œ
   - è¿”å›é™çº§æ•°æ®ï¼ˆå¦‚ç©ºåˆ—è¡¨ã€é»˜è®¤å€¼ï¼‰

#### å®ç°æ–‡ä»¶

- æ–‡ä»¶è·¯å¾„ï¼š`agentscope-service/src/router/orchestrator_agent.py`
- ä»£ç è¡Œæ•°ï¼š563è¡Œ
- ä¾èµ–ï¼š`asyncio`, `MsgHub`
- ç‰¹æ€§ï¼šå¼‚æ­¥ã€å¹¶è¡Œã€å®¹é”™

---

## ğŸ”„ å››ã€åä½œæœºåˆ¶

### 4.1 æ‰§è¡Œæ¨¡å¼è¯¦è§£

#### Simpleæ¨¡å¼

**é€‚ç”¨åœºæ™¯**ï¼š
- ç®€å•å’¨è¯¢
- å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰
- å¤æ‚åº¦<0.4

**æ‰§è¡Œæµç¨‹**ï¼š
```
ç”¨æˆ·æ¶ˆæ¯ â†’ AssistantAgent â†’ å›å¤
```

**ä¼˜ç‚¹**ï¼šå¿«é€Ÿã€æˆæœ¬ä½
**ç¼ºç‚¹**ï¼šèƒ½åŠ›å—é™ï¼Œåªèƒ½å¤„ç†ç®€å•é—®é¢˜

---

#### Parallelæ¨¡å¼

**é€‚ç”¨åœºæ™¯**ï¼š
- æ•…éšœè¯Šæ–­
- éœ€è¦å¤šç»´åº¦åˆ†æ

**æ‰§è¡Œæµç¨‹**ï¼š
```
ç”¨æˆ·æ¶ˆæ¯
    â†“
  â”Œâ”€â”´â”€â”
  â–¼   â–¼
Assistant Engineer
  â”‚   â”‚
  â””â”€â”¬â”€â”˜
    â–¼
ç»“æœèšåˆ â†’ å›å¤
```

**ä¼˜ç‚¹**ï¼š
- å“åº”é€Ÿåº¦å¿«ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
- ç»“æœæ›´å…¨é¢ï¼ˆå¤šAgentè§†è§’ï¼‰

**ç¼ºç‚¹**ï¼š
- æˆæœ¬è¾ƒé«˜ï¼ˆè°ƒç”¨2ä¸ªAgentï¼‰
- èšåˆé€»è¾‘å¤æ‚

**å®ç°ç»†èŠ‚**ï¼š
- ä½¿ç”¨`asyncio.gather`å¹¶è¡Œæ‰§è¡Œ
- 20ç§’è¶…æ—¶ä¿æŠ¤
- å¼‚å¸¸ä¸å½±å“å…¶ä»–Agent

---

#### Supervisedæ¨¡å¼

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¸­é«˜å¤æ‚åº¦é—®é¢˜ï¼ˆ0.4-0.7ï¼‰
- éœ€è¦äººå·¥å®¡æ ¸çš„åœºæ™¯

**æ‰§è¡Œæµç¨‹**ï¼š
```
ç”¨æˆ·æ¶ˆæ¯ â†’ Agentç”Ÿæˆå›å¤ â†’ æ£€æŸ¥ç½®ä¿¡åº¦
                             â†“
                    ç½®ä¿¡åº¦<0.7ï¼Ÿ
                    â”Œâ”€â”€â”€Yesâ”€â”€â”€â”    No
                    â–¼         â†“    â†“
               äººå·¥å®¡æ ¸       ç›´æ¥è¿”å›
                    â”‚
            ä¿®æ”¹æˆ–ç¡®è®¤
                    â†“
               æœ€ç»ˆå›å¤
```

**ä¼˜ç‚¹**ï¼š
- è´¨é‡æœ‰ä¿éšœï¼ˆäººå·¥å®¡æ ¸ï¼‰
- æå‡Agentå‡†ç¡®ç‡

**ç¼ºç‚¹**ï¼š
- å“åº”è¾ƒæ…¢ï¼ˆéœ€è¦äººå·¥ä»‹å…¥ï¼‰
- äººå·¥æˆæœ¬

**å®ç°ç»†èŠ‚**ï¼š
- ä½¿ç”¨`MsgHub`åè°ƒAgentå’ŒHuman
- ä½ç½®ä¿¡åº¦æ¨é€å®¡æ ¸è¯·æ±‚åˆ°å‰ç«¯
- äººå·¥ç¡®è®¤æˆ–ä¿®æ”¹åè¿”å›

---

#### HumanFirstæ¨¡å¼

**é€‚ç”¨åœºæ™¯**ï¼š
- é«˜é£é™©å®¢æˆ·
- VIPå®¢æˆ·
- æŠ•è¯‰åœºæ™¯
- è´Ÿé¢æƒ…ç»ª

**æ‰§è¡Œæµç¨‹**ï¼š
```
ç”¨æˆ·æ¶ˆæ¯ â†’ æœç´¢çŸ¥è¯†åº“ï¼ˆå»ºè®®ï¼‰ â†’ æ¨é€åˆ°å‰ç«¯ â†’ äººå·¥å¤„ç†
```

**ä¼˜ç‚¹**ï¼š
- æœåŠ¡è´¨é‡æœ€é«˜
- å®¢æˆ·ä½“éªŒå¥½

**ç¼ºç‚¹**ï¼š
- å®Œå…¨ä¾èµ–äººå·¥
- æˆæœ¬æœ€é«˜

**å®ç°ç»†èŠ‚**ï¼š
- Agentåªæä¾›çŸ¥è¯†åº“å»ºè®®
- ä¸ç”Ÿæˆè‡ªåŠ¨å›å¤
- ç«‹å³è½¬äººå·¥å®¢æœ

---

### 4.2 äº‹ä»¶é©±åŠ¨è´¨æ£€æµç¨‹

#### è´¨æ£€å¼‚æ­¥åŒ–æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend: ç”¨æˆ·ç‚¹å‡»"ç»“æŸå¯¹è¯"                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP POST /api/conversations/:id/close
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend: CloseConversationUseCase                        â”‚
â”‚  1. conversation.close() â†’ åˆ›å»ºConversationClosedEvent    â”‚
â”‚  2. conversationRepository.save()                         â”‚
â”‚  3. eventBus.publish(ConversationClosedEvent)             â”‚
â”‚  4. ç«‹å³è¿”å›æˆåŠŸå“åº” âœ… (ä¸ç­‰å¾…è´¨æ£€)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ EventBus (å†…å­˜å‘å¸ƒ/è®¢é˜…)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ConversationTaskCoordinator (äº‹ä»¶è®¢é˜…è€…)                 â”‚
â”‚  private async handleConversationClosed(event) {          â”‚
â”‚    // å¼‚æ­¥è§¦å‘è´¨æ£€ï¼Œä¸é˜»å¡å¯¹è¯å…³é—­                         â”‚
â”‚    const inspectUrl = `${agentscopeUrl}/api/agents/inspect`â”‚
â”‚    await fetch(inspectUrl, {                              â”‚
â”‚      method: 'POST',                                       â”‚
â”‚      body: JSON.stringify({ conversation_id: event.id })  â”‚
â”‚    })                                                      â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AgentScope: POST /api/agents/inspect                     â”‚
â”‚  async def inspect_conversation(request):                 â”‚
â”‚    inspector_agent = agent_manager.get("inspector_agent") â”‚
â”‚    report = await inspector_agent.inspect_conversation(   â”‚
â”‚      request.conversation_id                              â”‚
â”‚    )                                                       â”‚
â”‚    return { success: true, quality_score: report.score }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  InspectorAgent.inspect_conversation()                    â”‚
â”‚  1. è·å–å¯¹è¯å†å² (getConversationHistory)                 â”‚
â”‚  2. LLMè´¨æ£€åˆ†æ (8è½®ReActè¿­ä»£)                            â”‚
â”‚  3. ç”Ÿæˆè´¨æ£€æŠ¥å‘Š (JSONç»“æ„åŒ–è¾“å‡º)                         â”‚
â”‚  4. ä¿å­˜æŠ¥å‘Š (saveQualityReport)                          â”‚
â”‚  5. åˆ›å»ºè°ƒç ” (createSurveyIfNeeded)                       â”‚
â”‚  6. åˆ›å»ºæ”¹è¿›ä»»åŠ¡ (createImprovementTaskIfNeeded)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è´¨æ£€æ‰§è¡Œè¯¦ç»†æµç¨‹

**Step 1: å¯¹è¯å…³é—­ï¼ˆç”¨æˆ·/ç³»ç»Ÿï¼‰**
```typescript
// backend/src/application/use-cases/CloseConversationUseCase.ts
async execute(conversationId: string): Promise<void> {
  const conversation = await this.conversationRepository.findById(conversationId);

  // å…³é—­å¯¹è¯
  conversation.close(); // åˆ›å»ºConversationClosedEvent
  await this.conversationRepository.save(conversation);

  // å‘å¸ƒäº‹ä»¶
  this.eventBus.publish(conversation.domainEvents);

  // ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…è´¨æ£€
}
```

**Step 2: äº‹ä»¶ç›‘å¬å™¨å¤„ç†ï¼ˆå¼‚æ­¥ï¼‰**
```typescript
// backend/src/application/services/ConversationTaskCoordinator.ts
constructor() {
  // è®¢é˜…ConversationClosedEvent
  this.eventBus.subscribe('ConversationClosed', this.handleConversationClosed.bind(this));
}

private async handleConversationClosed(event: ConversationClosedEvent): Promise<void> {
  try {
    // å¼‚æ­¥è°ƒç”¨AgentScopeè´¨æ£€API
    const response = await fetch(`${agentscopeUrl}/api/agents/inspect`, {
      method: 'POST',
      body: JSON.stringify({ conversation_id: event.conversationId }),
      signal: AbortSignal.timeout(30000), // 30ç§’è¶…æ—¶
    });

    const result = await response.json();

    // ä½åˆ†å‘Šè­¦
    if (result.quality_score < 70) {
      console.warn(`Low quality score: ${result.quality_score}`);
    }
  } catch (error) {
    // è´¨æ£€å¤±è´¥ä¸å½±å“å¯¹è¯å…³é—­
    console.error('Quality inspection failed:', error);
  }
}
```

**Step 3: InspectorAgentæ‰§è¡Œè´¨æ£€**
```python
# agentscope-service/src/agents/inspector_agent.py
async def inspect_conversation(self, conversation_id: str) -> dict:
    # 1. è·å–å¯¹è¯å†å²
    history = await self.get_conversation_history(conversation_id)

    # 2. æ„é€ è´¨æ£€æ¶ˆæ¯
    inspect_msg = Msg(
        name="system",
        content=f"è¯·å¯¹ä»¥ä¸‹å¯¹è¯è¿›è¡Œè´¨æ£€è¯„åˆ†ï¼š\n\n{history_text}",
        role="system"
    )

    # 3. Agentæ‰§è¡Œè´¨æ£€ï¼ˆReActå¾ªç¯ï¼Œæœ€å¤š8è½®ï¼‰
    result = await self.reply(inspect_msg)
    report = json.loads(result.content)

    # 4. ä¿å­˜è´¨æ£€æŠ¥å‘Š
    await self.save_quality_report(conversation_id, report)

    # 5. åç»­åŠ¨ä½œ
    if report["need_follow_up"]:
        await self.create_survey_if_needed(...)

    if report["quality_score"] < 70:
        await self.create_improvement_task_if_needed(...)

    return report
```

#### å®¹é”™è®¾è®¡

1. **è´¨æ£€å¤±è´¥ä¸å½±å“å¯¹è¯å…³é—­**
   - è´¨æ£€åœ¨äº‹ä»¶å¤„ç†å™¨ä¸­å¼‚æ­¥æ‰§è¡Œ
   - `try-catch`æ•è·å¼‚å¸¸ï¼Œè®°å½•æ—¥å¿—
   - å¯¹è¯å…³é—­æµç¨‹ä¸å—å½±å“

2. **è¶…æ—¶ä¿æŠ¤**
   - HTTPè¯·æ±‚30ç§’è¶…æ—¶
   - InspectorAgent 8è½®ReActè¿­ä»£é™åˆ¶

3. **é™çº§ç­–ç•¥**
   - è´¨æ£€å¤±è´¥è¿”å›é»˜è®¤æŠ¥å‘Šï¼ˆè´¨é‡åˆ†0åˆ†ï¼‰
   - ä¸åˆ›å»ºè°ƒç ”å’Œæ”¹è¿›ä»»åŠ¡

4. **å¹‚ç­‰æ€§ä¿è¯**
   - conversation_idå”¯ä¸€
   - é‡å¤è´¨æ£€è¦†ç›–æ—§æŠ¥å‘Š

---

## ğŸ› ï¸ äº”ã€æŠ€æœ¯å®ç°

### 5.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **Frontend** | React | 18.x | UIç•Œé¢ |
| **Frontend** | TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| **Backend** | Node.js | 20.x | åç«¯æœåŠ¡ |
| **Backend** | TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| **Backend** | Clean Architecture | - | æ¶æ„æ¨¡å¼ |
| **AgentScope** | Python | 3.11 | AgentæœåŠ¡ |
| **AgentScope** | FastAPI | 0.104 | APIæ¡†æ¶ |
| **AgentScope** | AgentScope | 0.0.5 | Agentæ¡†æ¶ |
| **LLM** | DeepSeek v3 | - | æ¨ç†å¼•æ“ |
| **Database** | PostgreSQL | 15.x | å…³ç³»æ•°æ®åº“ |
| **Cache** | Redis | 7.x | ç¼“å­˜ |

---

### 5.2 MCPå·¥å…·é›†æˆ

MCPï¼ˆModel Context Protocolï¼‰æ˜¯Agentè°ƒç”¨åç«¯æœåŠ¡çš„æ¡¥æ¢ã€‚

#### MCPæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent (Python)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AssistantAgent / EngineerAgent / InspectorAgent  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  BackendMCPClient (Python)                        â”‚ â”‚
â”‚  â”‚  â€¢ å°è£…HTTPè¯·æ±‚                                   â”‚ â”‚
â”‚  â”‚  â€¢ å·¥å…·æ³¨å†Œ                                       â”‚ â”‚
â”‚  â”‚  â€¢ å¼‚å¸¸å¤„ç†                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTP POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend MCP Server (Node.js/TypeScript)                 â”‚
â”‚  â€¢ /mcp/tools/analyzeConversation                        â”‚
â”‚  â€¢ /mcp/tools/searchKnowledge                            â”‚
â”‚  â€¢ /mcp/tools/getCustomerProfile                         â”‚
â”‚  â€¢ /mcp/tools/createTask                                 â”‚
â”‚  â€¢ ...                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¯ç”¨MCPå·¥å…·

| å·¥å…·åç§° | åŠŸèƒ½ | ä½¿ç”¨Agent | è¾“å…¥ | è¾“å‡º |
|---------|------|----------|------|------|
| **analyzeConversation** | æƒ…æ„Ÿåˆ†æ | Assistant | conversationId, context | sentiment, riskLevel, score |
| **searchKnowledge** | çŸ¥è¯†åº“æ£€ç´¢ | Assistant, Engineer | query, filters, mode | knowledge results |
| **getCustomerProfile** | å®¢æˆ·ç”»åƒ | Assistant | customerId | customer profile |
| **getConversationHistory** | å¯¹è¯å†å² | Inspector | conversationId, includeMetadata | conversation messages |
| **createTask** | åˆ›å»ºå·¥å• | Engineer, Inspector | title, priority, conversationId | taskId |
| **createSurvey** | åˆ›å»ºè°ƒç ” | Inspector | customerId, questions | surveyId |
| **saveQualityReport** | ä¿å­˜è´¨æ£€æŠ¥å‘Š | Inspector | conversationId, report | success |
| **searchTickets** | å·¥å•æ£€ç´¢ | Engineer | query, limit | tickets |

#### MCPå·¥å…·ç¤ºä¾‹

```python
# agentscope-service/src/tools/mcp_tools.py
class BackendMCPClient:
    async def call_tool(self, tool_name: str, **kwargs) -> Any:
        """
        è°ƒç”¨MCPå·¥å…·

        Args:
            tool_name: å·¥å…·åç§°
            **kwargs: å·¥å…·å‚æ•°

        Returns:
            å·¥å…·è¿”å›ç»“æœ
        """
        url = f"{self.base_url}/mcp/tools/{tool_name}"

        async with httpx.AsyncClient() as client:
            response = await client.post(
                url,
                json=kwargs,
                timeout=10.0
            )

            if response.status_code != 200:
                raise Exception(f"MCP tool call failed: {response.text}")

            return response.json()
```

---

### 5.3 å®¹é”™ä¸é™çº§

#### é™çº§ç­–ç•¥çŸ©é˜µ

| æ•…éšœç‚¹ | é™çº§ç­–ç•¥ | å½±å“ | ä¼˜å…ˆçº§ |
|--------|---------|------|--------|
| **LLM APIè¶…æ—¶** | è¿”å›é™çº§å›å¤ï¼Œè½¬äººå·¥ | å•æ¬¡å¯¹è¯ | P1 |
| **MCPå·¥å…·å¤±è´¥** | è¿”å›ç©ºæ•°æ®/é»˜è®¤å€¼ï¼Œç»§ç»­æ‰§è¡Œ | Agentèƒ½åŠ›ä¸‹é™ | P2 |
| **å¹¶è¡Œæ‰§è¡Œè¶…æ—¶** | è¿”å›é™çº§å›å¤ï¼Œè½¬äººå·¥ | å•æ¬¡å¯¹è¯ | P1 |
| **è´¨æ£€å¤±è´¥** | è®°å½•æ—¥å¿—ï¼Œä¸å½±å“å¯¹è¯å…³é—­ | è´¨æ£€è¦†ç›–ç‡ä¸‹é™ | P3 |
| **æ•°æ®åº“æ•…éšœ** | ä½¿ç”¨ç¼“å­˜ï¼Œè½¬äººå·¥ | ç³»ç»Ÿä¸å¯ç”¨ | P0 |

#### é™çº§å®ç°ç¤ºä¾‹

**1. LLM APIè¶…æ—¶é™çº§**
```python
try:
    response = await self.assistant_agent(msg)
except asyncio.TimeoutError:
    # é™çº§ï¼šè¿”å›äººå·¥è½¬æ¥æ¶ˆæ¯
    return Msg(
        name="System",
        content="æŠ±æ­‰ï¼Œç³»ç»Ÿå¤„ç†è¶…æ—¶ï¼Œå·²è½¬äººå·¥å®¢æœå¤„ç†ã€‚",
        role="assistant",
        metadata={"confidence": 0.0, "escalated": True}
    )
```

**2. MCPå·¥å…·å¤±è´¥é™çº§**
```python
try:
    sentiment = await self.mcp_client.call_tool("analyzeConversation", ...)
except Exception:
    # é™çº§ï¼šè¿”å›ä¸­æ€§æƒ…æ„Ÿ
    sentiment = {
        "sentiment": "neutral",
        "score": 0.7,
        "risk_level": "low"
    }
```

**3. å¹¶è¡Œæ‰§è¡Œå¼‚å¸¸éš”ç¦»**
```python
results = await asyncio.gather(
    self.assistant_agent(msg),
    self.engineer_agent(msg),
    return_exceptions=True  # æ•è·å¼‚å¸¸ï¼Œä¸ä¸­æ–­å…¶ä»–ä»»åŠ¡
)

# è¿‡æ»¤æœ‰æ•ˆç»“æœ
valid_results = [r for r in results if not isinstance(r, Exception)]
```

---

## ğŸ“Š å…­ã€æ€§èƒ½ä¸ç›‘æ§

### 6.1 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | ç›‘æ§æ–¹å¼ |
|------|-------|--------|---------|
| **å¯¹è¯å…³é—­å»¶è¿Ÿ** | <500ms | 300ms | æ—¥å¿—ç»Ÿè®¡ |
| **è´¨æ£€æ‰§è¡Œæ—¶é—´** | <10s | 8s | APIå“åº”æ—¶é—´ |
| **å¹¶è¡Œæ‰§è¡Œæ—¶é—´** | <20s | 15s | asyncioè¶…æ—¶ç›‘æ§ |
| **LLMå“åº”æ—¶é—´** | <5s | 3.5s | DeepSeek APIç›‘æ§ |
| **MCPå·¥å…·å»¶è¿Ÿ** | <1s | 0.5s | HTTPå“åº”æ—¶é—´ |

---

### 6.2 ç›‘æ§æŒ‡æ ‡

#### Agentæ‰§è¡Œç›‘æ§

- Agentè°ƒç”¨æ¬¡æ•°ï¼ˆæŒ‰ç±»å‹ç»Ÿè®¡ï¼‰
- Agentå¹³å‡å“åº”æ—¶é—´
- AgentæˆåŠŸç‡/å¤±è´¥ç‡
- ç½®ä¿¡åº¦åˆ†å¸ƒ

#### è´¨æ£€ç›‘æ§

- è´¨æ£€è§¦å‘æ¬¡æ•°
- è´¨æ£€æˆåŠŸç‡
- å¹³å‡è´¨é‡åˆ†
- ä½åˆ†å¯¹è¯æ•°é‡ï¼ˆ<70åˆ†ï¼‰

#### é™çº§ç›‘æ§

- é™çº§è§¦å‘æ¬¡æ•°ï¼ˆæŒ‰ç±»å‹ï¼‰
- äººå·¥è½¬æ¥ç‡
- è¶…æ—¶æ¬¡æ•°

---

## ğŸ“ ä¸ƒã€ç»éªŒæ€»ç»“

### 7.1 åšå¾—å¥½çš„åœ°æ–¹

1. âœ… **ä¸“ä¸šåˆ†å·¥æå‡æœåŠ¡è´¨é‡**
   - 3ä¸ªç‹¬ç«‹Agentå„å¸å…¶èŒ
   - æ•…éšœè§£å†³ç‡æå‡30%+

2. âœ… **å¹¶è¡Œæ‰§è¡Œæå‡å“åº”é€Ÿåº¦**
   - æ•…éšœåœºæ™¯ä¸‹Assistant+Engineerå¹¶è¡Œ
   - å“åº”æ—¶é—´å‡å°‘50%

3. âœ… **è´¨æ£€å¼‚æ­¥åŒ–ä¸é˜»å¡ä¸»æµç¨‹**
   - äº‹ä»¶é©±åŠ¨æ¶æ„
   - å¯¹è¯å…³é—­å»¶è¿Ÿ<500ms

4. âœ… **å®¹é”™æœºåˆ¶å®Œå–„**
   - è´¨æ£€å¤±è´¥ä¸å½±å“å¯¹è¯å…³é—­
   - Agentå¤±è´¥è‡ªåŠ¨é™çº§

---

### 7.2 é‡åˆ°çš„æŒ‘æˆ˜

1. âš ï¸ **ç»“æœèšåˆé€»è¾‘å¤æ‚**
   - é—®é¢˜ï¼šå¤šAgentè¿”å›JSONï¼Œéœ€è¦æ™ºèƒ½èšåˆ
   - è§£å†³ï¼šåˆ¶å®šæ˜ç¡®çš„èšåˆç­–ç•¥ï¼ˆæƒ…æ„Ÿç”¨Assistantï¼ŒæŠ€æœ¯ç”¨Engineerï¼‰

2. âš ï¸ **å¹¶è¡Œæ‰§è¡Œå¶å°”è¶…æ—¶**
   - é—®é¢˜ï¼šLLMæ¨ç†æ—¶é—´ä¸ç¨³å®šï¼Œå¶å°”>20ç§’
   - è§£å†³ï¼šå¢åŠ è¶…æ—¶ä¿æŠ¤ï¼Œé™çº§å¤„ç†

3. âš ï¸ **MCPå·¥å…·è°ƒè¯•å›°éš¾**
   - é—®é¢˜ï¼šPythonè°ƒç”¨Node.jsæœåŠ¡ï¼Œè·¨è¯­è¨€è°ƒè¯•éš¾
   - è§£å†³ï¼šå¢åŠ è¯¦ç»†æ—¥å¿—ï¼Œå·¥å…·å¤±è´¥è¿”å›é»˜è®¤å€¼

---

### 7.3 æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **Agentèƒ½åŠ›å¢å¼º**
   - å¢åŠ çŸ¥è¯†Agentï¼šä¸“é—¨è´Ÿè´£çŸ¥è¯†åº“ç®¡ç†
   - å¢åŠ ç¿»è¯‘Agentï¼šæ”¯æŒå¤šè¯­è¨€å®¢æœ

2. **æ™ºèƒ½è·¯ç”±ä¼˜åŒ–**
   - å¼•å…¥æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œæ›¿ä»£è§„åˆ™å¼•æ“
   - åŸºäºå†å²æ•°æ®è®­ç»ƒè·¯ç”±æ¨¡å‹

3. **è´¨æ£€èƒ½åŠ›æå‡**
   - å¢åŠ å¯¹è¯æ‘˜è¦åŠŸèƒ½
   - è‡ªåŠ¨è¯†åˆ«çŸ¥è¯†åº“ç¼ºå£

4. **ç›‘æ§å‘Šè­¦å®Œå–„**
   - å¢åŠ Prometheusç›‘æ§
   - ä½åˆ†å¯¹è¯è‡ªåŠ¨å‘Šè­¦

---

## ğŸ“š å…«ã€å‚è€ƒèµ„æ–™

### 8.1 æ¶æ„è®¾è®¡å‚è€ƒ

- [Multi-Agent Systems: A Modern Approach](https://www.multiagent.com/)
- [AgentScope Documentation](https://github.com/modelscope/agentscope)
- [Event-Driven Architecture Patterns](https://martinfowler.com/articles/201701-event-driven.html)

### 8.2 ç›¸å…³æ–‡æ¡£

- [PHASE_1_AGENTS_IMPLEMENTATION.md](./PHASE_1_AGENTS_IMPLEMENTATION.md) - Agentå®æ–½è¯¦æƒ…
- [PHASE_2_QUALITY_INSPECTION.md](./PHASE_2_QUALITY_INSPECTION.md) - è´¨æ£€å¼‚æ­¥åŒ–å®æ–½
- [API_REFERENCE.md](./API_REFERENCE.md) - AgentScope APIæ–‡æ¡£

---

## ğŸ“ é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| **Agent** | æ™ºèƒ½ä½“ï¼Œå…·æœ‰è‡ªä¸»å†³ç­–èƒ½åŠ›çš„è½¯ä»¶å®ä½“ |
| **ReAct** | Reasoning + Actingï¼Œæ¨ç†ä¸è¡ŒåŠ¨å¾ªç¯æ¡†æ¶ |
| **MCP** | Model Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®® |
| **OrchestratorAgent** | åè°ƒå™¨Agentï¼Œè´Ÿè´£å¤šAgentè°ƒåº¦ |
| **EventBus** | äº‹ä»¶æ€»çº¿ï¼Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯ä¸­é—´ä»¶ |
| **é™çº§ç­–ç•¥** | ç³»ç»Ÿæ•…éšœæ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ |

---

### B. å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| v1.0 | 2025-12-27 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´æ¶æ„è®¾è®¡ | After-Sales Team |

---

**æ–‡æ¡£ç»“æŸ**
