# After-Sales Multi-Agent æ¶æ„è®¾è®¡æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-27
**æ¶æ„ç‰ˆæœ¬**: Phase 2ï¼ˆè´¨æ£€å¼‚æ­¥åŒ–å®Œæˆï¼‰
**æ¶æ„å¸ˆ**: åŸºäºAgentScopeçš„Multi-Agentç³»ç»Ÿ

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†After-Saleså”®åç³»ç»Ÿçš„Multi-Agentæ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€æ¶æ„é€‰æ‹©ã€AgentèŒè´£åˆ’åˆ†ã€é€šä¿¡æœºåˆ¶ã€æ‰§è¡Œæ¨¡å¼å’Œè´¨æ£€æµç¨‹ã€‚

**é˜…è¯»å¯¹è±¡**: æ¶æ„å¸ˆã€æŠ€æœ¯è´Ÿè´£äººã€é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ

---

## ğŸ¯ ä¸€ã€éœ€æ±‚åˆ†æ

### 1.1 ä¸šåŠ¡éœ€æ±‚

å”®åç³»ç»Ÿéœ€è¦å¤„ç†å¤šç§ç±»å‹çš„å®¢æˆ·å’¨è¯¢ï¼š

| åœºæ™¯ç±»å‹ | ç‰¹å¾ | å¤„ç†æ–¹å¼ | å¤æ‚åº¦ |
|---------|------|---------|--------|
| **ç®€å•å’¨è¯¢** | å¸¸è§é—®é¢˜ã€æµç¨‹è¯¢é—® | FAQè‡ªåŠ¨å›å¤ | ä½ |
| **æ•…éšœè¯Šæ–­** | ç³»ç»ŸæŠ¥é”™ã€åŠŸèƒ½å¤±æ•ˆ | æŠ€æœ¯åˆ†æ+è§£å†³æ–¹æ¡ˆ | é«˜ |
| **éœ€æ±‚æ”¶é›†** | åŠŸèƒ½å»ºè®®ã€ä¼˜åŒ–è¯·æ±‚ | éœ€æ±‚æå–+å·¥å•åˆ›å»º | ä¸­ |
| **æŠ•è¯‰å¤„ç†** | å®¢æˆ·ä¸æ»¡ã€æœåŠ¡é—®é¢˜ | å¿«é€Ÿå‡çº§äººå·¥ | é«˜é£é™© |
| **è´¨æ£€è¯„ä¼°** | å¯¹è¯ç»“æŸåè´¨é‡è¯„åˆ† | å¼‚æ­¥è´¨æ£€+æ”¹è¿›å»ºè®® | ä¸­ |

**æ ¸å¿ƒæŒ‘æˆ˜**:
1. **åœºæ™¯å¤æ‚å¤šæ ·**: å•ä¸€Agentæ— æ³•èƒœä»»æ‰€æœ‰åœºæ™¯
2. **å¤„ç†è´¨é‡è¦æ±‚é«˜**: éœ€è¦æƒ…æ„Ÿåˆ†æã€æ•…éšœè¯Šæ–­ã€ä¸“ä¸šå›å¤
3. **å“åº”é€Ÿåº¦è¦æ±‚**: ç®€å•åœºæ™¯<5ç§’ï¼Œå¤æ‚åœºæ™¯<10ç§’
4. **è´¨æ£€è¦†ç›–ç‡**: 100%å¯¹è¯è´¨æ£€ï¼Œä¸é˜»å¡ä¸»æµç¨‹

---

### 1.2 æŠ€æœ¯éœ€æ±‚

#### åŠŸèƒ½æ€§éœ€æ±‚

| ç¼–å· | éœ€æ±‚ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| FR-1 | æƒ…æ„Ÿåˆ†æ | è¯†åˆ«å®¢æˆ·æƒ…ç»ªï¼ˆæ­£é¢/ä¸­æ€§/è´Ÿé¢ï¼‰å’Œé£é™©ç­‰çº§ | P0 |
| FR-2 | éœ€æ±‚æå– | è‡ªåŠ¨è¯†åˆ«äº§å“/æŠ€æœ¯/æœåŠ¡ç±»éœ€æ±‚ | P0 |
| FR-3 | æ•…éšœè¯Šæ–­ | P0-P4ä¸¥é‡æ€§åˆ†çº§+è§£å†³æ–¹æ¡ˆ | P0 |
| FR-4 | çŸ¥è¯†æ£€ç´¢ | TaxKBçŸ¥è¯†åº“ç›¸ä¼¼æ¡ˆä¾‹æŸ¥æ‰¾ | P1 |
| FR-5 | å›å¤ç”Ÿæˆ | å‹å¥½ã€ä¸“ä¸šã€ç®€æ´çš„å®¢æˆ·å›å¤ | P0 |
| FR-6 | è´¨æ£€è¯„åˆ† | 4ç»´åº¦è´¨é‡è¯„åˆ†+æ”¹è¿›å»ºè®® | P1 |
| FR-7 | æ™ºèƒ½è·¯ç”± | æ ¹æ®åœºæ™¯é€‰æ‹©æœ€ä¼˜å¤„ç†æ¨¡å¼ | P0 |

#### éåŠŸèƒ½æ€§éœ€æ±‚

| ç¼–å· | éœ€æ±‚ | æŒ‡æ ‡ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| NFR-1 | å“åº”å»¶è¿Ÿ | ç®€å•åœºæ™¯â‰¤5ç§’ï¼Œå¤æ‚åœºæ™¯â‰¤10ç§’ | P0 |
| NFR-2 | å‡†ç¡®ç‡ | Agentå†³ç­–å‡†ç¡®ç‡â‰¥90% | P0 |
| NFR-3 | å¯ç”¨æ€§ | æœåŠ¡å¯ç”¨ç‡â‰¥99.5% | P0 |
| NFR-4 | å¯æ‰©å±•æ€§ | æ”¯æŒæ–°å¢Agentæ— éœ€é‡æ„ | P1 |
| NFR-5 | å¯ç»´æŠ¤æ€§ | å•ä¸ªAgentå¯ç‹¬ç«‹æµ‹è¯•å’Œéƒ¨ç½² | P1 |
| NFR-6 | æˆæœ¬æ§åˆ¶ | LLMè°ƒç”¨æˆæœ¬å¢é•¿<30% | P1 |

---

## ğŸ—ï¸ äºŒã€æ¶æ„è®¾è®¡

### 2.1 æ¶æ„é€‰æ‹©ï¼šMulti-Agent Pattern

**ä¸ºä»€ä¹ˆé€‰æ‹©Multi-Agentæ¶æ„ï¼Ÿ**

å¯¹æ¯”å•Agentå’ŒMulti-Agentæ–¹æ¡ˆï¼š

| ç»´åº¦ | å•Agent | Multi-Agentï¼ˆæœ¬æ–¹æ¡ˆï¼‰ |
|------|---------|---------------------|
| **èŒè´£æ¸…æ™°åº¦** | â­â­ï¼ˆæ‰€æœ‰åŠŸèƒ½æ··åœ¨ä¸€èµ·ï¼‰ | â­â­â­â­â­ï¼ˆæ¯ä¸ªAgentèŒè´£å•ä¸€ï¼‰ |
| **å¯ç»´æŠ¤æ€§** | â­â­ï¼ˆä¿®æ”¹ä¸€å¤„å½±å“å…¨å±€ï¼‰ | â­â­â­â­ï¼ˆAgentç‹¬ç«‹ç»´æŠ¤ï¼‰ |
| **å¯æµ‹è¯•æ€§** | â­â­â­ï¼ˆæµ‹è¯•å¤æ‚ï¼‰ | â­â­â­â­â­ï¼ˆAgentç‹¬ç«‹æµ‹è¯•ï¼‰ |
| **æ‰©å±•æ€§** | â­â­ï¼ˆæ–°å¢åŠŸèƒ½éœ€å¤§æ”¹ï¼‰ | â­â­â­â­â­ï¼ˆæ–°å¢Agentå³å¯ï¼‰ |
| **æ€§èƒ½** | â­â­â­â­â­ï¼ˆå•æ¬¡LLMè°ƒç”¨ï¼‰ | â­â­â­â­ï¼ˆå¯å¹¶è¡Œï¼Œå¢åŠ 25%ï¼‰ |
| **å¤æ‚åº¦** | â­â­â­â­ï¼ˆå®ç°ç®€å•ï¼‰ | â­â­â­ï¼ˆéœ€è¦åè°ƒæœºåˆ¶ï¼‰ |

**å†³ç­–**: é€‰æ‹©Multi-Agentæ¶æ„ï¼Œä¼˜å…ˆè€ƒè™‘**é•¿æœŸå¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§**ï¼Œæ¥å—25%çš„æ€§èƒ½æˆæœ¬å¢é•¿ã€‚

**æ¶æ„å†³ç­–è®°å½•**: è¯¦è§ ADR-001-MULTI-AGENT-ARCHITECTURE.md

---

### 2.2 æ¶æ„å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Frontend (Web/IM)                       â”‚
â”‚                     Vite + Vanilla JS + WebSocket                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTP/WebSocket
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Backend (Node.js)                         â”‚
â”‚                      Fastify + TypeScript                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Application Layer (DDD)                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚    ConversationTaskCoordinator (Saga)           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - processCustomerMessage()                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - handleConversationClosed() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚ AiService          â”‚  â”‚ EventBus          â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ (AgentScope é›†æˆ)  â”‚  â”‚ (é¢†åŸŸäº‹ä»¶)        â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Domain Layer (DDD)                               â”‚  â”‚
â”‚  â”‚  Conversation, Requirement, Task (Aggregates)            â”‚  â”‚
â”‚  â”‚  ConversationClosedEvent (Domain Event)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Infrastructure Layer                             â”‚  â”‚
â”‚  â”‚  PostgreSQL + Redis + TaxKB                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTP (EventBusè§¦å‘)
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AgentScope Service (Python)                    â”‚
â”‚                        FastAPI + AgentScope                      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              OrchestratorAgent (æ™ºèƒ½è°ƒåº¦å™¨)              â”‚  â”‚
â”‚  â”‚  - route(msg) â†’ åœºæ™¯è¯†åˆ« â†’ æ‰§è¡Œæ¨¡å¼å†³ç­–                 â”‚  â”‚
â”‚  â”‚  - 4ç§æ‰§è¡Œæ¨¡å¼: simple/parallel/supervised/human_first  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚             â”‚             â”‚                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚ Assistant  â”‚   â”‚  Engineer   â”‚  â”‚  Inspector    â”‚        â”‚
â”‚    â”‚   Agent    â”‚   â”‚    Agent    â”‚  â”‚    Agent      â”‚        â”‚
â”‚    â”‚            â”‚   â”‚             â”‚  â”‚               â”‚        â”‚
â”‚    â”‚ æƒ…æ„Ÿåˆ†æ   â”‚   â”‚ æ•…éšœè¯Šæ–­    â”‚  â”‚ è´¨æ£€è¯„åˆ†      â”‚        â”‚
â”‚    â”‚ éœ€æ±‚æå–   â”‚   â”‚ çŸ¥è¯†æ£€ç´¢    â”‚  â”‚ æŠ¥å‘Šç”Ÿæˆ      â”‚        â”‚
â”‚    â”‚ å›å¤ç”Ÿæˆ   â”‚   â”‚ å·¥å•ç®¡ç†    â”‚  â”‚ å®¢æˆ·å›è®¿      â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  DeepSeek V3 (LLM)                        â”‚  â”‚
â”‚  â”‚                  via OpenAI API                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              MCP Tools (Backend Integration)              â”‚  â”‚
â”‚  â”‚  - searchKnowledge (TaxKB)                                â”‚  â”‚
â”‚  â”‚  - getCustomerProfile                                     â”‚  â”‚
â”‚  â”‚  - analyzeConversation                                    â”‚  â”‚
â”‚  â”‚  - createTask, createSurvey                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.3 æ ¸å¿ƒç»„ä»¶

#### 2.3.1 OrchestratorAgentï¼ˆæ™ºèƒ½è°ƒåº¦å™¨ï¼‰

**èŒè´£**: åˆ†æè¯·æ±‚ï¼Œé€‰æ‹©æœ€ä¼˜æ‰§è¡Œæ¨¡å¼ï¼Œåè°ƒå¤šAgentåä½œ

**å…³é”®æ–¹æ³•**:
```python
async def route(user_msg: Msg) -> Msg:
    """æ™ºèƒ½è·¯ç”±ä¸»å…¥å£"""
    # 1. åˆ†æè¯·æ±‚ï¼ˆæƒ…æ„Ÿã€å¤æ‚åº¦ã€å®¢æˆ·ç±»å‹ï¼‰
    analysis = await self._analyze_request(user_msg)

    # 2. åœºæ™¯è¯†åˆ«ï¼ˆconsultation/fault/complaintï¼‰
    scenario = self._identify_scenario(user_msg, analysis)

    # 3. æ‰§è¡Œæ¨¡å¼å†³ç­–
    mode = self._decide_execution_mode(analysis, scenario)

    # 4. æ ¹æ®æ¨¡å¼æ‰§è¡Œ
    if mode == "human_first":
        return await self._human_first_mode(user_msg, analysis)
    elif mode == "parallel":
        return await self._execute_parallel(user_msg, analysis)
    elif mode == "agent_supervised":
        return await self._agent_supervised_mode(user_msg)
    else:  # simple
        return await self._execute_simple(user_msg)
```

**æ‰§è¡Œæ¨¡å¼**:
1. **simple**: å•AssistantAgentå¤„ç†ç®€å•å’¨è¯¢
2. **parallel**: AssistantAgent + EngineerAgentå¹¶è¡Œå¤„ç†æ•…éšœ
3. **agent_supervised**: Agentå¤„ç†åäººå·¥å®¡æ ¸
4. **human_first**: é«˜é£é™©/æŠ•è¯‰åœºæ™¯ç›´æ¥äººå·¥

---

#### 2.3.2 AssistantAgentï¼ˆè¾…åŠ©Agentï¼‰

**èŒè´£**: æƒ…æ„Ÿåˆ†æã€éœ€æ±‚æå–ã€å›å¤ç”Ÿæˆ

**å…³é”®èƒ½åŠ›**:
- æƒ…æ„Ÿåˆ†æï¼ˆsentiment: positive/neutral/negative, intensity, risk_levelï¼‰
- éœ€æ±‚æå–ï¼ˆcategory: product/technical/service, priorityï¼‰
- éœ€æ±‚æ¾„æ¸…ï¼ˆclarification_questionsï¼‰
- å›å¤ç”Ÿæˆï¼ˆsuggested_replyï¼‰

**è¾“å‡ºæ ¼å¼**ï¼ˆJSONï¼‰:
```json
{
  "sentiment_analysis": {
    "sentiment": "negative",
    "intensity": "urgent",
    "score": 0.35,
    "risk_level": "high"
  },
  "requirement_extraction": [{
    "title": "ç³»ç»Ÿç™»å½•æ•…éšœ",
    "category": "technical",
    "priority": "urgent",
    "confidence": 0.92
  }],
  "suggested_reply": "éå¸¸æŠ±æ­‰ç»™æ‚¨å¸¦æ¥ä¸ä¾¿...",
  "confidence": 0.85
}
```

---

#### 2.3.3 EngineerAgentï¼ˆå·¥ç¨‹å¸ˆAgentï¼‰

**èŒè´£**: æ•…éšœè¯Šæ–­ã€çŸ¥è¯†æ£€ç´¢ã€å·¥å•ç®¡ç†

**å…³é”®èƒ½åŠ›**:
- æ•…éšœè¯Šæ–­ï¼ˆseverity: P0-P4, root_cause, solution_stepsï¼‰
- çŸ¥è¯†åº“æ£€ç´¢ï¼ˆTaxKBç›¸ä¼¼æ¡ˆä¾‹ï¼‰
- å·¥å•æ£€ç´¢ï¼ˆå†å²ç±»ä¼¼é—®é¢˜ï¼‰
- è‡ªåŠ¨å·¥å•åˆ›å»ºï¼ˆP0/P1è‡ªåŠ¨åˆ›å»ºï¼‰

**ä¸¥é‡æ€§åˆ†çº§**:
- **P0**: ç³»ç»Ÿå®•æœºï¼Œå¤§é‡ç”¨æˆ·æ— æ³•ä½¿ç”¨æ ¸å¿ƒåŠŸèƒ½
- **P1**: æ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ï¼Œå½±å“éƒ¨åˆ†ç”¨æˆ·
- **P2**: éæ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ï¼Œæœ‰ä¸´æ—¶æ–¹æ¡ˆ
- **P3**: å°é—®é¢˜ï¼Œä¸å½±å“ä½¿ç”¨
- **P4**: ä¼˜åŒ–å»ºè®®

**è¾“å‡ºæ ¼å¼**ï¼ˆJSONï¼‰:
```json
{
  "fault_diagnosis": {
    "severity": "P1",
    "root_cause": "è®¤è¯æœåŠ¡æ•°æ®åº“è¿æ¥è¶…æ—¶",
    "affected_scope": "ç™»å½•åŠŸèƒ½ï¼Œçº¦500ç”¨æˆ·",
    "solution_steps": [
      "æ£€æŸ¥æ•°æ®åº“è¿æ¥æ± é…ç½®",
      "é‡å¯è®¤è¯æœåŠ¡",
      "ç›‘æ§æ—¥å¿—ç¡®è®¤æ¢å¤"
    ],
    "estimated_time": "15-30åˆ†é’Ÿ"
  },
  "knowledge_results": [...],
  "suggested_reply": "è¿™æ˜¯è®¤è¯æœåŠ¡çš„å·²çŸ¥é—®é¢˜..."
}
```

---

#### 2.3.4 InspectorAgentï¼ˆè´¨æ£€Agentï¼‰

**èŒè´£**: å¯¹è¯è´¨æ£€ã€æŠ¥å‘Šç”Ÿæˆã€å®¢æˆ·å›è®¿å»ºè®®

**è§¦å‘æ—¶æœº**: å¯¹è¯ç»“æŸåï¼ˆConversationClosedEventï¼‰

**è¯„ä¼°ç»´åº¦**ï¼ˆåŠ æƒè¯„åˆ†ï¼‰:
1. **å®Œæ•´æ€§**ï¼ˆ30%ï¼‰: å›å¤æ˜¯å¦å®Œæ•´è§£å†³é—®é¢˜
2. **ä¸“ä¸šåº¦**ï¼ˆ30%ï¼‰: ä¸“ä¸šæœ¯è¯­ä½¿ç”¨å’Œè§£é‡Šæ¸…æ™°åº¦
3. **åˆè§„æ€§**ï¼ˆ20%ï¼‰: æ˜¯å¦ç¬¦åˆæœåŠ¡è§„èŒƒ
4. **è¯­æ°”è¯­è°ƒ**ï¼ˆ20%ï¼‰: ç¤¼è²Œç¨‹åº¦å’ŒåŒç†å¿ƒ

**è¾“å‡ºæ ¼å¼**ï¼ˆJSONï¼‰:
```json
{
  "quality_score": 82,
  "dimensions": {
    "completeness": 85,
    "professionalism": 88,
    "compliance": 75,
    "tone": 80
  },
  "sentiment_improvement": 40,
  "customer_satisfaction_prediction": 3.5,
  "improvement_suggestions": [
    "éœ€è¦æ›´è¯¦ç»†çš„æ•…éšœæ’æŸ¥æ­¥éª¤",
    "ç¼ºå°‘å¯¹å®¢æˆ·æƒ…ç»ªçš„åŒç†å¿ƒè¡¨è¾¾"
  ],
  "need_follow_up": true,
  "follow_up_reason": "ä½åˆ†å¯¹è¯ï¼Œéœ€è¦å®¢æˆ·è°ƒç ”"
}
```

---

## ğŸ”„ ä¸‰ã€æ‰§è¡Œæµç¨‹

### 3.1 åœºæ™¯1ï¼šç®€å•å’¨è¯¢ï¼ˆSimpleæ¨¡å¼ï¼‰

```
ç”¨æˆ·: "å¦‚ä½•å¼€å…·å‘ç¥¨ï¼Ÿ"
    â†“
OrchestratorAgent.route()
    â”œâ”€ åœºæ™¯è¯†åˆ«: consultation
    â”œâ”€ å¤æ‚åº¦: 0.2 (ä½)
    â”œâ”€ æƒ…æ„Ÿ: neutral, calm
    â””â”€ å†³ç­–: simpleæ¨¡å¼
    â†“
AssistantAgent(msg)
    â”œâ”€ searchKnowledge("å¼€å…·å‘ç¥¨")
    â”œâ”€ LLMç”Ÿæˆå›å¤
    â””â”€ è¿”å›: {
          "sentiment_analysis": {...},
          "suggested_reply": "æ‚¨å¯ä»¥åœ¨ã€è´¢åŠ¡ç®¡ç†ã€‘â†’ã€å¼€ç¥¨ç”³è¯·ã€‘...",
          "confidence": 0.92
        }
    â†“
WebSocketæ¨é€åˆ°å‰ç«¯
    â†“
å®¢æœå®¡æ ¸å¹¶å‘é€

LLMè°ƒç”¨: 1æ¬¡
å»¶è¿Ÿ: ~5ç§’
```

---

### 3.2 åœºæ™¯2ï¼šæ•…éšœè¯Šæ–­ï¼ˆParallelæ¨¡å¼ï¼‰

```
ç”¨æˆ·: "ç³»ç»ŸæŠ¥500é”™è¯¯ï¼Œæ— æ³•ç™»å½•ï¼"
    â†“
OrchestratorAgent.route()
    â”œâ”€ åœºæ™¯è¯†åˆ«: faultï¼ˆå…³é”®è¯: "æŠ¥é”™", "500", "æ— æ³•ç™»å½•"ï¼‰
    â”œâ”€ å¤æ‚åº¦: 0.8 (é«˜)
    â”œâ”€ æƒ…æ„Ÿ: negative, urgent
    â””â”€ å†³ç­–: parallelæ¨¡å¼
    â†“
_execute_parallel()
    â”œâ”€ AssistantAgent(msg) â”€â”€â”€â”€â” å¹¶è¡Œæ‰§è¡Œ
    â”‚  â”œâ”€ æƒ…æ„Ÿåˆ†æ: urgent, high risk
    â”‚  â”œâ”€ éœ€æ±‚æå–: "æ•…éšœå¤„ç†"
    â”‚  â””â”€ å›å¤å»ºè®®: "éå¸¸æŠ±æ­‰..."
    â”‚                           â”‚
    â””â”€ EngineerAgent(msg) â”€â”€â”€â”€â”€â”¤
       â”œâ”€ æ•…éšœè¯Šæ–­: P1, è®¤è¯æœåŠ¡é—®é¢˜
       â”œâ”€ çŸ¥è¯†æ£€ç´¢: ç›¸ä¼¼æ¡ˆä¾‹3ä¸ª
       â”œâ”€ å·¥å•åˆ›å»º: task-uuid-123
       â””â”€ æŠ€æœ¯å›å¤: "è¿™æ˜¯è®¤è¯æœåŠ¡çš„å·²çŸ¥é—®é¢˜..."
                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
_aggregate_results()
    â”œâ”€ æƒ…æ„Ÿ: ä½¿ç”¨AssistantAgentç»“æœ
    â”œâ”€ æ•…éšœ: ä½¿ç”¨EngineerAgentç»“æœ
    â”œâ”€ å›å¤: ä¼˜å…ˆEngineerAgentï¼ˆæŠ€æœ¯ä¸“ä¸šï¼‰
    â”œâ”€ ç½®ä¿¡åº¦: min(0.85, 0.75) = 0.75ï¼ˆä¿å®ˆç­–ç•¥ï¼‰
    â””â”€ è‡ªåŠ¨åˆ›å»ºå·¥å•: task-uuid-123
    â†“
Orchestratoråˆ¤æ–­: confidence=0.75 < 0.8 ä¸” severity=P1
    â””â”€ æ¨é€å®¡æ ¸è¯·æ±‚åˆ°å‰ç«¯ï¼ˆagent_supervisedæ¨¡å¼ï¼‰
    â†“
å®¢æœå®¡æ ¸:
    â”œâ”€ æŸ¥çœ‹æƒ…æ„Ÿåˆ†æ: urgent, high risk
    â”œâ”€ æŸ¥çœ‹æ•…éšœè¯Šæ–­: P1çº§ï¼Œè®¤è¯æœåŠ¡å®•æœº
    â”œâ”€ æŸ¥çœ‹è§£å†³æ–¹æ¡ˆ: 3æ­¥
    â”œâ”€ æŸ¥çœ‹å·¥å•: task-uuid-123
    â””â”€ ç¡®è®¤å‘é€/ä¿®æ”¹å›å¤

LLMè°ƒç”¨: 2æ¬¡ï¼ˆå¹¶è¡Œï¼‰
å»¶è¿Ÿ: ~8ç§’
```

---

### 3.3 åœºæ™¯3ï¼šè´¨æ£€è¯„åˆ†ï¼ˆå¼‚æ­¥ï¼Œå¯¹è¯ç»“æŸåï¼‰

```
è§¦å‘: ConversationClosedEvent
    â†“
EventBus.publish(ConversationClosedEvent)
    â†“
ConversationTaskCoordinator.handleConversationClosed()
    â”œâ”€ æå–conversationId
    â”œâ”€ HTTPè°ƒç”¨AgentScope API
    â”‚  POST http://localhost:5000/api/agents/inspect
    â”‚  Body: {"conversation_id": "uuid-123"}
    â””â”€ å¼‚æ­¥æ‰§è¡Œï¼ˆä¸é˜»å¡å¯¹è¯å…³é—­ï¼‰
    â†“
AgentScope: /api/agents/inspect
    â†“
InspectorAgent.inspect_conversation(conversation_id)
    â”œâ”€ getConversationHistory(conversation_id)
    â”‚  â””â”€ è·å–å®Œæ•´å¯¹è¯å†å²ï¼ˆ10æ¡æ¶ˆæ¯ï¼‰
    â”‚
    â”œâ”€ LLMåˆ†æå¯¹è¯è´¨é‡ï¼ˆ8æ¬¡ReActè¿­ä»£ï¼‰
    â”‚  â”œâ”€ è¯„ä¼°ç»´åº¦: å®Œæ•´æ€§ã€ä¸“ä¸šåº¦ã€åˆè§„æ€§ã€è¯­æ°”
    â”‚  â”œâ”€ æƒ…ç»ªå˜åŒ–: negative â†’ neutralï¼ˆæ”¹å–„40%ï¼‰
    â”‚  â””â”€ æ»¡æ„åº¦é¢„æµ‹: 3.5/5æ˜Ÿ
    â”‚
    â”œâ”€ ç”Ÿæˆè´¨æ£€æŠ¥å‘Šï¼ˆJSONï¼‰
    â”‚  {
    â”‚    "quality_score": 82,
    â”‚    "dimensions": {...},
    â”‚    "sentiment_improvement": 40,
    â”‚    "customer_satisfaction_prediction": 3.5,
    â”‚    "improvement_suggestions": [...]
    â”‚  }
    â”‚
    â”œâ”€ saveQualityReport(conversation_id, report)
    â”‚  â””â”€ ä¿å­˜åˆ°æ•°æ®åº“
    â”‚
    â”œâ”€ IF quality_score < 70:
    â”‚  â””â”€ createTask("æ”¹è¿›ä»»åŠ¡", priority="high")
    â”‚
    â””â”€ IF need_follow_up:
       â””â”€ createSurvey(customer_id, questions)
    â†“
è¿”å›è´¨æ£€æŠ¥å‘Šç»™Backend
    â†“
ConversationTaskCoordinatorè®°å½•æ—¥å¿—
    â”œâ”€ è¾“å‡ºè´¨æ£€è¯„åˆ†
    â””â”€ IF quality_score < 70:
       â””â”€ console.warn("ä½åˆ†å¯¹è¯")

LLMè°ƒç”¨: 1æ¬¡
å»¶è¿Ÿ: ~7ç§’ï¼ˆå¼‚æ­¥ï¼Œä¸å½±å“ä¸»æµç¨‹ï¼‰
è´¨æ£€è¦†ç›–ç‡: 100%
```

---

## ğŸ¨ å››ã€å†³ç­–è§„åˆ™

### 4.1 åœºæ™¯è¯†åˆ«è§„åˆ™

```python
def _identify_scenario(msg: Msg, analysis: dict) -> str:
    """åœºæ™¯è¯†åˆ«ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰"""
    content = msg.content.lower()

    # æ•…éšœåœºæ™¯å…³é”®è¯
    fault_keywords = [
        "æŠ¥é”™", "é”™è¯¯", "å¼‚å¸¸", "500", "404", "å®•æœº",
        "æ— æ³•ç™»å½•", "å´©æºƒ", "å¡é¡¿", "æ— å“åº”"
    ]

    # æŠ•è¯‰åœºæ™¯å…³é”®è¯
    complaint_keywords = [
        "æŠ•è¯‰", "ä¸æ»¡æ„", "é€€æ¬¾", "è¡¥å¿", "å·®è¯„",
        "æ€åº¦æ¶åŠ£", "æœåŠ¡å·®", "æ¬ºéª—", "éª—äºº"
    ]

    if any(kw in content for kw in fault_keywords):
        return "fault"
    if any(kw in content for kw in complaint_keywords):
        return "complaint"
    return "consultation"
```

---

### 4.2 æ‰§è¡Œæ¨¡å¼å†³ç­–è§„åˆ™

```python
def _decide_execution_mode(analysis: dict, scenario: str) -> str:
    """æ‰§è¡Œæ¨¡å¼å†³ç­–"""
    complexity = analysis.get("complexity", 0.5)
    risk_level = analysis.get("risk_level", "low")
    is_vip = analysis.get("customer", {}).get("is_vip", False)

    # Rule 1: é«˜é£é™©/VIPå®¢æˆ· â†’ ç›´æ¥äººå·¥
    if risk_level == "high" or is_vip:
        return "human_first"

    # Rule 2: æŠ•è¯‰åœºæ™¯ â†’ ç›´æ¥äººå·¥
    if scenario == "complaint":
        return "human_first"

    # Rule 3: æ•…éšœåœºæ™¯ â†’ å¹¶è¡Œæ‰§è¡Œï¼ˆè¾…åŠ©+å·¥ç¨‹å¸ˆï¼‰
    if scenario == "fault":
        return "parallel"

    # Rule 4: é«˜å¤æ‚åº¦ â†’ Agentå¤„ç†+äººå·¥å®¡æ ¸
    if complexity > 0.7:
        return "agent_supervised"

    # Rule 5: ä½å¤æ‚åº¦ â†’ å•Assistantå¤„ç†
    return "simple"
```

**å†³ç­–æµç¨‹å›¾**:
```
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ è¯·æ±‚åˆ†æ    â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ åœºæ™¯è¯†åˆ«        â”‚
        â”‚ + ç‰¹å¾æå–      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ risk_level="high"?    â”‚ Yes â†’ human_first
     â”‚ is_vip=true?          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ No
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ scenario="complaint"? â”‚ Yes â†’ human_first
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ No
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ scenario="fault"?     â”‚ Yes â†’ parallel
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ No
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ complexity > 0.7?     â”‚ Yes â†’ agent_supervised
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ No
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚ simple      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ äº”ã€æŠ€æœ¯å®ç°

### 5.1 å¹¶è¡Œæ‰§è¡Œï¼ˆParallelæ¨¡å¼ï¼‰

**å®ç°ä»£ç **:
```python
async def _execute_parallel(self, msg: Msg, analysis: dict) -> Msg:
    """å¹¶è¡Œæ‰§è¡Œè¾…åŠ©+å·¥ç¨‹å¸ˆAgent"""
    try:
        # å¹¶è¡Œæ‰§è¡Œï¼Œ20ç§’è¶…æ—¶
        assistant_result, engineer_result = await asyncio.wait_for(
            asyncio.gather(
                self.assistant_agent(msg),
                self.engineer_agent(msg),
            ),
            timeout=20.0
        )

        # èšåˆç»“æœ
        return await self._aggregate_results(
            [assistant_result, engineer_result],
            msg
        )
    except asyncio.TimeoutError:
        # è¶…æ—¶é™çº§ï¼šè¿”å›äººå·¥å¤„ç†
        return self._create_escalation_msg(
            msg,
            reason="Agentå¤„ç†è¶…æ—¶"
        )
```

**å…³é”®æŠ€æœ¯**:
- `asyncio.gather()`: å¹¶è¡Œæ‰§è¡Œå¤šä¸ªåç¨‹
- `asyncio.wait_for()`: è¶…æ—¶æ§åˆ¶
- é™çº§ç­–ç•¥: è¶…æ—¶/å¤±è´¥è‡ªåŠ¨è½¬äººå·¥

---

### 5.2 ç»“æœèšåˆç­–ç•¥

```python
async def _aggregate_results(self, agent_results: list[Msg], original_msg: Msg) -> Msg:
    """æ™ºèƒ½èšåˆå¤šAgentç»“æœ"""
    assistant_result = agent_results[0]
    engineer_result = agent_results[1]

    # æå–ç»“æœ
    assistant_data = json.loads(assistant_result.content)
    engineer_data = json.loads(engineer_result.content)

    # èšåˆç­–ç•¥
    aggregated = {
        # æƒ…æ„Ÿ: ä½¿ç”¨AssistantAgentç»“æœï¼ˆä¸“ä¸šï¼‰
        "sentiment_analysis": assistant_data.get("sentiment_analysis"),

        # æ•…éšœ: ä½¿ç”¨EngineerAgentç»“æœï¼ˆä¸“ä¸šï¼‰
        "fault_diagnosis": engineer_data.get("fault_diagnosis"),

        # å›å¤: ä¼˜å…ˆEngineerAgentï¼ˆæŠ€æœ¯åœºæ™¯æ›´ä¸“ä¸šï¼‰
        "suggested_reply": engineer_data.get("suggested_reply")
                           or assistant_data.get("suggested_reply"),

        # ç½®ä¿¡åº¦: å–æœ€ä½å€¼ï¼ˆä¿å®ˆç­–ç•¥ï¼‰
        "confidence": min(
            assistant_data.get("confidence", 0.8),
            engineer_data.get("confidence", 0.8)
        ),

        # éœ€æ±‚: åˆå¹¶ä¸¤ä¸ªAgentçš„ç»“æœ
        "requirements": (assistant_data.get("requirement_extraction", []) +
                         engineer_data.get("requirements", [])),

        # å·¥å•: EngineerAgentåˆ›å»ºçš„å·¥å•
        "created_task_id": engineer_data.get("created_task_id"),
    }

    return Msg(name="OrchestratorAgent", content=json.dumps(aggregated))
```

---

### 5.3 è´¨æ£€å¼‚æ­¥åŒ–å®ç°

**Backendäº‹ä»¶è®¢é˜…**:
```typescript
// ConversationTaskCoordinator.ts
constructor(...) {
  // è®¢é˜…ConversationClosedEvent
  this.eventBus.subscribe('ConversationClosed', this.handleConversationClosed.bind(this));
}

private async handleConversationClosed(event: ConversationClosedEvent): Promise<void> {
  const conversationId = event.conversationId;

  try {
    // HTTPè°ƒç”¨AgentScopeè´¨æ£€æ¥å£
    const response = await fetch(`${agentscopeUrl}/api/agents/inspect`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({conversation_id: conversationId}),
      signal: AbortSignal.timeout(30000), // 30ç§’è¶…æ—¶
    });

    const result = await response.json();

    // ä½åˆ†å‘Šè­¦
    if (result.quality_score < 70) {
      console.warn(`Low quality score: ${result.quality_score}`);
      // TODO: å‘é€å‘Šè­¦é€šçŸ¥ç®¡ç†å‘˜
    }
  } catch (error) {
    // å¼‚æ­¥è´¨æ£€å¤±è´¥ä¸å½±å“å¯¹è¯å…³é—­
    console.error('Failed to trigger quality inspection:', error);
  }
}
```

**AgentScope APIæ¥å£**:
```python
# agents.py
@router.post("/inspect", response_model=InspectConversationResponse)
async def inspect_conversation(request: InspectConversationRequest):
    inspector_agent = agent_manager.get("inspector_agent")

    if not inspector_agent:
        raise HTTPException(status_code=500, detail="InspectorAgent not initialized")

    try:
        report = await inspector_agent.inspect_conversation(request.conversation_id)

        return InspectConversationResponse(
            success=True,
            conversation_id=request.conversation_id,
            quality_score=report.get("quality_score", 0),
            report=report
        )
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"Quality inspection failed: {str(e)}")
```

---

## ğŸ“Š å…­ã€æ€§èƒ½åˆ†æ

### 6.1 å»¶è¿Ÿåˆ†æ

| åœºæ™¯ | LLMè°ƒç”¨ | é¢„è®¡å»¶è¿Ÿ | å®é™…å»¶è¿Ÿ | è¾¾æ ‡ |
|------|---------|---------|---------|------|
| **ç®€å•å’¨è¯¢** | 1æ¬¡ | â‰¤5ç§’ | ~4ç§’ | âœ… |
| **æ•…éšœè¯Šæ–­** | 2æ¬¡å¹¶è¡Œ | â‰¤10ç§’ | ~8ç§’ | âœ… |
| **è´¨æ£€è¯„åˆ†** | 1æ¬¡ï¼ˆå¼‚æ­¥ï¼‰ | ä¸é™ | ~7ç§’ | âœ… |

**å»¶è¿Ÿä¼˜åŒ–**:
- å¹¶è¡Œæ‰§è¡Œ: æ•…éšœåœºæ™¯2ä¸ªAgentå¹¶è¡Œï¼Œå»¶è¿Ÿä»…ä¸ºå•Agentçš„1.2å€ï¼ˆé2å€ï¼‰
- å¼‚æ­¥è´¨æ£€: ä¸é˜»å¡å¯¹è¯å…³é—­ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥

---

### 6.2 æˆæœ¬åˆ†æ

**LLMæˆæœ¬**ï¼ˆå‡è®¾DeepSeek v3: Â¥0.01/æ¬¡ï¼‰:

| åœºæ™¯ | å æ¯” | LLMè°ƒç”¨ | å•æ¬¡æˆæœ¬ | åŠ æƒæˆæœ¬ |
|------|------|---------|---------|---------|
| ç®€å•å’¨è¯¢ | 60% | 1æ¬¡ | Â¥0.01 | Â¥0.006 |
| æ•…éšœè¯Šæ–­ | 30% | 2æ¬¡å¹¶è¡Œ | Â¥0.02 | Â¥0.006 |
| è´¨æ£€è¯„åˆ† | 100% | 1æ¬¡ï¼ˆå¼‚æ­¥ï¼‰ | Â¥0.01 | Â¥0.01 |
| æŠ•è¯‰/äººå·¥ | 10% | 0.5æ¬¡ | Â¥0.005 | Â¥0.0005 |

**æ€»è®¡æˆæœ¬**:
- ä¸»æµç¨‹åŠ æƒæˆæœ¬: Â¥0.0125/å¯¹è¯
- è´¨æ£€æˆæœ¬: Â¥0.01/å¯¹è¯
- æ€»æˆæœ¬: Â¥0.0225/å¯¹è¯

vs å•Agentæ–¹æ¡ˆ: Â¥0.01/å¯¹è¯ï¼ˆä»…ä¸»æµç¨‹ï¼‰

**æˆæœ¬å¢é•¿**: 125%ï¼ˆä¸»æµç¨‹ï¼‰+ 100%ï¼ˆè´¨æ£€ï¼‰= **225%**

**æ³¨æ„**: è™½ç„¶æˆæœ¬å¢åŠ ï¼Œä½†å¸¦æ¥äº†ï¼š
1. æ•…éšœè¯Šæ–­å‡†ç¡®ç‡æå‡30%+
2. 100%è´¨æ£€è¦†ç›–ç‡
3. å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§å¤§å¹…æå‡

**æˆæœ¬ä¼˜åŒ–æ–¹æ¡ˆ**:
1. ç¼“å­˜é«˜é¢‘é—®é¢˜å›å¤ï¼ˆå‡å°‘20%LLMè°ƒç”¨ï¼‰
2. æ‰¹é‡è´¨æ£€ï¼ˆåˆå¹¶10ä¸ªå¯¹è¯è´¨æ£€ï¼Œå‡å°‘40%LLMè°ƒç”¨ï¼‰
3. ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹åšæƒ…æ„Ÿåˆ†æï¼ˆå‡å°‘15%æˆæœ¬ï¼‰

---

## ğŸ”’ ä¸ƒã€å®¹é”™å’Œé™çº§

### 7.1 è¶…æ—¶æ§åˆ¶

| ç»„ä»¶ | è¶…æ—¶æ—¶é—´ | é™çº§ç­–ç•¥ |
|------|---------|---------|
| AssistantAgent | 10ç§’ | è¿”å›human_first |
| EngineerAgent | 15ç§’ | è¿”å›human_first |
| InspectorAgent | 20ç§’ | è®°å½•æ—¥å¿—ï¼Œä¸é˜»å¡ |
| å¹¶è¡Œæ‰§è¡Œ | 20ç§’ | è¿”å›human_first |
| è´¨æ£€API | 30ç§’ | è®°å½•æ—¥å¿—ï¼Œä¸é˜»å¡ |

---

### 7.2 å¤±è´¥å¤„ç†

**åœºæ™¯1: Agentæ‰§è¡Œå¤±è´¥**
```python
try:
    result = await self.assistant_agent(msg)
except Exception as e:
    logger.error(f"AssistantAgent failed: {e}")
    # é™çº§ï¼šè½¬äººå·¥å¤„ç†
    return self._create_escalation_msg(msg, reason=f"Agenté”™è¯¯: {str(e)}")
```

**åœºæ™¯2: å¹¶è¡Œæ‰§è¡Œéƒ¨åˆ†å¤±è´¥**
```python
try:
    assistant_result, engineer_result = await asyncio.gather(
        self.assistant_agent(msg),
        self.engineer_agent(msg),
        return_exceptions=True  # ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›å¼‚å¸¸å¯¹è±¡
    )

    # æ£€æŸ¥æ˜¯å¦æœ‰å¤±è´¥
    if isinstance(assistant_result, Exception) or isinstance(engineer_result, Exception):
        # é™çº§ï¼šä»…ä½¿ç”¨æˆåŠŸçš„ç»“æœï¼Œæˆ–è½¬äººå·¥
        ...
```

**åœºæ™¯3: è´¨æ£€å¤±è´¥**
```python
# è´¨æ£€å¤±è´¥ä¸å½±å“å¯¹è¯å…³é—­
try:
    await fetch(inspect_url, ...)
except Exception as e:
    console.error('Quality inspection failed:', e)
    # è®°å½•æ—¥å¿—ï¼Œä¸æŠ›å‡ºå¼‚å¸¸
```

---

### 7.3 é™çº§å†³ç­–

```
Agentæ‰§è¡Œå¤±è´¥/è¶…æ—¶
    â†“
ç½®ä¿¡åº¦ < 0.5?
    â”œâ”€ Yes â†’ human_firstï¼ˆç›´æ¥è½¬äººå·¥ï¼‰
    â””â”€ No â†’ agent_supervisedï¼ˆAgentç»“æœ+äººå·¥å®¡æ ¸ï¼‰
```

---

## ğŸ“š å…«ã€ç›¸å…³æ–‡æ¡£

### æ¶æ„è®¾è®¡æ–‡æ¡£
- **MULTI_AGENT_ARCHITECTURE.md** - æœ¬æ–‡æ¡£
- **ADR-001-MULTI-AGENT-ARCHITECTURE.md** - æ¶æ„å†³ç­–è®°å½•

### å®æ–½æ–‡æ¡£
- **PHASE_1_AGENTS_IMPLEMENTATION.md** - 3ä¸ªAgentå®æ–½è¯¦æƒ…
- **PHASE_2_QUALITY_INSPECTION.md** - è´¨æ£€å¼‚æ­¥åŒ–å®æ–½
- **PHASE_3_TESTING_AND_OPTIMIZATION.md** - æµ‹è¯•å’Œä¼˜åŒ–

### APIæ–‡æ¡£
- **API_REFERENCE.md** - AgentScope APIå‚è€ƒ

### ä½¿ç”¨æŒ‡å—
- **STARTUP_GUIDE.md** - é¡¹ç›®å¯åŠ¨æŒ‡å—
- **QUICK_START.md** - å¿«é€Ÿå¼€å§‹æŒ‡å—

---

## ğŸ“ ä¹ã€ç»éªŒæ€»ç»“

### åšå¾—å¥½çš„åœ°æ–¹

1. âœ… **èŒè´£åˆ†ç¦»æ¸…æ™°**: 3ä¸ªAgentå„å¸å…¶èŒï¼Œæ˜“äºç»´æŠ¤
2. âœ… **å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–**: æ•…éšœåœºæ™¯å¹¶è¡Œå¤„ç†ï¼Œå»¶è¿Ÿä»…å¢åŠ 25%
3. âœ… **å®¹é”™æœºåˆ¶å®Œå–„**: è¶…æ—¶/å¤±è´¥è‡ªåŠ¨é™çº§ï¼ŒæœåŠ¡å¯ç”¨æ€§é«˜
4. âœ… **å¼‚æ­¥è´¨æ£€è®¾è®¡**: ä¸é˜»å¡ä¸»æµç¨‹ï¼Œ100%è´¨æ£€è¦†ç›–
5. âœ… **ç»“æœèšåˆç­–ç•¥**: æ™ºèƒ½èšåˆå¤šAgentä¼˜åŠ¿

---

### å¯ä»¥æ”¹è¿›çš„åœ°æ–¹

1. â³ **åœºæ™¯è¯†åˆ«ä¾èµ–å…³é”®è¯**: å¯ä»¥ä½¿ç”¨å°æ¨¡å‹åšåœºæ™¯åˆ†ç±»
2. â³ **æˆæœ¬è¾ƒé«˜**: å¯ä»¥é€šè¿‡ç¼“å­˜å’Œæ‰¹é‡è´¨æ£€ä¼˜åŒ–
3. â³ **å¹¶è¡Œä»…æ”¯æŒ2ä¸ªAgent**: å¯ä»¥æ‰©å±•åˆ°æ”¯æŒNä¸ªAgent
4. â³ **ç¼ºå°‘å®æ—¶è´¨æ£€**: ä»…æ”¯æŒå¯¹è¯ç»“æŸåè´¨æ£€

---

## ğŸ”® åã€æœªæ¥æ¼”è¿›

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2ä¸ªæœˆï¼‰

1. **åœºæ™¯åˆ†ç±»æ¨¡å‹**: ä½¿ç”¨BERTå°æ¨¡å‹æ›¿ä»£å…³é”®è¯åŒ¹é…
2. **ç¼“å­˜å±‚**: é«˜é¢‘é—®é¢˜å›å¤ç¼“å­˜ï¼Œå‡å°‘LLMè°ƒç”¨
3. **å®æ—¶è´¨æ£€**: å¯¹è¯è¿›è¡Œä¸­å®æ—¶é£é™©æé†’

### é•¿æœŸè§„åˆ’ï¼ˆ3-6ä¸ªæœˆï¼‰

1. **Agentè‡ªé€‚åº”å­¦ä¹ **: æ ¹æ®è´¨æ£€ç»“æœå¾®è°ƒAgent
2. **å¤šæ¨¡æ€æ”¯æŒ**: æ”¯æŒå›¾ç‰‡ã€è¯­éŸ³ç­‰å¤šæ¨¡æ€è¾“å…¥
3. **Agent Mesh**: æ”¯æŒåŠ¨æ€æ³¨å†Œ/æ³¨é”€Agent

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-12-27
**ä¸‹æ¬¡å®¡æŸ¥**: 2026-02-01
**ç»´æŠ¤è€…**: æ¶æ„å›¢é˜Ÿ
