# ADR-001: 采用Multi-Agent架构

**状态**: ✅ 已采纳并实施
**日期**: 2025-11-01
**决策者**: 架构团队
**最后更新**: 2025-12-27

---

## 背景

After-Sales售后客服系统需要处理咨询、故障、投诉等多种场景，原有的单一客服Agent架构存在以下问题：

### 问题1：能力局限

- **现象**：单一Agent需要同时处理情感分析、故障诊断、质检评分等所有任务
- **痛点**：
  - 故障诊断不够专业，技术问题解决率低（~50%）
  - 情感分析不精准，无法识别高风险客户
  - 质检流程手工执行，覆盖率低（<30%）
  - Agent的Prompt过于复杂（>2000 tokens），推理效果差

### 问题2：性能瓶颈

- **现象**：故障场景下需要串行执行"情感分析→故障诊断→回复生成"
- **痛点**：
  - 响应时间过长（平均30秒）
  - 无法并行处理
  - 高峰期超时率高（>20%）

### 问题3：扩展性差

- **现象**：新增功能需要修改核心Agent
- **痛点**：
  - 代码耦合度高
  - 测试困难
  - 上线风险大

---

## 决策

**采用Multi-Agent架构，将单一Agent拆分为4个独立Agent**：

1. **AssistantAgent**（辅助Agent）- 情感分析、需求提取、回复生成
2. **EngineerAgent**（工程师Agent）- 故障诊断、知识检索、技术方案
3. **InspectorAgent**（质检Agent）- 质量评分、报告生成、客户回访
4. **OrchestratorAgent**（协调Agent）- 智能路由、执行模式决策

---

## 决策理由

### 理由1：专业分工提升服务质量

**单一Agent vs Multi-Agent**：

| 维度 | 单一Agent | Multi-Agent | 提升 |
|------|----------|-------------|-----|
| **故障解决率** | 50% | 80% | +60% |
| **情感识别准确率** | 65% | 90% | +38% |
| **质检覆盖率** | 30% | 100% | +233% |

**实测数据**（Phase 1完成后）：
- 故障解决率：50% → 85%（**+70%**）✅
- 响应时间（故障场景）：30秒 → 15秒（**-50%**）✅

---

### 理由2：并行执行提升性能

**并行化收益**：

```
单一Agent（串行）:
情感分析(5s) → 故障诊断(10s) → 回复生成(5s) = 20秒

Multi-Agent（并行）:
AssistantAgent(5s) ┐
                    ├→ 聚合(1s) = 11秒
EngineerAgent(10s) ┘

性能提升: (20-11)/20 = 45%
```

**实测数据**：
- 故障场景响应时间：30秒 → 13秒（**-57%**）✅

---

### 理由3：可扩展性和可维护性

**优势**：
- ✅ 新增Agent不影响现有Agent
- ✅ Agent独立测试和部署
- ✅ Prompt简化，推理效果提升
- ✅ 职责清晰，代码耦合度低

**未来扩展**：
- 翻译Agent（多语言支持）
- 知识Agent（知识库管理）
- 调度Agent（工单自动分配）

---

## 方案对比

### 方案1：单一Agent优化（❌ 不采纳）

**优势**：
- 实现简单，无需重构
- 维护成本低

**劣势**：
- 无法解决根本问题
- Prompt复杂度无法降低
- 性能提升有限

---

### 方案2：微服务架构（❌ 不采纳）

**优势**：
- 松耦合，独立部署
- 高可用性

**劣势**：
- 过度设计，复杂度高
- 网络开销大
- 运维成本高

---

### 方案3：Multi-Agent架构（✅ 采纳）

**优势**：
- 专业分工，服务质量提升
- 并行执行，性能提升
- 可扩展性强
- 复杂度适中

**劣势**：
- 需要协调机制（已通过OrchestratorAgent解决）
- 结果聚合逻辑复杂（已制定明确策略）

---

## 技术选型

### Agent框架：AgentScope

**候选方案**：

| 框架 | 优势 | 劣势 | 决策 |
|------|------|------|------|
| **AgentScope** | 轻量、灵活、ReAct支持 | 生态较小 | ✅ 采纳 |
| LangChain | 生态丰富 | 复杂度高 | ❌ |
| AutoGen | 多Agent协作成熟 | 依赖OpenAI | ❌ |

**理由**：
- ✅ ReActAgent非常适合工具调用场景
- ✅ 轻量级，易于定制
- ✅ 异步支持良好（async/await）
- ✅ MsgHub协作机制简单清晰

---

### LLM：DeepSeek v3

**候选方案**：

| LLM | 成本 | 推理能力 | 决策 |
|-----|------|---------|------|
| **DeepSeek v3** | $1/1M tokens | 强 | ✅ 采纳 |
| GPT-4 | $30/1M tokens | 最强 | ❌ 成本高 |
| Claude 3.5 | $15/1M tokens | 强 | ❌ 成本中等 |
| Qwen 2.5 | 免费 | 中等 | ❌ 能力不足 |

**理由**：
- ✅ 成本极低（是GPT-4的1/30）
- ✅ ReAct推理能力强
- ✅ JSON结构化输出稳定
- ✅ 中文场景友好

---

### 通信机制：MCP（Model Context Protocol）

**理由**：
- ✅ 跨语言支持（Python ↔ Node.js）
- ✅ 无需额外依赖（HTTP-based）
- ✅ 调试方便

---

## 实施状态

- ✅ Phase 1: Agent基础建设（2025-11-01 至 2025-11-30）
- ✅ Phase 2: 质检异步化（2025-11-25 至 2025-12-15）
- ⏳ Phase 3: 测试与优化（2025-12-15 至 2026-01-15）

详细实施方案参见：[AGENT_ARCHITECTURE_DESIGN.md](../AGENT_ARCHITECTURE_DESIGN.md)

---

## 风险与挑战

| 风险项 | 影响 | 缓解措施 | 状态 |
|--------|------|---------|------|
| 结果聚合逻辑复杂 | 中 | 制定明确聚合规则，置信度保守策略 | ✅ 已解决 |
| 并行执行超时 | 中 | 20秒超时保护，自动降级转人工 | ⏳ 持续优化 |
| MCP工具跨语言调试困难 | 低 | 详细日志，独立测试，降级数据 | ✅ 已解决 |

---

## 成果总结

### 关键指标

| 指标 | 改进前 | 改进后 | 提升幅度 |
|------|-------|--------|---------|
| **故障解决率** | 50% | 85% | +70% ✅ |
| **响应时间（故障）** | 30秒 | 13秒 | -57% ✅ |
| **对话关闭延迟** | 3.5秒 | 320ms | -91% ✅ |
| **质检覆盖率** | 30% | 100% | +233% ✅ |
| **Agent成功率** | - | 97% | 新增 ✅ |

---

## 相关文档

- [AGENT_ARCHITECTURE_DESIGN.md](../AGENT_ARCHITECTURE_DESIGN.md) - 完整架构设计与技术实现细节
- [PHASE_1_AGENTS_IMPLEMENTATION.md](../../_archived/implementation/PHASE_1_AGENTS_IMPLEMENTATION.md) - Phase 1实施报告(归档)
- [PHASE_2_QUALITY_INSPECTION.md](../../_archived/implementation/PHASE_2_QUALITY_INSPECTION.md) - Phase 2实施报告(归档)

---

## 决策记录

| 项目 | 内容 |
|------|------|
| **决策编号** | ADR-001 |
| **决策标题** | 采用Multi-Agent架构 |
| **决策日期** | 2025-11-01 |
| **决策者** | 架构团队 |
| **状态** | ✅ 已采纳并实施 |
| **影响范围** | 系统核心架构 |
| **可逆性** | 低（已大规模实施） |

---

**维护者**: 架构团队
**最后更新**: 2025-12-27
