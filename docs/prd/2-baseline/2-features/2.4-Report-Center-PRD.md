## 2.4 报表中心功能

> **PRD格式**: Feature PRD (8章标准格式)
> **优先级**: P1 (重要功能)
> **所属版本**: v0.5+ (基础报表) → v0.8+ (自定义报表) → v1.0+ (智能分析)

---

### 第1章：功能概述

#### 1.1 功能定位

**报表中心**为管理者、团队经理、数据分析师提供全面的数据报表和可视化分析功能。

**核心价值**:
- ✅ 多维度数据报表（对话、客户、质检、任务）
- ✅ 自定义报表配置（自由组合指标和维度）
- ✅ 定期报表生成与推送（日报、周报、月报）
- ✅ 数据导出（Excel、PDF、CSV）
- ✅ 可视化看板（图表、趋势、对比）

#### 1.2 功能范围

**v0.5基础功能**:
- 预设报表模板（10+常用报表）
- 报表数据查询与导出
- 基础图表展示（折线图、柱状图、饼图）
- 报表权限控制

**v0.8增强功能**:
- 自定义报表配置
- 定期报表订阅与推送
- 报表分享与协作
- 多维度数据钻取

**v1.0智能功能**:
- AI智能洞察
- 异常数据自动预警
- 趋势预测
- 报表推荐

---

### 第2章：用户场景

#### 场景1: 团队经理查看周报

**用户旅程**:
```
1. 周一上午9点，打开报表中心
2. 选择"团队周报"模板
3. 选择上周时间范围 (2025-12-23 ~ 2025-12-29)
4. 查看核心指标:
   - 对话总量: 120次 (↑15% vs 上周)
   - 平均响应时间: 1.8分钟 (↓10% vs 上周)
   - 客户满意度: 4.5/5.0 (↑0.2 vs 上周)
   - 质检平均分: 8.2/10 (→ 持平)
5. 查看详细数据:
   - 客服排名榜
   - 问题类型分布
   - 渠道分布
6. 发现问题: 退款类对话增加30%
7. 下钻查看退款对话详情
8. 导出Excel，发送给团队
9. 创建后续改进任务
```

---

#### 场景2: 数据分析师创建自定义报表

**用户旅程**:
```
1. 进入报表中心 → 点击【新建自定义报表】
2. 配置报表:
   - 报表名称: "VIP客户服务质量月报"
   - 数据范围: 近30天
   - 筛选条件: 客户等级=VIP
3. 选择指标:
   - 对话总量
   - 平均满意度
   - 平均响应时间
   - 问题解决率
4. 选择维度:
   - 按客服分组
   - 按时间趋势
5. 选择图表类型:
   - 趋势图 (满意度趋势)
   - 排名表 (客服排名)
   - 对比图 (本月 vs 上月)
6. 预览报表
7. 保存报表模板
8. 设置定期推送: 每月1号上午9点
9. 添加订阅人: 团队经理、CEO
10. 完成配置
```

---

#### 场景3: CEO查看实时BI看板

**用户旅程**:
```
1. 打开报表中心 → 选择"CEO驾驶舱"
2. 实时看到核心业务指标:
   ┌────────────────────────────────────────────────────┐
   │ 今日实时数据 (2025-12-30 10:00)                     │
   ├────────────────────────────────────────────────────┤
   │ 在线客服: 12人     进行中对话: 28个                 │
   │ 今日对话: 156次   平均响应: 1.5分钟                │
   │ 满意度: 4.6/5.0   解决率: 85%                      │
   └────────────────────────────────────────────────────┘
3. 查看趋势图:
   - 对话量趋势 (近30天)
   - 满意度趋势 (近30天)
   - 响应时间趋势 (近30天)
4. 查看对比分析:
   - 本月 vs 上月
   - 各团队对比
   - 各渠道对比
5. 查看AI洞察:
   💡 "本周退款类对话增加30%，建议关注产品质量问题"
   ⚠️ "客服张三响应时间超标，建议减少工作量"
6. 点击异常指标，下钻查看详情
7. 将关键洞察分享给团队
```

---

### 第3章：功能详细设计

#### 3.1 报表列表

```
┌──────────────────────────────────────────────────────────────────┐
│ 报表中心 (28)         🔍搜索  ▼分类  ▼排序  [➕新建报表]          │
├──────────────────────────────────────────────────────────────────┤
│ 📊 团队周报                          系统预设 | 使用120次         │
│    说明: 团队整体服务质量和效率周报                                │
│    订阅人: 5人 | 最近生成: 2025-12-30 09:00                      │
│    [查看] [编辑] [订阅] [导出]                                    │
│                                                                  │
│ 📈 VIP客户服务质量月报                自定义 | 使用8次           │
│    说明: VIP客户服务数据月度分析                                  │
│    订阅人: 2人 | 最近生成: 2025-12-01 09:00                      │
│    [查看] [编辑] [订阅] [导出]                                    │
│                                                                  │
│ 📉 客服个人绩效报表                  系统预设 | 使用85次          │
│    说明: 客服个人服务数据和质检得分                                │
│    订阅人: 12人 | 最近生成: 2025-12-30 08:00                     │
│    [查看] [编辑] [订阅] [导出]                                    │
│                                                                  │
│ ... (显示20个报表)                                                │
└──────────────────────────────────────────────────────────────────┘
```

**报表分类**:
- **业务报表**: 对话统计、客户分析、渠道分析
- **质量报表**: 质检报告、满意度分析、违规统计
- **效率报表**: 响应时间、解决率、工作量
- **运营报表**: 成本分析、ROI分析、趋势预测
- **自定义报表**: 用户自定义

---

#### 3.2 预设报表模板

##### 3.2.1 团队周报

```
┌──────────────────────────────────────────────────────────────────┐
│ 📊 团队周报 (2025-12-23 ~ 2025-12-29)                             │
├──────────────────────────────────────────────────────────────────┤
│ 核心指标                                                          │
│ ┌────────────┬────────────┬────────────┬────────────┐           │
│ │ 对话总量    │ 平均响应    │ 客户满意度  │ 质检平均分  │           │
│ │ 120次      │ 1.8分钟    │ 4.5/5.0    │ 8.2/10     │           │
│ │ ↑15%       │ ↓10%       │ ↑0.2       │ → 持平      │           │
│ └────────────┴────────────┴────────────┴────────────┘           │
│                                                                  │
│ 对话量趋势                                                        │
│  30 ┤                                              ●             │
│  25 ┤                        ●                  ●                │
│  20 ┤            ●        ●     ●           ●                    │
│  15 ┤      ●  ●     ●  ●           ●    ●                        │
│  10 ┤   ●                                                        │
│   0 └───────────────────────────────────────────────            │
│      周一  周二  周三  周四  周五  周六  周日                      │
│                                                                  │
│ 问题类型分布                                                      │
│ ┌──────────────────────────────────────────────┐                │
│ │ 故障排查    ████████████████████ 40% (48次)  │                │
│ │ 使用咨询    ███████████████ 30% (36次)       │                │
│ │ 退款申请    ██████████ 20% (24次) ⚠️ ↑30%   │                │
│ │ 其他        █████ 10% (12次)                 │                │
│ └──────────────────────────────────────────────┘                │
│                                                                  │
│ 客服排名榜 (前5名)                                                │
│ 1. 张三   对话:35次 满意度:4.8 质检:9.2 ⭐MVP                    │
│ 2. 李四   对话:32次 满意度:4.6 质检:8.8                          │
│ 3. 王五   对话:28次 满意度:4.5 质检:8.5                          │
│ 4. 赵六   对话:15次 满意度:4.3 质检:8.0                          │
│ 5. 孙七   对话:10次 满意度:4.2 质检:7.8                          │
│                                                                  │
│ [导出Excel] [导出PDF] [分享] [订阅周报]                          │
└──────────────────────────────────────────────────────────────────┘
```

---

##### 3.2.2 客服个人绩效报表

```
┌──────────────────────────────────────────────────────────────────┐
│ 📈 客服个人绩效报表 - 张三 (2025-12月)                            │
├──────────────────────────────────────────────────────────────────┤
│ 个人指标                                                          │
│ ┌─────────┬─────────┬─────────┬─────────┬─────────┐           │
│ │ 对话量   │ 响应时间 │ 满意度   │ 解决率   │ 质检分   │           │
│ │ 156次   │ 1.2分钟 │ 4.8/5.0 │ 92%     │ 9.2/10  │           │
│ │ 排名1/12 │ 排名2/12 │ 排名1/12 │ 排名1/12 │ 排名1/12 │           │
│ └─────────┴─────────┴─────────┴─────────┴─────────┘           │
│                                                                  │
│ 工作量趋势 (近30天)                                               │
│  10 ┤                                  ●                         │
│   8 ┤              ●         ●      ●     ●                      │
│   6 ┤        ●  ●     ●   ●     ●             ●                  │
│   4 ┤   ●  ●                                      ●              │
│   2 ┤ ●                                               ●          │
│   0 └──────────────────────────────────────────────────         │
│      12/1        12/10        12/20        12/30                │
│                                                                  │
│ 满意度分布                                                        │
│ ⭐⭐⭐⭐⭐  ███████████████████████ 75% (117次)                 │
│ ⭐⭐⭐⭐    ██████████ 20% (31次)                                │
│ ⭐⭐⭐      ████ 5% (8次)                                        │
│ ⭐⭐        0% (0次)                                             │
│ ⭐          0% (0次)                                             │
│                                                                  │
│ 质检详情                                                          │
│ - 响应速度: 9.5/10                                               │
│ - 专业性: 9.0/10                                                 │
│ - 友好度: 9.2/10                                                 │
│ - 合规性: 9.5/10                                                 │
│ - 解决能力: 9.0/10                                               │
│                                                                  │
│ 改进建议                                                          │
│ 💡 继续保持，您的表现非常优秀！                                    │
│ 💡 建议: 可以协助新客服培训，分享经验                              │
│                                                                  │
│ [导出Excel] [打印] [分享]                                         │
└──────────────────────────────────────────────────────────────────┘
```

---

##### 3.2.3 客户满意度分析报表

```
┌──────────────────────────────────────────────────────────────────┐
│ 😊 客户满意度分析报表 (2025-12月)                                 │
├──────────────────────────────────────────────────────────────────┤
│ 总体满意度                                                        │
│ ┌────────────────────────────────────────────────────────────┐  │
│ │  4.5/5.0  ⭐⭐⭐⭐⭐                                       │  │
│ │  较上月提升 0.2分 (↑4.7%)                                  │  │
│ └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│ 满意度趋势 (近6个月)                                              │
│  5.0 ┤                                            ●              │
│  4.5 ┤                              ●         ●                  │
│  4.0 ┤              ●         ●  ●                               │
│  3.5 ┤        ●  ●                                               │
│  3.0 ┤   ●                                                       │
│  2.5 └───────────────────────────────────────────────           │
│       7月   8月   9月   10月  11月  12月                         │
│                                                                  │
│ 分渠道满意度                                                      │
│ 飞书    4.6/5.0  ████████████████████ 92%                       │
│ 企微    4.5/5.0  ██████████████████ 90%                         │
│ Web     4.3/5.0  ████████████████ 86%                           │
│                                                                  │
│ 分问题类型满意度                                                  │
│ 使用咨询  4.8/5.0  ████████████████████████ 96%                 │
│ 故障排查  4.5/5.0  ██████████████████ 90%                       │
│ 退款申请  4.0/5.0  ████████████████ 80% ⚠️ 需改进               │
│ 投诉处理  3.8/5.0  ██████████████ 76% ⚠️ 重点关注               │
│                                                                  │
│ 不满意原因分析 (评分≤3分)                                         │
│ 1. 问题未解决 (45%)                                              │
│ 2. 响应速度慢 (30%)                                              │
│ 3. 态度不好 (15%)                                                │
│ 4. 其他 (10%)                                                    │
│                                                                  │
│ 改进建议                                                          │
│ 💡 退款类对话满意度偏低，建议优化退款流程                          │
│ 💡 投诉处理需加强培训，提升安抚和解决能力                          │
│                                                                  │
│ [导出Excel] [导出PDF] [分享]                                     │
└──────────────────────────────────────────────────────────────────┘
```

---

#### 3.3 自定义报表配置

##### 3.3.1 报表配置界面

```
┌──────────────────────────────────────────────────────────────────┐
│ 新建自定义报表                                                    │
├──────────────────────────────────────────────────────────────────┤
│ 基本信息                                                          │
│ 报表名称: [VIP客户服务质量月报_______________] *必填              │
│ 报表分类: [▼ 业务报表]                                            │
│ 报表描述: [分析VIP客户服务数据和质量__________]                   │
│                                                                  │
│ 数据范围                                                          │
│ 时间范围: ● 相对时间  ○ 绝对时间                                 │
│   ○ 今天  ○ 最近7天  ● 最近30天  ○ 最近90天  ○ 自定义            │
│                                                                  │
│ 筛选条件 (可选)                                                   │
│ ┌────────────────────────────────────────────────────────────┐  │
│ │ + 添加筛选条件                                              │  │
│ │   [客户等级] [=] [VIP]                    [删除]            │  │
│ │   [对话状态] [=] [已解决]                 [删除]            │  │
│ │ [+ 添加AND条件] [+ 添加OR条件]                              │  │
│ └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│ 指标选择 *至少选择1个                                             │
│ ┌────────────────────────────────────────────────────────────┐  │
│ │ 已选指标 (4):                                               │  │
│ │ ☑ 对话总量          ☑ 平均满意度                            │  │
│ │ ☑ 平均响应时间      ☑ 问题解决率                            │  │
│ │                                                            │  │
│ │ 可选指标:                                                   │  │
│ │ ☐ 对话时长          ☐ 客服工作量                            │  │
│ │ ☐ 质检平均分        ☐ 首次解决率                            │  │
│ │ ☐ 客户流失率        ☐ ...更多                               │  │
│ └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│ 维度选择 *至少选择1个                                             │
│ ┌────────────────────────────────────────────────────────────┐  │
│ │ ☑ 按客服分组        ☑ 按时间趋势 (天)                       │  │
│ │ ☐ 按渠道分组        ☐ 按问题类型                            │  │
│ │ ☐ 按客户等级        ☐ 按团队分组                            │  │
│ └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│ 图表配置                                                          │
│ ┌────────────────────────────────────────────────────────────┐  │
│ │ 图表1: [趋势图 ▼]  指标: [平均满意度 ▼]                     │  │
│ │        维度: [按时间趋势 ▼]                                 │  │
│ │                                                            │  │
│ │ 图表2: [排名表 ▼]  指标: [对话总量 ▼] [平均满意度 ▼]       │  │
│ │        维度: [按客服分组 ▼]  排序: [对话总量降序 ▼]         │  │
│ │                                                            │  │
│ │ [+ 添加图表]                                                │  │
│ └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│ 定期推送 (可选)                                                   │
│ ☑ 启用定期推送                                                   │
│ 频率: ● 每月  ○ 每周  ○ 每天                                    │
│ 时间: [每月] [1日] [09:00]                                       │
│ 订阅人: [张三] [李四] [王经理] [+ 添加]                          │
│ 推送方式: ☑ 邮件  ☑ 飞书  ☐ 企微                                │
│                                                                  │
│ [预览报表] [保存] [取消]                                          │
└──────────────────────────────────────────────────────────────────┘
```

---

##### 3.3.2 可选指标库

**对话指标**:
```yaml
对话量指标:
  - 对话总量
  - 新对话数
  - 已解决对话数
  - 转派对话数
  - 超时对话数

效率指标:
  - 平均响应时间
  - 平均对话时长
  - 平均解决时长
  - 首次响应时间
  - 对话轮次

质量指标:
  - 客户满意度
  - 问题解决率
  - 首次解决率
  - 质检平均分
  - 违规次数

工作量指标:
  - 客服工作量
  - 人均对话数
  - 在线时长
  - 并发对话数
```

**客户指标**:
```yaml
客户量指标:
  - 客户总数
  - 新增客户
  - 活跃客户
  - VIP客户数
  - 流失客户数

客户价值:
  - 客户总消费
  - 人均消费
  - 复购率
  - 客户生命周期价值 (LTV)

客户行为:
  - 客户咨询频次
  - 客户活跃度
  - 客户留存率
  - 客户流失率
```

**知识库指标**:
```yaml
知识指标:
  - 知识总数
  - 新增知识
  - 知识引用次数
  - 知识平均满意度
  - 知识解决率
```

---

##### 3.3.3 可选维度库

```yaml
时间维度:
  - 按小时
  - 按天
  - 按周
  - 按月
  - 按季度
  - 按年

组织维度:
  - 按客服
  - 按团队
  - 按部门
  - 按租户

业务维度:
  - 按渠道 (飞书/企微/Web)
  - 按客户等级 (VIP/普通)
  - 按问题类型 (故障/咨询/投诉/退款)
  - 按对话状态 (待处理/处理中/已解决)
  - 按意图类型

地域维度:
  - 按省份
  - 按城市
  - 按区域
```

---

#### 3.4 定期报表订阅

##### 3.4.1 订阅管理

```
┌──────────────────────────────────────────────────────────────────┐
│ 我的订阅 (5)                                                      │
├──────────────────────────────────────────────────────────────────┤
│ 📧 团队周报                          每周一 09:00                 │
│    推送方式: 邮件 + 飞书              最近推送: 2025-12-30 09:00  │
│    [查看报表] [修改订阅] [取消订阅]                                │
│                                                                  │
│ 📧 VIP客户服务质量月报                每月1日 09:00               │
│    推送方式: 邮件                     最近推送: 2025-12-01 09:00  │
│    [查看报表] [修改订阅] [取消订阅]                                │
│                                                                  │
│ 📧 客服个人绩效日报                  每天 08:00                   │
│    推送方式: 飞书                     最近推送: 今天 08:00         │
│    [查看报表] [修改订阅] [取消订阅]                                │
│                                                                  │
│ ... (还有2个订阅)                                                 │
└──────────────────────────────────────────────────────────────────┘
```

---

##### 3.4.2 报表推送示例 (飞书机器人)

```
┌──────────────────────────────────────────┐
│ 智能售后工作台 - 团队周报               │
├──────────────────────────────────────────┤
│ 📊 团队周报 (2025-12-23 ~ 2025-12-29)  │
│                                          │
│ 核心指标:                                │
│ • 对话总量: 120次 (↑15%)                │
│ • 平均响应: 1.8分钟 (↓10%)              │
│ • 客户满意度: 4.5/5.0 (↑0.2)            │
│ • 质检平均分: 8.2/10 (→ 持平)           │
│                                          │
│ 🏆 本周MVP: 张三                        │
│    对话35次 | 满意度4.8 | 质检9.2       │
│                                          │
│ ⚠️ 异常提醒:                            │
│    退款类对话增加30%，建议关注          │
│                                          │
│ [查看完整报表] [导出Excel]              │
└──────────────────────────────────────────┘
```

---

#### 3.5 数据导出

##### 3.5.1 导出格式

| 格式 | 说明 | 适用场景 | 特性 |
|-----|------|---------|------|
| **Excel** | .xlsx格式 | 数据分析、二次处理 | 支持多sheet、图表、格式 |
| **PDF** | .pdf格式 | 打印、存档、分享 | 固定格式、不可编辑 |
| **CSV** | .csv格式 | 数据导入、编程处理 | 纯数据、无格式 |
| **JSON** | .json格式 | API对接、系统集成 | 结构化数据 |

---

##### 3.5.2 导出配置

```
┌──────────────────────────────────────────┐
│ 导出报表                                 │
├──────────────────────────────────────────┤
│ 报表名称: 团队周报                       │
│ 时间范围: 2025-12-23 ~ 2025-12-29       │
│                                          │
│ 导出格式: ● Excel  ○ PDF  ○ CSV         │
│                                          │
│ Excel选项:                               │
│ ☑ 包含图表                               │
│ ☑ 包含明细数据                           │
│ ☑ 保留格式和样式                         │
│ ○ 仅导出汇总数据                         │
│                                          │
│ 数据范围:                                │
│ ☑ 核心指标                               │
│ ☑ 趋势图表                               │
│ ☑ 排名榜                                 │
│ ☑ 明细数据 (可能较大)                    │
│                                          │
│ [导出] [取消]                            │
└──────────────────────────────────────────┘
```

---

#### 3.6 报表分享与权限

##### 3.6.1 报表分享

```
┌──────────────────────────────────────────┐
│ 分享报表                                 │
├──────────────────────────────────────────┤
│ 报表名称: 团队周报                       │
│                                          │
│ 分享方式:                                │
│ ● 生成分享链接  ○ 指定接收人            │
│                                          │
│ 链接有效期:                              │
│ ○ 1天  ● 7天  ○ 30天  ○ 永久            │
│                                          │
│ 权限设置:                                │
│ ● 仅查看  ○ 可下载  ○ 可编辑            │
│                                          │
│ 分享链接:                                │
│ https://app.example.com/report/share/... │
│ [复制链接] [通过飞书发送] [通过邮件发送] │
│                                          │
│ [确认分享] [取消]                        │
└──────────────────────────────────────────┘
```

---

##### 3.6.2 报表权限矩阵

| 角色 | 查看自己 | 查看团队 | 查看全部 | 创建报表 | 编辑报表 | 删除报表 | 订阅报表 |
|-----|---------|---------|---------|---------|---------|---------|---------|
| **超级管理员** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **租户管理员** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **团队经理** | ✅ | ✅ | ❌ | ✅ | ✅(团队) | ✅(团队) | ✅ |
| **高级客服** | ✅ | ✅ | ❌ | ✅ | ✅(自己) | ✅(自己) | ✅ |
| **普通客服** | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| **质检专员** | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ | ✅ |
| **数据分析师** | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ | ✅ |

---

### 第4章：交互设计

#### 4.1 报表预览与交互

##### 4.1.1 数据钻取

**场景**: 用户在"问题类型分布"中发现"退款申请"增加30%

**交互流程**:
```
1. 点击"退款申请"柱状图
   ↓
2. 弹出下钻菜单:
   - 查看明细数据
   - 按客服分组
   - 按时间趋势
   - 查看对话记录
   ↓
3. 选择"查看对话记录"
   ↓
4. 跳转到对话列表，自动应用筛选条件:
   - 问题类型 = 退款申请
   - 时间范围 = 2025-12-23 ~ 2025-12-29
   ↓
5. 查看所有退款对话详情
```

---

##### 4.1.2 图表交互

**交互功能**:
- **鼠标悬停**: 显示详细数值
- **点击图例**: 隐藏/显示数据系列
- **拖拽缩放**: 调整时间范围
- **点击数据点**: 下钻查看明细
- **右键菜单**: 导出、分享、添加对比

**示例**:
```
趋势图交互:
┌────────────────────────────────────┐
│ 满意度趋势                          │
│  5.0 ┤            ⬤ <- 鼠标悬停    │
│  4.5 ┤        ●       │             │
│  4.0 ┤    ●           │             │
│  3.5 ┤  ●   ┌─────────────────┐    │
│  3.0 └──────│ 12月15日         │    │
│       12/1  │ 满意度: 4.6/5.0  │    │
│             │ 对话数: 15次     │    │
│             │ [查看详情]       │    │
│             └─────────────────┘    │
└────────────────────────────────────┘
```

---

#### 4.2 实时BI看板 (v0.8+)

```
┌──────────────────────────────────────────────────────────────────────────┐
│ 🎯 CEO驾驶舱                               最后更新: 2025-12-30 10:00:00 │
├──────────────────────────────────────────────────────────────────────────┤
│ ┌────────────┬────────────┬────────────┬────────────┬────────────┐      │
│ │ 在线客服    │ 进行中对话  │ 今日对话    │ 平均响应    │ 今日满意度  │      │
│ │ 12人       │ 28个       │ 156次      │ 1.5分钟    │ 4.6/5.0    │      │
│ │ ↑2 vs昨天  │ → 正常     │ ↑18%       │ ↓8%        │ ↑0.1       │      │
│ └────────────┴────────────┴────────────┴────────────┴────────────┘      │
│                                                                          │
│ 对话量实时趋势 (今日)                     问题类型实时分布                │
│  20 ┤              ●                     故障  ████████ 35%             │
│  15 ┤        ●  ●     ●                  咨询  ██████ 30%               │
│  10 ┤   ●  ●              ●              退款  ████ 20%                 │
│   5 ┤ ●                       ●          其他  ███ 15%                  │
│   0 └──────────────────────────          ────────────────              │
│     08:00  10:00  12:00  14:00                                          │
│                                                                          │
│ 客服状态分布                              渠道分布                        │
│ 在线   ████████ 12人                     飞书  ██████████ 60%          │
│ 忙碌   ████ 5人                          企微  ██████ 30%              │
│ 离线   ██ 3人                            Web   ███ 15%                 │
│                                          其他  █ 5%                    │
│                                                                          │
│ 💡 AI智能洞察                                                            │
│ ┌──────────────────────────────────────────────────────────────────┐   │
│ │ • 本周退款类对话增加30%，建议关注产品质量问题                     │   │
│ │ • 客服张三响应时间超标，建议减少工作量或提供支持                  │   │
│ │ • VIP客户李四3天未联系，建议主动关怀                             │   │
│ │ • 预测下周对话量将增加15%，建议增加排班人员                      │   │
│ └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│ [刷新] [自动刷新: 30秒] [全屏显示] [自定义看板]                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

### 第5章：数据模型

#### 5.1 核心实体

```typescript
// 报表实体
interface Report {
  id: string;
  name: string;
  description?: string;
  category: "business" | "quality" | "efficiency" | "operation" | "custom";
  type: "preset" | "custom";
  createdBy: string;
  createdAt: Date;
  updatedAt: Date;
  config: ReportConfig;
  usageCount: number;
  subscriberCount: number;
}

// 报表配置
interface ReportConfig {
  // 数据范围
  timeRange: TimeRangeConfig;
  filters?: FilterConfig[];

  // 指标与维度
  metrics: MetricConfig[];
  dimensions: DimensionConfig[];

  // 图表配置
  charts: ChartConfig[];

  // 定期推送
  schedule?: ScheduleConfig;
}

// 时间范围配置
interface TimeRangeConfig {
  type: "relative" | "absolute";
  // 相对时间
  relativeValue?: "today" | "last7days" | "last30days" | "last90days";
  // 绝对时间
  startDate?: Date;
  endDate?: Date;
}

// 筛选条件配置
interface FilterConfig {
  field: string;
  operator: "=" | "!=" | ">" | "<" | "in" | "not_in" | "like";
  value: any;
  logicalOperator?: "AND" | "OR";
}

// 指标配置
interface MetricConfig {
  id: string;
  name: string;
  field: string;
  aggregation: "sum" | "avg" | "count" | "max" | "min";
  format?: "number" | "percentage" | "duration" | "currency";
}

// 维度配置
interface DimensionConfig {
  id: string;
  name: string;
  field: string;
  groupBy: "hour" | "day" | "week" | "month" | "csr" | "team" | "channel" | "intent";
}

// 图表配置
interface ChartConfig {
  id: string;
  type: "line" | "bar" | "pie" | "table" | "number";
  metric: string;
  dimension?: string;
  order?: "asc" | "desc";
  limit?: number;
}

// 定期推送配置
interface ScheduleConfig {
  enabled: boolean;
  frequency: "daily" | "weekly" | "monthly";
  time: string; // HH:mm
  dayOfWeek?: number; // 1-7 for weekly
  dayOfMonth?: number; // 1-31 for monthly
  recipients: string[]; // User IDs
  channels: ("email" | "feishu" | "wechat")[];
}

// 报表订阅
interface ReportSubscription {
  id: string;
  reportId: string;
  userId: string;
  channels: ("email" | "feishu" | "wechat")[];
  enabled: boolean;
  createdAt: Date;
  lastSentAt?: Date;
}

// 报表快照 (已生成的报表实例)
interface ReportSnapshot {
  id: string;
  reportId: string;
  generatedAt: Date;
  timeRange: {
    startDate: Date;
    endDate: Date;
  };
  data: ReportData;
  fileUrl?: string; // Excel/PDF文件URL
}

// 报表数据
interface ReportData {
  summary: Record<string, any>; // 汇总数据
  details: any[]; // 明细数据
  charts: ChartData[]; // 图表数据
}

// 图表数据
interface ChartData {
  chartId: string;
  type: string;
  data: any[];
  options?: Record<string, any>;
}
```

---

#### 5.2 数据库表设计

```sql
-- 报表配置表
CREATE TABLE reports (
  id UUID PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  category VARCHAR(20) NOT NULL,
  type VARCHAR(10) NOT NULL,
  config JSONB NOT NULL,
  created_by UUID NOT NULL REFERENCES users(id),
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
  usage_count INT DEFAULT 0,
  subscriber_count INT DEFAULT 0
);

CREATE INDEX idx_reports_category ON reports(category);
CREATE INDEX idx_reports_type ON reports(type);
CREATE INDEX idx_reports_created_by ON reports(created_by);

-- 报表订阅表
CREATE TABLE report_subscriptions (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL REFERENCES reports(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  channels TEXT[] NOT NULL,
  enabled BOOLEAN DEFAULT true,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  last_sent_at TIMESTAMP,
  UNIQUE(report_id, user_id)
);

CREATE INDEX idx_subscriptions_user ON report_subscriptions(user_id);
CREATE INDEX idx_subscriptions_report ON report_subscriptions(report_id);
CREATE INDEX idx_subscriptions_enabled ON report_subscriptions(enabled) WHERE enabled = true;

-- 报表快照表 (已生成的报表)
CREATE TABLE report_snapshots (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL REFERENCES reports(id),
  generated_at TIMESTAMP NOT NULL DEFAULT NOW(),
  time_range JSONB NOT NULL,
  data JSONB NOT NULL,
  file_url TEXT,
  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_snapshots_report ON report_snapshots(report_id, generated_at DESC);
CREATE INDEX idx_snapshots_generated ON report_snapshots(generated_at DESC);

-- 报表访问日志 (用于统计使用次数)
CREATE TABLE report_access_logs (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL REFERENCES reports(id),
  user_id UUID NOT NULL REFERENCES users(id),
  action VARCHAR(20) NOT NULL, -- view|export|share
  accessed_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_access_logs_report ON report_access_logs(report_id, accessed_at DESC);
CREATE INDEX idx_access_logs_user ON report_access_logs(user_id, accessed_at DESC);
```

---

### 第6章：业务规则

#### 6.1 报表生成规则

```yaml
生成时机:
  - 手动触发: 用户点击"查看报表"
  - 定期生成: 按照schedule配置自动生成
  - API调用: 外部系统请求生成

生成流程:
  1. 验证权限: 检查用户是否有查看权限
  2. 解析配置: 解析报表config
  3. 构建查询: 根据配置生成SQL查询
  4. 执行查询: 从数据库获取数据
  5. 数据处理: 聚合、计算、格式化
  6. 生成图表: 根据chart config生成图表数据
  7. 保存快照: 保存到report_snapshots表
  8. 返回结果: 返回报表数据

缓存策略:
  - 相同配置+时间范围的报表，1小时内使用缓存
  - 实时数据不使用缓存
  - 大数据量报表强制缓存30分钟

性能优化:
  - 数据量 > 10万: 分页查询，每次1万条
  - 查询超时: 30秒超时，返回部分数据
  - 异步生成: 大报表异步生成，通知用户下载
```

---

#### 6.2 定期报表推送规则

```yaml
推送时机:
  - daily: 每天指定时间 (如 08:00)
  - weekly: 每周指定星期几和时间 (如 周一 09:00)
  - monthly: 每月指定日期和时间 (如 1号 09:00)

推送流程:
  1. 定时任务扫描: 每分钟扫描一次待推送报表
  2. 生成报表: 调用报表生成服务
  3. 获取订阅人: 从report_subscriptions获取
  4. 发送通知:
     - 邮件: 发送HTML邮件 + Excel附件
     - 飞书: 发送卡片消息 + 查看链接
     - 企微: 发送文本消息 + 查看链接
  5. 记录日志: 更新last_sent_at

失败重试:
  - 生成失败: 重试3次，间隔5分钟
  - 发送失败: 重试3次，间隔1分钟
  - 最终失败: 记录错误日志，通知管理员

推送限制:
  - 单次推送最多100人
  - 超过100人分批推送
  - 邮件附件最大10MB
```

---

#### 6.3 数据权限规则

```yaml
权限控制:
  - 客服: 仅查看自己的数据
  - 团队经理: 查看团队数据
  - 管理员: 查看所有数据

数据过滤:
  - 根据user role自动添加筛选条件
  - 普通客服: WHERE csr_id = current_user_id
  - 团队经理: WHERE team_id = current_user_team_id
  - 管理员: 无过滤条件

敏感数据脱敏:
  - 客户手机号: 138****5678
  - 客户身份证: 320102****1234
  - 客户地址: 北京市朝阳区***
  - 非VIP客户姓名: 张*
```

---

### 第7章：非功能需求

#### 7.1 性能要求

| 指标 | v0.5目标 | v0.8目标 | v1.0目标 | 测量方法 |
|-----|---------|---------|---------|----------|
| **报表生成时间** | <10秒 (小) | <8秒 (小) | <5秒 (小) | API监控 |
|  | <30秒 (中) | <20秒 (中) | <15秒 (中) |  |
|  | <2分钟 (大) | <1分钟 (大) | <30秒 (大) |  |
| **报表列表加载** | <1秒 | <800ms | <500ms | 前端埋点 |
| **图表渲染** | <2秒 | <1秒 | <500ms | 前端埋点 |
| **数据导出** | <15秒 | <10秒 | <8秒 | 前端埋点 |
| **并发查询** | 20 | 50 | 100 | 压测 |

**数据量定义**:
- 小: <1万条记录
- 中: 1万-10万条记录
- 大: >10万条记录

---

#### 7.2 数据准确性

```yaml
数据一致性:
  - 报表数据与实际数据误差 < 0.1%
  - 实时数据延迟 < 5秒
  - 定期数据每小时同步一次

数据校验:
  - 报表生成后自动校验关键指标
  - 异常数据自动预警
  - 人工复核机制

审计追踪:
  - 记录所有报表访问、导出、分享操作
  - 审计日志保留180天
```

---

#### 7.3 可扩展性

```yaml
报表模板扩展:
  - 支持插件式添加新报表模板
  - 支持自定义SQL查询 (管理员权限)
  - 支持外部数据源接入 (v1.0)

图表类型扩展:
  - v0.5: 折线图、柱状图、饼图、表格、数字卡片
  - v0.8: 散点图、雷达图、漏斗图、地图
  - v1.0: 3D图表、动态图表、自定义图表

导出格式扩展:
  - v0.5: Excel, PDF, CSV
  - v0.8: PPT, Word, Image
  - v1.0: HTML, Markdown, JSON API
```

---

### 第8章：验收标准

#### 8.1 功能验收

**预设报表**:
- [ ] 10+预设报表模板正常工作
- [ ] 报表数据准确无误
- [ ] 报表图表正常展示
- [ ] 报表导出功能正常

**自定义报表**:
- [ ] 报表配置界面友好易用
- [ ] 支持20+指标选择
- [ ] 支持10+维度选择
- [ ] 支持5+图表类型
- [ ] 预览功能正常

**定期推送**:
- [ ] 定期推送配置正常
- [ ] 推送时机准确 (误差<5分钟)
- [ ] 推送内容完整
- [ ] 多渠道推送正常 (邮件/飞书/企微)

**数据导出**:
- [ ] Excel导出正常，格式正确
- [ ] PDF导出正常，样式美观
- [ ] CSV导出正常，编码正确
- [ ] 大数据量导出不崩溃

**报表分享**:
- [ ] 分享链接生成正常
- [ ] 权限控制有效
- [ ] 分享有效期正确

---

#### 8.2 性能验收

- [ ] 小报表生成<5秒 (P95)
- [ ] 中报表生成<15秒 (P95)
- [ ] 大报表生成<30秒 (P95)
- [ ] 报表列表加载<500ms
- [ ] 图表渲染<500ms
- [ ] 并发100查询不崩溃

---

#### 8.3 准确性验收

- [ ] 报表数据与实际数据一致性>99.9%
- [ ] 关键指标计算准确无误
- [ ] 同一配置多次生成结果一致
- [ ] 数据钻取结果正确

---

#### 8.4 用户体验验收

- [ ] 报表配置流程简单 (<5步)
- [ ] 图表交互流畅
- [ ] 数据钻取操作顺畅
- [ ] 导出速度快
- [ ] 推送内容清晰易读

---

#### 8.5 业务验收

**效率提升**:
- [ ] 报表生成效率: 人工1小时 → 系统10秒 (提升360倍)
- [ ] 定期报表自动化: 节省80%人工统计时间

**数据洞察**:
- [ ] 管理者满意度≥4.5/5.0
- [ ] 报表使用率≥80% (团队经理以上)
- [ ] 数据驱动决策比例提升50%

**成本节省**:
- [ ] 减少人工统计工作量: 节省30%人力成本
- [ ] 数据分析效率提升: 50%

---

**文档结束**

**相关文档**:
- 分析与质检模块: `../4-hybrid-modules/Analytics-QA-PRD.md`
- 产品概述: `../1-overview/Product-Overview.md`
- 非功能需求: `../5-nonfunctional/Non-Functional-Requirements.md`
