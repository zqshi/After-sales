## 2.1 对话管理功能

> **PRD格式**: Feature PRD (8章标准格式)
> **优先级**: P0 (核心功能)
> **所属版本**: v0.9+
> **最后更新**: 2026-01-14

---

### 第1章：功能概述

#### 1.1 功能定位

**对话管理**聚合多渠道群聊与客户对话，提供“只读聚合 + 内部协作 + AI辅助”的处理入口。

**关键定位**:
- ✅ 群聊/多渠道对话统一展示（飞书/企业QQ/微信）
- ✅ 只读聚合模式：外部IM未打通，不直接回发
- ✅ 内部备注与AI建议作为回复草稿
- ✅ 对话与客户画像、质检、任务、知识联动

#### 1.2 目标用户

| 用户角色 | 使用场景 | 核心需求 |
|---------|---------|---------|
| 一线客服 | 日常群聊支持 | 快速读取问题、生成草稿、关联工单 |
| 质检专员 | 会话复盘 | 查看对话记录与质检维度 |
| 主管/经理 | 质量巡检 | 快速查看客户信息与历史记录 |

#### 1.3 功能范围

**本期范围**:
- 对话列表展示（名称/摘要/渠道/未读/客户等级/情绪icon）
- 搜索（客户名/摘要关键词）
- 状态筛选（全部/待处理/进行中）
- 高级筛选（渠道/紧急度/客户等级）
- 群聊对话展示（只读聚合提示）
- 7个快捷入口（工单管理/回复建议/问题澄清/AI解决方案/辅助排查/创建工单/生成故障报告）
- Agent模式切换（Agent自动/Agent监督/人工优先）
- 右侧抽屉：经典分析面板与AI辅助面板

**不在本期范围**:
- 直接回发外部IM消息
- 对话转派/派单/协同处理
- 标签筛选、负责人筛选、时间范围筛选
- 对话置顶、导出、删除
- 逐条消息满意度评分
- 全文检索/高级查询语法

---

### 第2章：用户场景

#### 场景1：客服处理群聊咨询

**用户旅程**:
```
1. 进入消息-对话列表
2. 通过状态筛选锁定“待处理”
3. 点击群聊对话 → 展示聊天内容与智能摘要
4. 打开右侧经典分析面板查看客户信息/历史记录
5. 使用“回复建议/问题澄清”生成草稿
6. 在输入框记录内部备注（不回发外部IM）
7. 必要时创建工单或生成故障报告
```

#### 场景2：复杂问题快速定位

**用户旅程**:
```
1. 点击“AI解决方案”快捷入口
2. 查看排查步骤与参考资料
3. 根据客户等级与紧急度生成内部回复草稿
4. 形成工单或任务跟进
```

---

### 第3章：功能详细设计

#### 3.1 对话列表（左侧栏）

**字段展示**:
- 对话名称、渠道
- 摘要/最近消息
- 更新时间
- 客户等级（VIP/KA0/KA1）
- 情绪icon（来自情绪分析）
- 紧急度文本与未读数

**筛选条件**:
```yaml
搜索:
  - 客户/群聊名称
  - 摘要/最近消息文本
高级筛选:
  渠道: 飞书/企业QQ/微信
  紧急度: 紧急/普通/已解决
  客户等级: VIP/KA0/KA1
```

**状态按钮**:
- 全部/待处理/进行中
- “已解决”仅作为紧急度选项，不作为独立状态按钮

#### 3.2 对话详情（主内容区）

- 头部：群聊标题、客户等级、智能摘要、Agent模式切换
- 消息区：客户消息（含情绪徽章）、内部备注、AI卡片
- 输入区：内部备注/草稿，提示“只读聚合模式”

#### 3.3 快捷入口（7个）

| 入口 | 行为 | 备注 |
|---|---|---|
| 工单管理 | 打开工单面板 | 右侧抽屉内容
| 回复建议 | 生成3种话术 | AI辅助面板
| 问题澄清 | 生成澄清问题 | AI辅助面板
| AI解决方案 | 生成排查步骤 | AI辅助面板
| 辅助排查 | 打开排查入口 | 内部协作
| 创建工单 | 打开创建工单 | 工单流程
| 生成故障报告 | 生成报告入口 | 报告流程

#### 3.4 右侧抽屉

- **经典分析面板**：客户信息 + 历史对话记录
- **AI辅助面板**：回复建议/解决方案/澄清/参考资料

---

### 第4章：交互设计

- Dock导航：消息/知识/工具
- 消息子菜单：对话/任务
- 只读聚合提示固定展示
- AI入口触发右侧AI辅助面板

---

### 第5章：数据模型

```typescript
interface ConversationListItem {
  conversationId: string;
  customerName: string;
  aiSummary?: string;
  updatedAt?: string;
  channel: 'feishu' | 'qq' | 'wechat';
  urgency?: 'high' | 'normal' | 'low';
  slaLevel?: 'VIP' | 'KA0' | 'KA1';
  unreadCount?: number;
  sentiment?: { type?: string; label?: string };
}
```

---

### 第6章：业务规则

- 状态筛选仅支持：全部/待处理/进行中
- “已解决”仅作为紧急度选项，不进入状态流转
- 外部IM未打通，输入仅为内部备注
- Agent模式只影响提示策略，不自动外发

---

### 第7章：非功能需求

- 对话列表首屏加载 < 1s
- 筛选响应 < 300ms
- 抽屉切换 < 500ms

---

### 第8章：验收标准

- [ ] 列表正确展示摘要、等级、情绪、未读数
- [ ] 搜索按名称/摘要生效
- [ ] 筛选：状态/渠道/紧急度/客户等级可用
- [ ] 群聊消息只读展示
- [ ] 快捷入口可触发对应面板
- [ ] 分析面板与AI面板可切换

---

**文档结束**
