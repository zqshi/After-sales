# 实现状态与改进清单（按当前代码）

**版本**：v2.0（拆分版）  
**最后更新**：2026-02-05

## PRODUCT_ANALYSIS_REPORT 审计（历史文档）

- 归档位置：`docs/_archived/prd/PRODUCT_ANALYSIS_REPORT.md`
- 时间：2026-01-14
- 结论：属历史分析/规划，不等同当前实现

**明确需校正项**
- 版本号：报告写 `v0.9 Alpha`，当前仓库标注 `v0.1.0`
- 端口描述：报告写 3000（Docker 映射），当前 Docker 映射为 3002；本地为 5173

**可疑/不可验证项**
- “整体完成度 73% / 前端 90%+ / 后端 54~60%” 为历史估算
- 多处规划内容（React/NestJS/Redis Streams/RabbitMQ 等）非当前实现

**与当前一致的点**
- 前端现为 Vanilla JS + Vite（React 为规划）
- 后端现为 Fastify（NestJS 为规划）
- 模型使用 `deepseek-v3.1`

## 实现状态摘要

**已完整实现**
- IM 入站核心链路与事件溯源/Outbox 双写
- 需求识别与任务创建联动
- AI 情绪分析（Coordinator + Controller 双调用）
- 知识库检索与推荐
- 问题生命周期管理与质检触发
- ReviewRequest + SSE 复核链路
- MCP 工具注册与 E2E 冒烟
- 降级日志与告警

**部分实现**
- 质检闭环：由 `ProblemResolvedEvent` 触发并落库
- AgentScope 回复生成：失败时降级而非重试

**未实现/未接入**
- WebSocket 推送（服务存在但未注册）
- IM 回执接口 `/api/v1/im/messages/receipt`
- Workflow/ReAct 未接入 IM 主链路（可选能力）

## 已知问题与改进建议

**中优先级**
- WebSocket 推送未接入：复核依赖 SSE/轮询

**低优先级**
- 文档过度承诺风险：需持续审计
- E2E 覆盖不足：补充关键流程测试
- Outbox 并发配置未生效：从配置读取替换硬编码
- IM 回执未实现：如需支持补齐路由与状态流转

## 失败提示规范（面向客服侧）

- AI 分析/回复不可用："智能分析不可用，请人工处理当前会话并记录异常。"
- AgentScope 服务不可用："Agent 服务不可用，请人工处理并稍后重试。"
- 知识库检索不可用："知识库检索不可用，请人工补充答复。"

**用户侧提示原则**
- 不暴露系统/模型异常
- 使用业务话术："已收到您的问题，我们会尽快回复。"
