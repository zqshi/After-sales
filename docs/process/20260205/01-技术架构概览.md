# 技术架构概览（当前实现）

**版本**：v2.0（拆分版）  
**最后更新**：2026-02-05

## 技术栈

- 前端：Vanilla JS（ES Modules）+ Vite + Chart.js + Vitest/Playwright
- 后端：Fastify + TypeScript + TypeORM + PostgreSQL + Redis
- AgentScope：FastAPI + AgentScope + DeepSeek v3.1
- 运维：Docker Compose + Nginx + Prometheus + Grafana

## 逻辑架构图（ASCII）

```
┌──────────────────────────────────────────────────────────────┐
│                         Frontend Workbench                   │
│  - 对话中心 / 任务中心 / 知识库 / 客户画像 / 质检面板          │
│  - HTTP（SSE: ReviewRequest 订阅可用）                        │
└──────────────────────────────┬───────────────────────────────┘
                               │
                               │ HTTP / SSE（可选）
                               ▼
┌──────────────────────────────────────────────────────────────┐
│                         Backend (Fastify)                     │
│  - Application / Domain / Infrastructure / Presentation       │
│  - EventBus + Outbox + WebSocket（未接入）                     │
└──────────────────────────────┬───────────────────────────────┘
                               │ HTTP
                               ▼
┌──────────────────────────────────────────────────────────────┐
│                     AgentScope Service (FastAPI)              │
│  OrchestratorAgent + Assistant/Engineer/Inspector Agents       │
│  /api/chat  /api/agents  /api/events/bridge                   │
└──────────────────────────────┬───────────────────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────┐
│                         LLM Provider                          │
│  DeepSeek v3.1                                                  │
└──────────────────────────────────────────────────────────────┘
```

## 部署拓扑（Docker/Compose 视角）

```
[Browser]
    │
    ▼
[Frontend (Vite build/Static)] ---HTTP---> [Backend: :8080]
                                      │
                                      ├──HTTP--> [AgentScope: :5000]
                                      │
                                      ├──TCP--> [PostgreSQL: :5432]
                                      │
                                      └──TCP--> [Redis: :6379]

可选：
  [Prometheus: :9090]  <---scrape---  [Backend Metrics]
  [Grafana: :3001]     <---read-----  [Prometheus]
  [Nginx] 作为统一入口反向代理
```

## 端口与健康检查

- Backend：`http://localhost:8080`，健康检查 `GET /health`
- AgentScope：`http://localhost:5000`，健康检查 `GET /health`
- 前端本地：`http://localhost:5173`（Docker 映射 `http://localhost:3002`）
- MCP：`POST /mcp`（tools/list, tools/call），工具列表 `GET /mcp` 或 `GET /mcp/tools`
