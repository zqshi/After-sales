# 智能售后工作台 Web 端测试用例

## 文档说明
- **版本**: v2.0
- **更新日期**: 2026-01-26
- **适用系统**: 智能售后工作台主前端系统 (app.html)
- **测试范围**: 前端UI交互、用户体验、集成测试
- **参考文档**: [事件格式文档](../backend/tests/事件格式.md)

## 优先级定义
- **P0**: 核心功能，必须通过，影响核心业务流程（登录、消息发送、对话切换、权限控制）
- **P1**: 重要功能，应该通过，影响用户体验（知识搜索、AI辅助、客户画像、需求管理）
- **P2**: 次要功能，可以延后，不影响核心功能（报表、工具箱、审计日志）

## 测试环境
- **浏览器**: Chrome 120+, Firefox 120+, Safari 17+
- **分辨率**: 1920x1080, 1366x768, 移动端适配
- **网络**: 正常网络、弱网、离线

## 测试数据准备
- **测试账号**: test@example.com / Test@123456
- **测试客户**: 10个客户数据（包含不同等级、风险等级）
- **测试对话**: 50条对话记录（包含不同状态、渠道）
- **测试知识**: 100条知识条目（包含不同分类、标签）
- **测试问题**: 20个问题记录（包含不同状态、优先级）
- **测试事件**: domain_events 和 outbox_events 测试数据

## 模块索引
- [0. 全局导航与布局](#0-全局导航与布局) [P0]
- [1. 登录与会话](#1-登录与会话) [P0]
- [2. 权限体系](#2-权限体系) [P0]
- [3. 对话列表与会话](#3-对话列表与会话) [P0]
- [4. 客户画像](#4-客户画像) [P1]
- [5. 需求管理](#5-需求管理) [P1]
- [6. 任务与质检](#6-任务与质检) [P1]
- [7. 知识库管理](#7-知识库管理) [P1]
- [8. 知识应用](#8-知识应用) [P1]
- [9. AI辅助](#9-ai辅助) [P1]
- [10. 工具箱](#10-工具箱) [P2]
- [11. 报表](#11-报表) [P2]
- [12. 审计与监控](#12-审计与监控) [P2]
- [13. 健康检查](#13-健康检查) [P2]
- [14. 权限面板](#14-权限面板) [P1]
- [15. 工具箱快捷动作](#15-工具箱快捷动作) [P2]
- [16. 运行时配置](#16-运行时配置) [P1]
- [17. 可靠性与异常处理](#17-可靠性与异常处理) [P0]
- [18. 实时通信与SSE](#18-实时通信与sse) [P0] ⭐ 新增
- [19. Agent协同与智能辅助](#19-agent协同与智能辅助) [P0] ⭐ 新增
- [20. 问题并行管理](#20-问题并行管理) [P0] ⭐ 新增
- [21. 事件溯源与一致性](#21-事件溯源与一致性) [P1] ⭐ 新增
- [22. 性能与负载](#22-性能与负载) [P1] ⭐ 新增

## 测试目标
以当前 Web 端已实现功能为准，覆盖核心路径、边界与异常场景，便于指导自动化测试。

## 测试范围
登录/会话、权限/RBAC、对话/IM、客户画像、需求、任务、知识库、AI、工具箱、报表、审计、监控、实时通信、Agent协同、问题并行管理、事件溯源、性能测试。

---

## 0. 全局导航与布局（Dock/侧栏/角色切换）

### 用户故事
作为客服/主管，我需要通过左侧 Dock 快速切换模块，并在需要时展开右侧分析/AI 面板。

### 验收标准
- Dock 入口与子菜单可切换到对应 workspace
- 右侧抽屉可展开/收起，模式可在分析/AI 间切换
- 角色切换影响可见模块

### 测试用例
0.1 点击 Dock「消息」进入对话视图，左侧显示对话列表，workspace 显示对话区
0.2 Dock「消息」子菜单切换到“任务”，左侧切换任务列表，workspace 显示任务区
0.3 点击 Dock「知识」默认进入“知识管理”，workspace 显示知识管理页
0.4 Dock「知识」子菜单切换“知识应用”，workspace 显示知识应用页
0.5 点击 Dock「工具」进入工具页，右侧分析抽屉应关闭（panel 模式）
0.6 点击 Dock「报表」进入报表页，图表容器可正常渲染
0.7 点击 Dock「权限」进入权限管理 workspace
0.8 Dock 当前激活按钮高亮，非激活按钮不高亮
0.9 角色切换为 quality_specialist 时隐藏报表入口并显示任务入口
0.10 角色切换为 leadership 时隐藏任务入口并显示报表入口
0.11 右侧抽屉打开/关闭（按钮或遮罩点击关闭）
0.12 右侧抽屉切换至 AI 面板时分析面板隐藏，切回分析面板时 AI 面板隐藏
0.13 拖拽左侧/右侧分隔线可调整宽度且不超过最小/最大限制
0.14 头像/用户名按钮可展开用户菜单，点击页面其他区域收起

### 可访问性
0.A11y1 Dock 按钮可键盘聚焦并 Enter 激活

## 1. 登录与会话

### 用户故事
作为客服，我需要使用账号登录系统，以便访问工作台和业务功能。

### 验收标准
- 支持邮箱或手机号登录，失败提示明确
- 登录成功写入 token 并可访问工作台
- token 失效会跳回登录页

### 测试用例
1.1 使用有效账号/密码登录成功，跳转到 `app.html`，本地存储存在 `authToken`
1.2 使用错误密码登录失败，提示“登录失败”或后端错误信息
1.3 清空 token 后刷新工作台，自动跳转登录页
1.4 进入 `app.html` 时 token 无效或 `/api/auth/me` 鉴权失败，清理本地存储并跳转登录
1.5 支持手机号登录（如有手机号账号）
1.6 登录后用户信息展示正确（头像/姓名）
1.7 退出登录清理本地存储并回到登录页
1.8 API 网络异常时登录提示“无法连接认证服务”

### 按钮级用例
1.B1 点击“进入工作台”按钮触发表单校验并发起登录请求
1.B2 点击“一键填入演示账号”后账号/密码输入框自动填充

### 输入校验规则
1.V1 账号为空提示“请输入账号”
1.V2 账号非邮箱/手机号格式提示“账号格式需为邮箱或手机号”
1.V3 密码为空提示“请输入密码”
1.V4 密码不足 8 位提示“密码至少 8 位”
1.V5 密码不含大小写/数字提示“密码需包含大小写字母与数字”
1.V6 邮箱正则满足 `[^\\s@]+@[^\\s@]+\\.[^\\s@]+`
1.V7 手机号正则满足 `^1[3-9]\\d{9}$`

### 可访问性
1.A11y1 输入框存在 `label` 且 `aria-describedby` 指向错误提示
1.A11y2 错误提示出现时读屏可读（role/aria-live）

### 性能基线
1.P1 登录请求 95% 响应 < 2s

### 异常返回码映射
1.E1 400 -> 表单错误提示（字段级或通用错误）
1.E2 401 -> 账号或密码错误提示
1.E3 403 -> 账号被禁用提示
1.E4 500 -> “服务暂不可用”提示

自动化建议：Playwright/ Cypress 通过登录 API 获取 token 并注入 localStorage，断言跳转与用户信息显示。

---

## 2. 权限体系（RBAC）

### 用户故事
作为管理员，我可以查看/控制权限范围；作为普通客服，仅可访问授权模块。

### 验收标准
- 后端根据角色返回权限集
- 前端权限面板与后端权限同步
- 无权限按钮/入口被隐藏或禁用

### 测试用例
2.1 `GET /session/permissions` 返回角色与权限数组
2.2 管理员可访问“权限”tab，客服不可见（UI 隐藏）
2.3 无权限操作接口返回 403
2.4 切换角色后权限 UI 及时更新
2.5 权限面板本地改动不影响后端权限结果
2.6 未登录访问权限接口返回 401
2.7 `data-permission-mode="disable"` 元素在无权限时置灰且不可点击
2.8 无权限的 dock 入口被隐藏，若当前激活入口被隐藏则自动回退到消息页
2.9 权限返回 uiPermissions/permissions 不一致时，前端以 uiPermissions 优先渲染

### 按钮级用例
2.B1 权限面板“保存变更”按钮在无改动时不可用
2.B2 权限面板“保存变更”点击后提示保存成功

### 输入校验规则
2.V1 角色名为空不允许保存
2.V2 成员名为空不允许保存
2.V3 角色名长度 2-30
2.V4 成员名长度 2-30

### 可访问性
2.A11y1 权限复选框可键盘操作（Tab/Space）

### 性能基线
2.P1 权限面板打开 < 1s

### 异常返回码映射
2.E1 401 -> 跳转登录
2.E2 403 -> 提示权限不足

自动化建议：接口测试断言 403；UI 测试断言 `data-permission` 元素显示状态。

---

## 3. 对话列表与会话（消息页）

### 用户故事（页面视角）
作为客服，我需要查看对话列表并进入对话处理客户问题。

### 验收标准
- 对话列表可加载，点击后渲染会话
- 会话切换后客户画像与对话内容同步更新
- 支持模式切换（auto/supervised/human）

### 测试用例（页面/流程）
3.0 进入“消息”页默认展示对话列表与会话区，列表第一项默认高亮
3.1 对话列表加载成功（mock 或后端），每项包含客户名/摘要/更新时间/渠道
3.2 点击对话项，高亮切换，消息区加载对应历史消息
3.3 对话项点击后右侧客户信息同步更新
3.4 输入搜索关键词，列表按客户/摘要过滤，清空后恢复全量
3.5 切换筛选条件（状态/渠道）后列表刷新
3.6 未读数按返回数据展示（如存在）
3.8 发送消息：输入非空内容后可发送，发送后消息显示在列表底部
3.9 发送空消息被前端拦截；超长消息后端返回 400 时前端提示错误
3.10 表情按钮可打开/关闭表情面板，点击面板外收起
3.11 快捷操作（工单管理/问题澄清/需求检测/辅助排查/创建工单/故障报告）按钮可点击
3.12 切换 Agent 模式按钮显示当前模式高亮
3.13 切换模式时 UI 状态立即更新且提示成功
3.14 AI 面板开关可正常展开/收起
3.15 网络异常时列表和消息区显示降级提示
3.16 状态筛选按钮切换后列表刷新、按钮高亮状态正确，计数 badge 同步更新
3.17 渠道/紧急度/客户等级筛选下拉生效，列表按条件过滤
3.18 手动清空搜索框/筛选下拉恢复全量列表
3.19 过滤无匹配时显示“未找到匹配的对话”
3.20 对话列表项包含情绪 icon 与未读数（当返回 sentiment/unreadCount）
3.21 输入包含“赠送/优惠/折扣”时出现低置信提示

### 接口测试用例（保留）
3.A `GET /im/conversations` 返回列表并渲染
3.B `GET /im/conversations/:id/messages` 返回消息并渲染
3.C `PATCH /im/conversations/:id/mode` 设置模式成功
3.D `POST /im/conversations/:id/messages` 发送消息成功

### 按钮级用例
3.B1 点击“Agent自动/监督/人工优先”按钮切换模式
3.B2 点击“话术优化”按钮触发提示/占位逻辑
3.B3 点击“发送”按钮发送当前输入框内容
3.B4 点击“表情”按钮弹出/收起选择面板
3.B5 点击“创建工单/生成故障报告/辅助排查”打开对应弹窗

### 输入校验规则
3.V1 发送内容为空禁止发送
3.V2 消息长度超过限制提示错误（若有限制）
3.V4 模式枚举仅允许 `agent_auto/agent_supervised/human_first`

### 可访问性
3.A11y1 消息输入框支持 Enter 发送、Shift+Enter 换行
3.A11y2 会话列表项可键盘聚焦并 Enter 选中

### 性能基线
3.P1 对话列表加载 < 2s
3.P2 切换会话 95% < 1s

### 异常返回码映射
3.E1 400 -> 参数错误提示
3.E2 401 -> 跳转登录
3.E3 403 -> 权限不足提示
3.E4 404 -> 会话不存在提示
3.E5 500 -> 展示“消息发送失败”

自动化建议：接口 mock 或预置数据，断言 DOM 渲染与 API 调用。

---

## 4. 客户画像（消息页右侧面板）

### 用户故事（页面视角）
作为客服，我需要查看客户画像与互动记录，辅助判断优先级。

### 验收标准
- 客户详情能从 `/api/customers/:id` 拉取
- 互动记录从 `/api/customers/:id/interactions` 拉取
- 数据为空时有合理兜底显示

### 测试用例（页面/流程）
4.0 切换对话时画像面板刷新且不闪烁
4.1 画像卡片展示姓名/联系方式/标签/健康度/客户等级
4.2 联系方式缺失时显示“-”而不崩溃
4.3 关键指标（满意度/工单/时长）显示合理格式
4.4 服务记录列表存在时可展开/收起
4.5 互动记录按时间倒序显示
4.6 风险等级/客户等级显示色彩正确
4.7 customerId 错误时提示并降级为本地 mock
4.8 刷新画像操作后更新时间变化
4.9 无互动记录时显示空状态
4.10 互动记录筛选（时间窗/类型）切换后列表刷新
4.11 服务记录筛选（状态/承诺）切换后列表刷新
4.12 点击服务记录/历史对话条目打开详情弹窗
4.13 详情弹窗“定位”按钮关闭侧栏并滚动定位到对话消息（高亮提示）
4.14 点击“查看历史对话”切换到历史对话记录 tab

### 接口测试用例（保留）
4.A `GET /api/customers/:id` 返回画像
4.B `GET /api/customers/:id/interactions` 返回互动记录
4.C `POST /api/customers/:id/refresh` 刷新画像成功

### 按钮级用例
4.B1 点击“刷新画像”按钮触发刷新并显示加载态
4.B2 互动记录筛选按钮切换后列表更新

### 输入校验规则
4.V1 刷新请求中 source 为空返回 400
4.V2 customerId 格式满足 `^cust-\\d{3}$`（当前示例）

### 可访问性
4.A11y1 画像卡片标题层级正确（h2/h3）

### 性能基线
4.P1 画像加载 < 1.5s

### 异常返回码映射
4.E1 400 -> 参数错误提示
4.E2 401 -> 跳转登录
4.E3 403 -> 权限不足提示
4.E4 404 -> 客户不存在提示

---

## 5. 需求管理（需求侧栏/面板）

### 用户故事（页面视角）
作为客服，我需要查看需求池并将客户诉求转为需求卡片。

### 验收标准
- 需求列表与统计可从 API 拉取
- 可以创建需求、忽略需求
- 状态更新与统计同步

### 测试用例（页面/流程）
5.0 打开需求面板显示统计卡片、处理/未处理列表
5.1 统计卡片展示数量与占比
5.2 切换筛选（状态）列表更新
5.3 点击“扫描需求”触发本地解析或调用接口
5.4 未处理需求点击“创建卡片”转入已处理列表
5.5 未处理需求点击“忽略”从列表移除
5.6 已处理需求点击“查看详情”弹窗显示内容
5.7 空列表显示空态提示
5.8 接口失败时使用本地 mock 展示
5.9 状态筛选下拉切换后，仅展示对应状态需求

### 接口测试用例（保留）
5.A `GET /api/requirements` 返回列表并渲染
5.B `GET /api/requirements/statistics` 返回统计并更新图表
5.C `POST /api/requirements` 创建成功
5.D `POST /api/requirements/:id/ignore` 忽略成功
5.E `PATCH /api/requirements/:id/status` 状态更新成功
5.F `DELETE /api/requirements/:id` 删除成功

### 按钮级用例
5.B1 “需求刷新”按钮触发重新拉取列表
5.B2 “需求扫描”按钮触发扫描或提示
5.B3 “创建卡片/忽略”按钮点击后列表更新
5.B4 “查看详情”按钮打开详情弹窗

### 输入校验规则
5.V1 创建需求标题为空提示错误
5.V2 优先级/类别不在枚举内提示错误
5.V3 标题长度 2-200
5.V4 分类枚举：feature/bug/improvement/question
5.V5 状态枚举：pending/approved/resolved/ignored/cancelled

### 可访问性
5.A11y1 统计卡片有可读标题

### 性能基线
5.P1 需求列表加载 < 2s

### 异常返回码映射
5.E1 400 -> 参数错误提示
5.E2 401 -> 跳转登录
5.E3 403 -> 权限不足提示
5.E4 404 -> 需求不存在提示

---

## 6. 任务与质检工作区（任务页）

### 用户故事（页面视角）
作为质检/运营人员，我需要在任务工作区查看质检概览并派发任务指令。

### 验收标准
- 任务工作区可在“质检概览/对话驱动任务”间切换
- 指令输入支持快捷 chips 与日志记录

### 测试用例（页面/流程）
6.0 进入任务页默认展示质检概览卡片与空状态提示
6.1 点击“对话驱动任务”进入指令对话模式，显示指令输入框与日志区
6.2 指令输入为空点击“派发给Agent”提示警告
6.3 输入指令派发后日志区新增记录并提示成功
6.4 点击指令 chip 自动填入输入框
6.5 点击“返回质检概览”恢复概览视图
6.6 侧栏任务列表无数据时显示“暂无任务”
6.7 指令派发失败时提示错误并保留输入内容

### 接口测试用例（保留）
6.A `POST /api/tasks` 指令派发创建任务成功
6.B `GET /api/tasks` 返回列表并渲染（如有入口）
6.C `POST /api/tasks/:id/actions` 行为变更成功（如有入口）

### 按钮级用例
6.B1 “对话驱动任务/返回质检概览”按钮切换视图
6.B2 “派发给Agent”按钮发送指令并清空输入
6.B3 指令 chip 点击后填充输入框

### 输入校验规则
6.V1 指令输入为空禁止派发

### 可访问性
6.A11y1 指令输入框支持 Enter 提交、Shift+Enter 换行

---

## 7. 知识库管理（知识页）

### 用户故事（页面视角）
作为知识管理员，我需要创建/编辑/删除知识条目与文档。

### 验收标准
- 可检索知识条目并打开详情
- 支持创建/更新/删除（如有权限）

### 测试用例（页面/流程）
7.0 进入知识管理页默认展示左侧分类树、右侧文档列表、顶部搜索框
7.1 左侧分类树默认选中“全部/默认分类”，右侧展示该分类下知识
7.2 新建分类：点击“新增分类”后输入名称，校验空值不允许保存
7.3 新建分类成功后在树中出现，且默认聚焦到新分类
7.4 重复分类名提示错误，不创建
7.5 选择分类节点后右侧列表过滤为该分类内容
7.6 选择“全部”节点后右侧列表恢复全量
7.7 分类切换时右侧列表分页/滚动状态重置
7.8 分类切换后面包屑与列表同步更新
7.9 分类删除：确认弹窗后删除成功，右侧列表回到“全部”
7.10 分类删除后其知识自动迁移到“未分类/默认分类”
7.11 右侧文档搜索：输入关键词，列表实时过滤
7.12 清空搜索条件后列表恢复
7.13 文档详情：点击列表项展示详情面板，内容/标签/更新时间正确
7.14 文档创建：打开创建弹窗，选择分类并上传文件，保存成功
7.15 文档创建后默认出现在当前分类列表首位
7.17 文档删除：确认删除后列表移除
7.18 文档上传：上传后进度显示，成功后列表出现新文档
7.19 上传失败时提示错误并可重试
7.20 FAQ 创建：新增 FAQ 后在 FAQ 列表出现
7.21 FAQ 相似问题添加成功后可在详情看到相似问题列表
7.22 FAQ 搜索为空时显示空态提示
7.23 文档/FAQ 权限不足时按钮隐藏或置灰
7.24 后端接口异常时页面降级提示但不崩溃
7.25 分类树搜索关键字后列表过滤，清空恢复全量
7.26 文档状态筛选/排序切换后列表刷新
7.27 拖拽或选择多文件上传，文件列表展示与删除生效
7.28 上传中展示进度，失败时可点击重试
7.29 删除文档时勾选“删除相关 FAQ”则关联 FAQ 同步移除
7.30 FAQ 挖掘开关开启后展示数量设置
7.31 FAQ 相似问题新增/生成按钮可用并展示结果

### 接口测试用例（保留）
7.A `GET /api/knowledge` 返回列表（分页/筛选）并渲染
7.B `GET /api/knowledge/:id` 返回详情（含元数据字段）
7.C `POST /api/knowledge` 创建成功并返回新 ID
7.D `PATCH /api/knowledge/:id` 更新成功并返回最新版本
7.E `DELETE /api/knowledge/:id` 删除成功（再次查询返回 404）
7.F `POST /api/knowledge/search` 搜索返回匹配结果（关键词/分类）
7.G `POST /api/knowledge/upload` 上传成功返回任务或文档信息
7.H `GET /api/knowledge/:id/progress` 返回处理进度

### 按钮级用例
7.B1 “新增分类”按钮打开创建弹窗
7.B2 “新增文档/FAQ”按钮打开创建弹窗
7.B3 “上传文档”按钮触发文件选择器
7.B4 “保存/删除”按钮执行操作并提示结果
7.B5 “相似问题添加”按钮新增条目

### 输入校验规则
7.V1 分类名称为空提示错误
7.V2 上传未选择分类提示错误
7.V3 上传未选择文件提示错误
7.V4 FAQ 问题为空提示错误
7.V5 上传文件类型/大小不符合提示错误
7.V6 分类名称长度 2-40
7.V7 FAQ 生成数量范围 1-20

### 可访问性
7.A11y1 分类树可键盘展开/折叠
7.A11y2 上传按钮可键盘触发

### 性能基线
7.P1 知识列表加载 < 2s

### 异常返回码映射
7.E1 400 -> 参数错误提示
7.E2 401 -> 跳转登录
7.E3 403 -> 权限不足提示
7.E4 404 -> 知识不存在提示

---

## 8. 知识应用（知识应用页）

### 用户故事（页面视角）
作为客服，我需要从知识库检索并引用内容以辅助回复客户。

### 验收标准
- 知识搜索返回结果并可预览
- 复制/引用内容可反馈提示

### 测试用例（页面/流程）
8.0 进入知识应用页默认聚焦搜索输入框
8.1 输入关键字并回车/点击搜索触发请求
8.2 搜索结果列表包含标题/分类/评分
8.3 点击结果展示详情/预览区
8.4 复制按钮可用并提示成功
8.5 清空搜索后结果列表恢复初始状态
8.6 搜索无结果时显示空态提示
8.7 快捷入口点击后填入搜索框并触发搜索
8.8 搜索输入框内容变化时清空按钮显示/隐藏正确
8.9 点击结果卡片后详情面板展示标题/分类/更新时间/标签
8.10 点击“复制内容”提示成功/失败，文案 2s 后恢复

### 接口测试用例（保留）
8.A `POST /api/knowledge/search` 按关键词返回结果
8.B `GET /api/knowledge/:id` 返回知识内容可预览

<!--
注意：语义检索测试用例(8.S1-8.S6)和多路召回策略测试用例(8.R1-8.R6)已移至后端测试文档
原因：这些测试用例描述的是后端算法实现细节，不属于前端UI测试范围
前端测试应聚焦于：搜索输入、结果展示、排序、复制等UI交互
参考文档：../backend/tests/事件格式.md
-->

### 按钮级用例
8.B1 “搜索”按钮触发检索
8.B2 “复制”按钮提示成功
8.B3 “快捷入口”按钮填入关键词并触发搜索

### 输入校验规则
8.V1 搜索关键词为空不触发请求或提示
8.V2 搜索关键词长度上限 100

### 可访问性
8.A11y1 搜索框有可见 label 或 aria-label

### 性能基线
8.P1 搜索响应 95% < 1.5s

### 异常返回码映射
8.E1 400 -> 参数错误提示
8.E2 401 -> 跳转登录
8.E3 500 -> “检索失败”提示

---

## 9. AI 辅助（AI 面板）

### 用户故事（页面视角）
作为客服，我希望获得 AI 分析和建议。

### 验收标准
- AI 分析接口响应并渲染
- 情绪分析显示在对话列表

### 测试用例（页面/流程）
9.0 打开 AI 面板后自动拉取分析数据
9.1 面板展示情绪/需求/建议模块
9.2 点击“采纳建议”将内容写入输入框
9.3 切换对话后 AI 面板自动刷新
9.4 失败时显示降级提示，不阻塞其他功能
9.5 AI 面板子区域（回复/方案/行动/澄清/需求/情绪/参考资料）按按钮打开并展示内容
9.6 AI 面板“引用知识/相似工单”点击“填入草稿”后输入框内容更新
9.7 情绪分析返回后对话列表情绪 icon 更新

### 接口测试用例（保留）
9.A `GET /im/conversations/:id/ai-analysis` 返回分析结果
9.B `POST /ai/analyze` 返回分析摘要
9.C `GET /im/conversations/:id/sentiment` 返回情绪

### 按钮级用例
9.B1 “采纳建议”按钮将内容写入输入框
9.B2 “重新分析”按钮触发重新请求

### 输入校验规则
9.V1 分析上下文为空时提示或使用默认上下文
9.V2 模型名称仅允许允许列表值

### 可访问性
9.A11y1 AI 面板展开时焦点在面板内

### 性能基线
9.P1 AI 分析返回 < 3s

### 异常返回码映射
9.E1 400 -> 参数错误提示
9.E2 401 -> 跳转登录
9.E3 500 -> AI 分析失败提示

---

## 10. 工具箱（运维/报表/告警）

### 用户故事（页面视角）
作为管理员，我需要查看服务状态与生成报告。

### 验收标准
- 服务状态能拉取告警列表
- 生成报告拉取审计汇总

### 测试用例（页面/流程）
10.0 进入工具页展示功能入口卡片
10.1 点击“服务状态监控”打开监控弹窗
10.2 弹窗展示服务列表与告警列表
10.3 点击“已处理”后告警移除且提示成功
10.4 点击“生成报告”打开审计汇总弹窗
10.5 “数据库管理/登录诊断/查询日志”弹窗可打开
10.6 无告警时显示空状态
10.7 无权限入口隐藏或提示
10.8 “用户权限管理”弹窗可打开并提示权限数据状态
10.9 “数据备份”点击后显示功能未接入或 API 未启用提示
10.10 “运行登录诊断”点击后显示加载态，完成后显示结果弹窗
10.11 “查询日志”点击后显示加载态并展示结果弹窗
10.12 “查看会话”点击后显示会话管理弹窗

### 接口测试用例（保留）
10.A `GET /monitoring/alerts` 返回告警列表并渲染
10.B `PATCH /monitoring/alerts/:id/resolve` 处理告警成功
10.C `GET /audit/reports/summary` 返回审计汇总并渲染
10.D `POST /monitoring/alerts` 创建告警成功

### 按钮级用例
10.B1 “服务状态监控”按钮打开弹窗
10.B2 “已处理”按钮调用 resolve 接口
10.B3 “生成报告”按钮拉取审计汇总

### 输入校验规则
10.V1 创建告警标题为空提示错误
10.V2 告警级别枚举：info/warning/critical

### 可访问性
10.A11y1 告警列表有空态提示可读

### 性能基线
10.P1 告警列表加载 < 2s

### 异常返回码映射
10.E1 401 -> 跳转登录
10.E2 403 -> 权限不足提示
10.E3 500 -> “服务状态获取失败”提示

---

## 11. 报表（报表页）

### 用户故事（页面视角）
作为主管，我需要查看关键指标趋势图。

### 验收标准
- 报表图表渲染正常
- 数据为空时不崩溃

### 测试用例（页面/流程）
11.0 进入报表页默认展示图表与指标卡
11.1 图表渲染正常且响应式缩放
11.2 切换 tabs 后内容不串页
11.3 Chart.js 未加载时页面不报错

### 按钮级用例
11.B1 报表页切换按钮高亮正确

### 异常返回码映射
11.E1 图表数据为空时显示“暂无数据”

### 可访问性
11.A11y1 图表容器有描述性标题

### 性能基线
11.P1 报表页面渲染 < 2s

---

## 12. 审计与监控后台接口

### 用户故事（页面视角）
作为管理员，我需要审计日志和告警可追踪。

### 验收标准
- 写操作自动产生日志
- 审计汇总可统计

### 测试用例（页面/流程）
12.1 任意写操作后，`/audit/reports/summary` 总数递增
12.2 `POST /audit/events` 可手动写入日志
12.3 `POST /monitoring/alerts` 创建告警成功
12.4 审计汇总按 days 参数变化
12.5 审计写操作不记录读取请求

### 输入校验规则
12.V1 审计事件 action/resource 为空返回 400
12.V2 action 枚举为 HTTP 方法（GET/POST/PATCH/DELETE）

### 性能基线
12.P1 审计汇总接口响应 < 1s

### 异常返回码映射
12.E1 401 -> 跳转登录
12.E2 403 -> 权限不足提示

---

## 13. 健康检查与监控

### 用户故事（页面视角）
作为运维，我需要确认服务健康状态。

### 验收标准
- `/health` 返回健康状态
- `/metrics` 返回 Prometheus 指标

### 测试用例（页面/流程）
13.1 `/health` 返回 status=healthy
13.2 `/metrics` 返回内容类型 `text/plain`

### 异常返回码映射
13.E1 /metrics 失败返回 500 并记录错误

### 性能基线
13.P1 健康检查响应 < 200ms

---

## 14. 权限面板功能完整性（权限页）

### 用户故事（页面视角）
作为管理员，我需要在权限面板中查看成员/角色并修改权限。

### 验收标准
- 角色与成员列表显示正确
- 权限勾选变化可保存并提示

### 测试用例（页面/流程）
14.0 打开权限页展示成员列表与角色面板
14.1 成员列表搜索关键字正确过滤
14.2 切换成员后右侧角色与权限同步
14.3 选择不同角色权限列表更新
14.4 勾选权限后保存按钮变为“保存变更*”
14.5 保存权限后提示成功并更新预览
14.6 未登录访问权限面板被限制
14.7 新增成员：校验必填字段并保存成功后列表更新
14.8 编辑成员：修改角色/团队/徽章后列表刷新
14.9 删除成员：二次确认，当前登录账号不可删除
14.10 新增角色：保存成功后角色列表与选择器更新
14.11 编辑角色：描述更新生效，系统角色不可删除
14.12 删除非系统角色：列表移除
14.13 点击“重置”恢复角色原有权限勾选

### 按钮级用例
14.B1 “新增角色”按钮打开弹窗
14.B2 “新增成员”按钮打开弹窗
14.B3 “编辑/删除成员”按钮触发对应弹窗
14.B4 “编辑/删除角色”按钮触发对应弹窗

### 输入校验规则
14.V1 角色名为空禁止保存
14.V2 成员名为空禁止保存
14.V3 角色描述长度 0-100
14.V4 新增成员需填写密码
14.V5 成员需至少填写邮箱或手机号
14.V6 成员角色必选

### 可访问性
14.A11y1 权限列表支持键盘导航

### 性能基线
14.P1 权限页渲染 < 1.5s

---

## 15. 工具箱快捷动作

### 用户故事（页面视角）
作为客服，我需要使用工具箱快捷操作辅助处理问题。

### 验收标准
- 操作按钮可打开对应弹窗
- 提交后反馈提示正确

### 测试用例（页面/流程）
15.1 “发送系统通知”弹窗可打开并提交
15.2 “创建事件工单”提交后提示成功
15.3 “升级问题”提交后提示成功
15.4 “查询日志/登录诊断”弹窗展示内容
15.5 关闭弹窗按钮可正常关闭

### 输入校验规则
15.V1 系统通知当前未做必填校验（提交后按 API 状态提示）
15.V2 工单标题为空提示错误
15.V3 升级问题当前未做必填校验（提交后按 API 状态提示）
15.V4 文本输入长度上限 500

### 可访问性
15.A11y1 弹窗可通过 ESC 关闭

### 性能基线
15.P1 弹窗打开 < 300ms

---

## 16. 运行时配置与代理

### 用户故事（页面视角）
作为运维，我需要通过 runtime-config 配置 API 地址。

### 验收标准
- runtime-config 覆盖默认 API 地址
- 代理与直连都可正常访问

### 测试用例（页面/流程）
16.1 修改 `public/runtime-config.js` 后 API 请求走新地址
16.2 Vite 代理 `/api/v1` 转发成功
16.3 无 API 配置时提示 “API not configured”

### 异常返回码映射
16.E1 代理异常时提示“网络异常”

### 性能基线
16.P1 首次加载 runtime-config 不阻塞首屏

---

## 17. 可靠性与异常处理

### 用户故事（页面视角）
作为用户，即使接口异常系统也能给出可理解提示。

### 验收标准
- API 失败展示降级内容或提示
- 重试与超时机制生效

### 测试用例（页面/流程）
17.1 API 500 时自动重试 3 次
17.2 超时后提示 “Request timeout”
17.3 JSON 解析异常时提示明确错误
17.4 断网时显示“网络异常”提示

### 异常返回码映射
17.E1 408/504 -> 超时提示
17.E2 429 -> 限流提示

### 可访问性
17.A11y1 错误提示可被读屏器读取

### 性能基线
17.P1 重试总耗时 < 8s

---

## 18. 实时通信与SSE [P0]

### 用户故事
作为客服，我需要实时接收客户消息、Agent建议和系统通知。

### 验收标准
- SSE连接稳定，消息实时推送
- ReviewRequest 实时通知到前端
- 连接断开自动重连

### 测试用例

#### 18.1 SSE连接管理 [P0]
18.1.1 订阅 `/im/reviews/stream` 成功建立SSE连接
18.1.2 SSE连接断开后自动重连
18.1.3 重连后继续接收事件
18.1.4 长时间无事件连接保活（心跳机制）
18.1.5 多标签页独立SSE连接

#### 18.2 ReviewRequest 实时推送 [P0]
18.2.1 低置信度建议触发 ReviewRequest 创建
18.2.2 ReviewRequest 通过SSE实时推送到前端
18.2.3 推送事件包含完整的建议内容和上下文
18.2.4 前端接收到推送后显示复核任务
18.2.5 复核任务显示建议内容、置信度、风险等级

#### 18.3 人工复核流程 [P0]
18.3.1 查询待复核列表：`GET /im/reviews/pending`
18.3.2 复核确认：`POST /im/reviews/submit` (approved)
18.3.3 复核驳回：`POST /im/reviews/submit` (rejected)
18.3.4 复核修改：`POST /im/reviews/submit` (modified)
18.3.5 复核超时自动 auto_approve（可配置）
18.3.6 复核后自动创建任务/更新状态

#### 18.4 消息实时推送 [P1]
18.4.1 外部IM消息实时推送到对话列表
18.4.2 对话中新消息实时显示
18.4.3 消息推送延迟 < 500ms
18.4.4 消息顺序与服务端一致

#### 18.5 降级处理 [P1]
18.5.1 SSE连接失败降级为轮询
18.5.2 降级提示用户
18.5.3 服务恢复后自动切回SSE

### 性能基线
18.P1 SSE消息推送延迟 < 500ms
18.P2 重连时间 < 3s
18.P3 ReviewRequest 推送延迟 < 1s

---

## 19. Agent协同与智能辅助 [P0]

### 用户故事
作为客服，我需要Agent提供智能建议，辅助我处理客户问题。

### 验收标准
- Agent建议准确且可解释
- 低置信度触发人工复核
- Agent不可用时有降级方案

### 测试用例

#### 19.1 Orchestrator Agent 路由决策 [P0]
19.1.1 简单问题路由到 simple 模式（直接回复）
19.1.2 复杂问题路由到 agent_supervised 模式（Agent辅助）
19.1.3 紧急问题路由到 human_first 模式（人工优先）
19.1.4 路由决策包含置信度和理由
19.1.5 路由决策可追溯（记录在 domain_events）

#### 19.2 AssistantAgent 对话辅助 [P0]
19.2.1 情绪分析准确识别（正面/负面/中性）
19.2.2 意图识别准确分类（咨询/投诉/故障/需求）
19.2.3 回复建议符合上下文
19.2.4 回复建议包含知识库引用
19.2.5 低置信度建议触发人工复核

#### 19.3 EngineerAgent 故障诊断 [P1]
19.3.1 故障分类准确（网络/系统/配置/数据）
19.3.2 故障诊断包含根因分析
19.3.3 推荐解决方案可执行
19.3.4 自动创建技术工单
19.3.5 关联历史工单参考

#### 19.4 InspectorAgent 质检评分 [P1]
19.4.1 问题解决后自动触发质检
19.4.2 质检评分包含多维度（响应速度/解决质量/服务态度）
19.4.3 质检报告保存到 quality_reports 表
19.4.4 质检结果可查询：`GET /quality/:conversationId`
19.4.5 质检建议可生成改进任务

#### 19.5 Agent降级策略 [P0]
19.5.1 AgentScope 服务不可用时降级为 LLM 直接调用
19.5.2 LLM 不可用时提示客服手动处理
19.5.3 降级时记录失败原因到日志
19.5.4 降级提示清晰且可执行
19.5.5 服务恢复后自动切回 AgentScope

#### 19.6 MCP工具调用 [P1]
19.6.1 Agent 可调用 `getCustomerProfile` 获取客户画像
19.6.2 Agent 可调用 `searchKnowledge` 检索知识库
19.6.3 Agent 可调用 `createTask` 创建任务
19.6.4 Agent 可调用 `analyzeConversation` 分析对话
19.6.5 MCP工具调用失败有明确错误提示

### 性能基线
19.P1 Agent建议生成 < 3s
19.P2 情绪分析 < 1s
19.P3 质检评分 < 5s

---

## 20. 问题并行管理 [P0]

### 用户故事
作为客服，我需要在同一对话中并行处理多个客户问题。

### 验收标准
- 同一对话可创建多个问题
- 每个问题独立状态流转
- 问题与工单一一对应

### 测试用例

#### 20.1 问题识别与创建 [P0]
20.1.1 LLM 识别客户消息中的新问题
20.1.2 新问题自动创建 Problem 记录（状态：new）
20.1.3 问题创建写入 domain_events 和 outbox_events
20.1.4 同一对话可创建多个问题
20.1.5 问题列表按创建时间倒序显示

#### 20.2 问题状态流转 [P0]
20.2.1 new → in_progress：售后确认并创建工单
20.2.2 in_progress → waiting_customer：请求客户补充信息
20.2.3 waiting_customer → in_progress：客户补充后继续处理
20.2.4 in_progress → resolved：LLM判定已解决
20.2.5 resolved → reopened：客户反馈未解决
20.2.6 状态变更记录在 domain_events

#### 20.3 问题与工单关联 [P0]
20.3.1 高优先级问题自动创建工单
20.3.2 中低优先级问题推荐创建工单（人工确认）
20.3.3 问题状态与工单状态同步
20.3.4 工单完成后问题自动标记为 resolved
20.3.5 问题详情显示关联工单信息

#### 20.4 问题并行处理 [P0]
20.4.1 同一对话显示所有问题列表
20.4.2 每个问题独立状态显示
20.4.3 切换问题查看详情和工单
20.4.4 问题筛选（状态/优先级/创建时间）
20.4.5 问题搜索（关键词/问题描述）

#### 20.5 问题解决触发质检 [P1]
20.5.1 问题标记为 resolved 触发 ProblemResolved 事件
20.5.2 ProblemResolved 事件写入 outbox_events
20.5.3 OutboxProcessor 投递事件到 EventBus
20.5.4 ProblemResolvedEventHandler 触发质检
20.5.5 质检结果关联到问题和对话

### 性能基线
20.P1 问题识别 < 2s
20.P2 问题创建 < 500ms
20.P3 状态流转 < 300ms

---

## 21. 事件溯源与一致性 [P1]

### 用户故事
作为系统管理员，我需要追溯所有操作的事件记录，确保数据一致性。

### 验收标准
- 所有写操作同时写入 domain_events 和 outbox_events
- 事件可回溯和重放
- Outbox 事件最终投递成功

### 测试用例

#### 21.1 领域事件记录 [P1]
21.1.1 创建对话写入 ConversationCreated 事件
21.1.2 发送消息写入 MessageSent 事件
21.1.3 创建需求写入 RequirementCreated 事件
21.1.4 创建任务写入 TaskCreated 事件
21.1.5 问题解决写入 ProblemResolved 事件
21.1.6 事件包含完整的聚合根ID和时间戳

#### 21.2 Outbox 事件持久化 [P1]
21.2.1 领域事件同步写入 outbox_events 表
21.2.2 Outbox 事件状态：pending → processing → completed
21.2.3 Outbox 事件包含 payload 和 metadata
21.2.4 Outbox 事件支持重试（失败后重新投递）
21.2.5 Outbox 事件投递成功后标记为 completed

#### 21.3 OutboxProcessor 异步投递 [P1]
21.3.1 OutboxProcessor 定时轮询 pending 事件
21.3.2 OutboxProcessor 投递事件到 EventBus
21.3.3 投递失败自动重试（最多3次）
21.3.4 重试间隔递增（1s/2s/4s）
21.3.5 重试失败记录错误日志

#### 21.4 事件回溯与重放 [P2]
21.4.1 查询对话的所有领域事件
21.4.2 按时间顺序重放事件
21.4.3 重放事件恢复聚合根状态
21.4.4 事件回溯用于审计和调试

#### 21.5 事件一致性检查 [P1]
21.5.1 domain_events 和 outbox_events 数量一致
21.5.2 事件 payload 内容一致
21.5.3 事件时间戳一致
21.5.4 事件顺序一致

### 性能基线
21.P1 事件写入 < 100ms
21.P2 Outbox 投递延迟 < 5s
21.P3 事件查询 < 500ms

---

## 22. 性能与负载 [P1]

### 用户故事
作为用户，系统在高负载下仍能流畅运行。

### 验收标准
- 大量数据加载不卡顿
- 频繁操作响应及时
- 内存占用合理

### 测试用例

#### 22.1 大数据量加载 [P1]
22.1.1 加载1000+对话列表不卡顿
22.1.2 渲染100+条消息流畅滚动
22.1.3 搜索1000+知识条目 < 2s
22.1.4 图表渲染1000+数据点
22.1.5 加载100+个问题列表不卡顿

#### 22.2 频繁操作响应 [P1]
22.2.1 频繁切换对话无延迟
22.2.2 快速输入消息不丢字
22.2.3 连续点击按钮不重复提交
22.2.4 频繁切换问题无延迟

#### 22.3 内存管理 [P1]
22.3.1 长时间运行内存不泄漏
22.3.2 大文件上传不阻塞UI
22.3.3 批量操作100+项不卡顿
22.3.4 SSE连接长时间保持不泄漏

#### 22.4 首屏加载 [P0]
22.4.1 首屏加载 < 3s
22.4.2 关键资源预加载
22.4.3 非关键资源延迟加载
22.4.4 骨架屏显示 < 500ms

#### 22.5 交互响应 [P0]
22.5.1 对话切换 < 500ms
22.5.2 消息发送响应 < 1s
22.5.3 搜索响应 < 1.5s
22.5.4 页面切换 < 300ms
22.5.5 问题状态切换 < 300ms

#### 22.6 事件处理性能 [P1]
22.6.1 领域事件写入 < 100ms
22.6.2 Outbox 事件投递延迟 < 5s
22.6.3 EventBus 事件分发 < 50ms
22.6.4 质检触发延迟 < 10s

### 性能基线
22.P1 首屏加载 < 3s
22.P2 对话切换 < 500ms
22.P3 消息发送响应 < 1s
22.P4 搜索响应 < 1.5s
22.P5 事件写入 < 100ms

---

## 自动化测试建议

### 推荐工具
- **E2E测试**: Playwright (推荐) / Cypress
- **API测试**: Supertest / Postman/Newman
- **单元测试**: Jest / Vitest
- **性能测试**: Lighthouse / WebPageTest
- **事件测��**: 自定义事件验证工具

### 测试策略
1. **P0测试**: 100%自动化覆盖，每次提交运行
2. **P1测试**: 80%自动化覆盖，每日运行
3. **P2测试**: 50%自动化覆盖，每周运行

### 数据准备
- 使用SQL种子脚本初始化测试数据
- 使用独立测试数据库，避免污染生产数据
- 每次测试前重置数据库状态
- 准备事件溯源测试数据（domain_events + outbox_events）

### 运行顺序
1. 登录与会话
2. 权限体系
3. 对话列表与会话
4. 客户画像
5. 需求管理
6. 任务与质检
7. 知识库管理
8. ��识应用
9. AI辅助
10. 实时通信与SSE
11. Agent协同
12. 问题并行管理
13. 事件溯源
14. 性能测试
15. 工具箱
16. 报表
17. 审计与监控

### CI/CD集成
- 在 GitHub Actions / GitLab CI 中运行自动化测试
- P0测试失败阻止合并
- P1测试失败发出警告
- 生成测试报告和覆盖率报告

---

## 测试用例统计

| 模块 | 测试用例数 | 优先级 | 状态 |
|------|-----------|--------|------|
| 0. 全局导航 | 14 | P0 | ✅ |
| 1. 登录会话 | 15 | P0 | ✅ |
| 2. 权限体系 | 13 | P0 | ✅ |
| 3. 对话会话 | 25 | P0 | ✅ |
| 4. 客户画像 | 16 | P1 | ✅ |
| 5. 需求管理 | 14 | P1 | ✅ |
| 6. 任务质检 | 8 | P1 | ✅ |
| 7. 知识管理 | 38 | P1 | ✅ |
| 8. 知识应用 | 10 | P1 | ✅ |
| 9. AI辅助 | 9 | P1 | ✅ |
| 10. 工具箱 | 15 | P2 | ✅ |
| 11. 报表 | 3 | P2 | ✅ |
| 12. 审计监控 | 7 | P2 | ✅ |
| 13. 健康检查 | 2 | P2 | ✅ |
| 14. 权限面板 | 15 | P1 | ✅ |
| 15. 工具箱快捷 | 8 | P2 | ✅ |
| 16. 运行时配置 | 3 | P1 | ✅ |
| 17. 可靠性 | 4 | P0 | ✅ |
| **18. 实时通信** | **15** | **P0** | **⭐ 新增** |
| **19. Agent协同** | **25** | **P0** | **⭐ 新增** |
| **20. 问题并行管理** | **25** | **P0** | **⭐ 新增** |
| **21. 事件溯源** | **20** | **P1** | **⭐ 新增** |
| **22. 性能测试** | **25** | **P1** | **⭐ 新增** |
| **总计** | **329** | - | - |

---

## 版本历史

### v2.0 (2026-01-26)
- ✅ 删除12个后端算法测试用例（语义检索、多路召回）
- ✅ 新增5个模块，共110个测试用例
  - 模块18: 实时通信与SSE（15个）
  - 模块19: Agent协同与智能辅助（25个）
  - 模块20: 问题并行管理（25个）
  - 模块21: 事件溯源与一致性（20个）
  - 模块22: 性能与负载（25个）
- ✅ 添加完整的文档头部说明
- ✅ 添加优先级标记（P0/P1/P2）
- ✅ 添加模块索引
- ✅ 扩展自动化测试建议
- ✅ 基于事件格式文档补充测试用例

### v1.0 (初始版本)
- 基础测试用例覆盖
- 包含17个模块，共217个测试用例

---
- 运行顺序：登录 -> 会话 -> 客户/需求/任务 -> 知识库 -> AI -> 工具箱 -> 报表 -> 审计/监控
